<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>è®¾è®¡æ¨¡å¼ | Huang Blog</title><meta name="author" content="Huang RD"><meta name="copyright" content="Huang RD"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="Java å¸¸è§çš„è®¾è®¡æ¨¡å¼è®¾è®¡æ¨¡å¼çš„åŸåˆ™å…­å¤§è®¾è®¡åŸåˆ™:  å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility Principle)ï¼šä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå‘ç”Ÿå˜åŒ–çš„åŸå› ã€‚ å¼€é—­åŸåˆ™åŸåˆ™ (Open-Closed Principle)ï¼šæ‰©å±•å¼€æ”¾ï¼Œä¿®æ”¹å…³é—­ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™ (Liskov Substitution Principle)ï¼šç»§æ‰¿å¿…é¡»ä¿è¯è¶…ç±»æ‹¥æœ‰çš„æ€§è´¨åœ¨å­ç±»ä¾ç„¶æˆç«‹ã€‚ è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw Of">
<meta property="og:type" content="article">
<meta property="og:title" content="è®¾è®¡æ¨¡å¼">
<meta property="og:url" content="http://www.haungrd.top/2023/02/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/index.html">
<meta property="og:site_name" content="Huang Blog">
<meta property="og:description" content="Java å¸¸è§çš„è®¾è®¡æ¨¡å¼è®¾è®¡æ¨¡å¼çš„åŸåˆ™å…­å¤§è®¾è®¡åŸåˆ™:  å•ä¸€èŒè´£åŸåˆ™ (Single Responsibility Principle)ï¼šä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå‘ç”Ÿå˜åŒ–çš„åŸå› ã€‚ å¼€é—­åŸåˆ™åŸåˆ™ (Open-Closed Principle)ï¼šæ‰©å±•å¼€æ”¾ï¼Œä¿®æ”¹å…³é—­ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™ (Liskov Substitution Principle)ï¼šç»§æ‰¿å¿…é¡»ä¿è¯è¶…ç±»æ‹¥æœ‰çš„æ€§è´¨åœ¨å­ç±»ä¾ç„¶æˆç«‹ã€‚ è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆLaw Of">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.huangrd.top/images/agentina/10.jpg">
<meta property="article:published_time" content="2023-02-20T10:12:57.000Z">
<meta property="article:modified_time" content="2023-05-06T13:12:57.000Z">
<meta property="article:author" content="Huang RD">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="æºç ">
<meta property="article:tag" content="è®¾è®¡æ¨¡å¼">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.huangrd.top/images/agentina/10.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://www.haungrd.top/2023/02/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"ç¹","msgToSimplifiedChinese":"ç®€"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-right"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'è®¾è®¡æ¨¡å¼',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-05-06 21:12:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://getwallpapers.com/wallpaper/full/a/1/8/1057222-free-download-cool-nature-backgrounds-1920x1200-windows-10.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">56</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">74</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">17</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><span> æ¸…å•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://www.huangrd.top/images/agentina/10.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Huang Blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><span> æ¸…å•</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> éŸ³ä¹</span></a></li><li><a class="site-page child" href="/Gallery/"><i class="fa-fw fas fa-images"></i><span> ç…§ç‰‡</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> ç”µå½±</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹æƒ…é“¾æ¥</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">è®¾è®¡æ¨¡å¼</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2023-02-20T10:12:57.000Z" title="å‘è¡¨äº 2023-02-20 18:12:57">2023-02-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-05-06T13:12:57.000Z" title="æ›´æ–°äº 2023-05-06 21:12:57">2023-05-06</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">32.1k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>127åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="è®¾è®¡æ¨¡å¼"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Java-å¸¸è§çš„è®¾è®¡æ¨¡å¼"><a href="#Java-å¸¸è§çš„è®¾è®¡æ¨¡å¼" class="headerlink" title="Java å¸¸è§çš„è®¾è®¡æ¨¡å¼"></a>Java å¸¸è§çš„è®¾è®¡æ¨¡å¼</h1><h2 id="è®¾è®¡æ¨¡å¼çš„åŸåˆ™"><a href="#è®¾è®¡æ¨¡å¼çš„åŸåˆ™" class="headerlink" title="è®¾è®¡æ¨¡å¼çš„åŸåˆ™"></a>è®¾è®¡æ¨¡å¼çš„åŸåˆ™</h2><p>å…­å¤§è®¾è®¡åŸåˆ™:</p>
<ol>
<li><strong>å•ä¸€èŒè´£åŸåˆ™</strong> (Single Responsibility Principle)ï¼šä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå‘ç”Ÿå˜åŒ–çš„åŸå› ã€‚</li>
<li><strong>å¼€é—­åŸåˆ™åŸåˆ™</strong> (Open-Closed Principle)ï¼šæ‰©å±•å¼€æ”¾ï¼Œä¿®æ”¹å…³é—­ã€‚</li>
<li><strong>é‡Œæ°æ›¿æ¢åŸåˆ™</strong> (Liskov Substitution Principle)ï¼šç»§æ‰¿å¿…é¡»ä¿è¯è¶…ç±»æ‹¥æœ‰çš„æ€§è´¨åœ¨å­ç±»ä¾ç„¶æˆç«‹ã€‚</li>
<li><strong>è¿ªç±³ç‰¹æ³•åˆ™</strong>ï¼ˆLaw Of Demeterï¼‰ï¼šå‡å°‘ç±»ä¹‹é—´çš„è€¦åˆï¼Œä¿è¯æœ€å°‘çŸ¥é“ï¼Œå‡å°‘ä¾èµ–ã€‚</li>
<li><strong>æ¥å£éš”ç¦»åŸåˆ™</strong> (Interface Segregation Principle)ï¼šæ›´å°çš„æ¥å£ã€æ›´å…·ä½“çš„æ¥å£ã€‚</li>
<li><strong>ä¾èµ–å€’è½¬åŸåˆ™</strong> (Dependence Inversion Principle)ï¼šé¢å‘æŠ½è±¡çš„ä¾èµ–æ¥å£è€Œä¸æ˜¯å®ç°ã€‚</li>
<li><strong>ç»„åˆ&#x2F;èšåˆå¤ç”¨åŸåˆ™</strong> (Composite&#x2F;Aggregate Reuse Principle)</li>
</ol>
<h4 id="1-å•ä¸€èŒè´£åŸåˆ™-SRP"><a href="#1-å•ä¸€èŒè´£åŸåˆ™-SRP" class="headerlink" title="1.å•ä¸€èŒè´£åŸåˆ™ SRP"></a>1.å•ä¸€èŒè´£åŸåˆ™ SRP</h4><p>å•ä¸€èŒè´£åŸåˆ™è¡¨ç¤ºä¸€ä¸ªæ¨¡å—çš„ç»„æˆå…ƒç´ ä¹‹é—´çš„åŠŸèƒ½ç›¸å…³æ€§ã€‚ä»è½¯ä»¶å˜åŒ–çš„è§’åº¦æ¥çœ‹ï¼Œå°±ä¸€ä¸ªç±»è€Œè¨€ï¼Œåº”è¯¥ä»…æœ‰ä¸€ä¸ªè®©å®ƒå˜åŒ–çš„åŸå› ï¼Œå³ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚</p>
<p>ä¸¾ä¾‹åœºæ™¯ï¼šåŠ¨ç‰©å‘¼å¸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">breathe</span><span class="params">(String animal)</span>&#123;  </span><br><span class="line">        System.out.println(animal + <span class="string">&quot;å‘¼å¸ç©ºæ°”&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>();  </span><br><span class="line">        animal.breathe(<span class="string">&quot;ç‰›&quot;</span>);  </span><br><span class="line">        animal.breathe(<span class="string">&quot;ç¾Š&quot;</span>);  </span><br><span class="line">        animal.breathe(<span class="string">&quot;çŒª&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>å¦‚æœæœ‰æ–°ç‰©ç§å¦‚ğŸŸä¸éœ€è¦å‘¼å¸ï¼Œæ ¹æ®<strong>å•ä¸€èŒè´£åŸåˆ™</strong>å°±éœ€è¦å¯¹ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œéœ€è¦æ‹†åˆ†ä¹‹å‰çš„ Animal ç±»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Terrestrial</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">breathe</span><span class="params">(String animal)</span>&#123;  </span><br><span class="line">        System.out.println(animal + <span class="string">&quot;å‘¼å¸ç©ºæ°”&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Aquatic</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">breathe</span><span class="params">(String animal)</span>&#123;  </span><br><span class="line">        System.out.println(animal + <span class="string">&quot;å‘¼å¸æ°´&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">Terrestrial</span> <span class="variable">terrestrial</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Terrestrial</span>();  </span><br><span class="line">        terrestrial.breathe(<span class="string">&quot;ç‰›&quot;</span>);  </span><br><span class="line">        terrestrial.breathe(<span class="string">&quot;ç¾Š&quot;</span>);  </span><br><span class="line">        terrestrial.breathe(<span class="string">&quot;çŒª&quot;</span>);  </span><br><span class="line">          </span><br><span class="line">        <span class="type">Aquatic</span> <span class="variable">aquatic</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Aquatic</span>();  </span><br><span class="line">        aquatic.breathe(<span class="string">&quot;é±¼&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>å¦‚æœè¿åå•ä¸€èŒè´£åŸåˆ™ï¼Œåˆ™ä¿®æ”¹ä»£ç çš„èŠ±é”€ä¼šå‡å°‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">breathe</span><span class="params">(String animal)</span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="string">&quot;é±¼&quot;</span>.equals(animal))&#123;  </span><br><span class="line">            System.out.println(animal + <span class="string">&quot;å‘¼å¸æ°´&quot;</span>);  </span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;  </span><br><span class="line">            System.out.println(animal + <span class="string">&quot;å‘¼å¸ç©ºæ°”&quot;</span>);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>();  </span><br><span class="line">        animal.breathe(<span class="string">&quot;ç‰›&quot;</span>);  </span><br><span class="line">        animal.breathe(<span class="string">&quot;ç¾Š&quot;</span>);  </span><br><span class="line">        animal.breathe(<span class="string">&quot;çŒª&quot;</span>);  </span><br><span class="line">        animal.breathe(<span class="string">&quot;é±¼&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦ä¸€ç§ä¿®æ”¹æ–¹å¼:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">breathe</span><span class="params">(String animal)</span>&#123;  </span><br><span class="line">        System.out.println(animal + <span class="string">&quot;å‘¼å¸ç©ºæ°”&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">breathe2</span><span class="params">(String animal)</span>&#123;  </span><br><span class="line">        System.out.println(animal + <span class="string">&quot;å‘¼å¸æ°´&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">Animal</span> <span class="variable">animal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Animal</span>();  </span><br><span class="line">        animal.breathe(<span class="string">&quot;ç‰›&quot;</span>);  </span><br><span class="line">        animal.breathe(<span class="string">&quot;ç¾Š&quot;</span>);  </span><br><span class="line">        animal.breathe(<span class="string">&quot;çŒª&quot;</span>);  </span><br><span class="line">        animal.breathe2(<span class="string">&quot;é±¼&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™æ ·å¯èƒ½å­˜åœ¨å®‰å…¨éšæ‚£ã€‚</p>
<p><strong>æ€»ç»“</strong>:</p>
<ol>
<li>SRP æ˜¯ä¸€ä¸ªç®€å•åˆç›´è§‚çš„åŸåˆ™ï¼Œä½†æ˜¯åœ¨å®é™…ç¼–ç çš„è¿‡ç¨‹ä¸­å¾ˆéš¾å°†å®ƒæ°å½“åœ°è¿ç”¨ï¼Œéœ€è¦ç»“åˆå®é™…æƒ…å†µè¿›è¡Œè¿ç”¨ã€‚</li>
<li>å•ä¸€èŒè´£åŸåˆ™å¯ä»¥é™ä½ç±»çš„å¤æ‚åº¦ï¼Œä¸€ä¸ªç±»ä»…è´Ÿè´£ä¸€é¡¹èŒè´£ï¼Œå…¶é€»è¾‘è‚¯å®šè¦æ¯”è´Ÿè´£å¤šé¡¹èŒè´£ç®€å•ã€‚</li>
<li>æé«˜äº†ä»£ç çš„å¯è¯»æ€§ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§ã€‚</li>
</ol>
<h4 id="2-å¼€æ”¾-å…³é—­åŸåˆ™-OCP"><a href="#2-å¼€æ”¾-å…³é—­åŸåˆ™-OCP" class="headerlink" title="2.å¼€æ”¾-å…³é—­åŸåˆ™ OCP"></a>2.å¼€æ”¾-å…³é—­åŸåˆ™ OCP</h4><p>å¼€æ”¾-å…³é—­åŸåˆ™è¡¨ç¤ºè½¯ä»¶å®ä½“ (ç±»ã€æ¨¡å—ã€å‡½æ•°ç­‰ç­‰) åº”è¯¥æ˜¯<strong>å¯ä»¥è¢«æ‰©å±•çš„ï¼Œä½†æ˜¯ä¸å¯è¢«ä¿®æ”¹</strong>ã€‚(Open for extension, close for modification)</p>
<p>ä¼˜ç‚¹ï¼š</p>
<ol>
<li>èƒ½å¤Ÿæ‰©å±•å·²å­˜åœ¨çš„ç³»ç»Ÿï¼Œèƒ½å¤Ÿæä¾›æ–°çš„åŠŸèƒ½æ»¡è¶³æ–°çš„éœ€æ±‚ï¼Œå› æ­¤è¯¥è½¯ä»¶æœ‰ç€å¾ˆå¼ºçš„é€‚åº”æ€§å’Œçµæ´»æ€§ã€‚</li>
<li>å·²å­˜åœ¨çš„æ¨¡å—ï¼Œç‰¹åˆ«æ˜¯é‚£äº›é‡è¦çš„æŠ½è±¡æ¨¡å—ï¼Œä¸éœ€è¦è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆè¯¥è½¯ä»¶å°±æœ‰å¾ˆå¼ºçš„ç¨³å®šæ€§å’ŒæŒä¹…æ€§ã€‚</li>
</ol>
<p>ä¸¾ä¾‹ï¼šç”µè„‘ç”Ÿæˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Computer</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Macbook</span> <span class="keyword">implements</span> <span class="title class_">Computer</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Surface</span> <span class="keyword">implements</span> <span class="title class_">Computer</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Computer <span class="title function_">produceComputer</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="type">Computer</span> <span class="variable">c</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span>(type.equals(<span class="string">&quot;macbook&quot;</span>))&#123;</span><br><span class="line">            c = <span class="keyword">new</span> <span class="title class_">Macbook</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(type.equals(<span class="string">&quot;surface&quot;</span>))&#123;</span><br><span class="line">            c = <span class="keyword">new</span> <span class="title class_">Surface</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœåŠ å…¥æ–°çš„å“ç‰Œï¼Œåˆ™éœ€è¦ä¿®æ”¹ä¹‹å‰çš„ä»£ç ã€‚åº”è¯¥æä¾›ä¸€ä¸ªæ¥å£è®©æ–°çš„å“ç‰Œå»æ‹“å±•åŠ è½½ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Computer</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Macbook</span> <span class="keyword">implements</span> <span class="title class_">Computer</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Surface</span> <span class="keyword">implements</span> <span class="title class_">Computer</span> &#123;&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Computer <span class="title function_">produceComputer</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppleFactory</span> <span class="keyword">implements</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Computer <span class="title function_">produceComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Macbook</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MSFactory</span> <span class="keyword">implements</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Computer <span class="title function_">produceComputer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Surface</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¼–å†™æŠ½è±¡å·¥å‚æä¾›æ¥å£ï¼Œè®©ä¸åŒçš„å“ç‰Œçš„å·¥å‚è¿›è¡Œå®ç°æ‹“å±•ã€‚</p>
<p><strong>æ€»ç»“</strong>ï¼š</p>
<ol>
<li>OCP å¯ä»¥å…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§ï¼Œå¯ç»´æŠ¤æ€§ã€‚</li>
<li>ä¸å¯èƒ½è®©ä¸€ä¸ªç³»ç»Ÿçš„æ‰€æœ‰æ¨¡å—éƒ½æ»¡è¶³ OCP åŸåˆ™ï¼Œæˆ‘ä»¬èƒ½åšåˆ°çš„æ˜¯å°½å¯èƒ½åœ°ä¸è¦ä¿®æ”¹å·²ç»å†™å¥½çš„ä»£ç ï¼Œå·²æœ‰çš„åŠŸèƒ½ï¼Œè€Œæ˜¯å»æ‰©å±•å®ƒã€‚</li>
</ol>
<h4 id="3-é‡Œæ°æ›¿æ¢åŸåˆ™-LSP"><a href="#3-é‡Œæ°æ›¿æ¢åŸåˆ™-LSP" class="headerlink" title="3.é‡Œæ°æ›¿æ¢åŸåˆ™ LSP"></a>3.é‡Œæ°æ›¿æ¢åŸåˆ™ LSP</h4><p>é‡Œæ°æ›¿æ¢åŸåˆ™å‘Šè¯‰æˆ‘ä»¬ï¼Œå½“ä½¿ç”¨ç»§æ‰¿æ—¶å€™ï¼Œç±» B ç»§æ‰¿ç±» A æ—¶ï¼Œé™¤æ·»åŠ æ–°çš„æ–¹æ³•å®Œæˆæ–°å¢åŠŸèƒ½ P2ï¼Œå°½é‡ä¸è¦ä¿®æ”¹çˆ¶ç±»æ–¹æ³•é¢„æœŸçš„è¡Œä¸ºã€‚</p>
<p><strong>é‡Œæ°æ›¿æ¢åŸåˆ™çš„é‡ç‚¹åœ¨ä¸å½±å“åŸåŠŸèƒ½ï¼Œè€Œä¸æ˜¯ä¸è¦†ç›–åŸæ–¹æ³•</strong></p>
<p>é‡Œæ°æ›¿æ¢åŸåˆ™é€šä¿—çš„æ¥è®²å°±æ˜¯ï¼šå­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ã€‚</p>
<h4 id="4-ä¾èµ–å€’è½¬åŸåˆ™-DIP"><a href="#4-ä¾èµ–å€’è½¬åŸåˆ™-DIP" class="headerlink" title="4.ä¾èµ–å€’è½¬åŸåˆ™ DIP"></a>4.ä¾èµ–å€’è½¬åŸåˆ™ DIP</h4><p>å®šä¹‰ï¼šé«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥äºæŠ½è±¡ã€‚è¿›ä¸€æ­¥è¯´ï¼ŒæŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚</p>
<p><strong>ä¾èµ–å€’è½¬åŸåˆ™çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯é¢å‘æ¥å£ç¼–ç¨‹</strong></p>
<p>ä¸¾ä¾‹ï¼šè®²æ•…äº‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContent</span><span class="params">()</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„æ•…äº‹&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mother</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">(Book book)</span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;å¦ˆå¦ˆå¼€å§‹è®²æ•…äº‹&quot;</span>);  </span><br><span class="line">        System.out.println(book.getContent());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">Mother</span> <span class="variable">mother</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mother</span>();  </span><br><span class="line">        mother.say(<span class="keyword">new</span> <span class="title class_">Book</span>());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>ç°åœ¨éœ€è¦æ¯äº²ç»™ç›–å­©å­å°†æŠ¥çº¸çš„å†…å®¹ï¼Œåˆ™éœ€è¦ä¿®æ”¹ä»£ç ã€‚è¾ƒå¥½çš„æ–¹å¼å°±æ˜¯ å¼•å…¥ä¸€ä¸ªæŠ½è±¡æ¥å£ IReader è¯»ç‰©ï¼Œè®©ä¹¦å’ŒæŠ¥çº¸å»å®ç°è¿™ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæ— è®ºæä¾›ä»€ä¹ˆæ ·çš„è¯»ç‰©ï¼Œè¯¥æ¯äº²éƒ½èƒ½è¯»ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">IReader</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContent</span><span class="params">()</span>;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Newspaper</span> <span class="keyword">implements</span> <span class="title class_">IReader</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContent</span><span class="params">()</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;è¿™ä¸ªä¸€åˆ™é‡è¦çš„æ–°é—»&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Book</span> <span class="keyword">implements</span> <span class="title class_">IReader</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getContent</span><span class="params">()</span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªæœ‰è¶£çš„æ•…äº‹&quot;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mother</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">say</span><span class="params">(IReader reader)</span>&#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;å¦ˆå¦ˆå¼€å§‹è®²æ•…äº‹&quot;</span>);  </span><br><span class="line">        System.out.println(reader.getContent());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">Mother</span> <span class="variable">mother</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Mother</span>();  </span><br><span class="line">        mother.say(<span class="keyword">new</span> <span class="title class_">Book</span>());  </span><br><span class="line">        mother.say(<span class="keyword">new</span> <span class="title class_">Newspaper</span>());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¾èµ–å€’è½¬åŸåˆ™çš„æ ¸å¿ƒå°±æ˜¯è¦æˆ‘ä»¬é¢å‘æ¥å£ç¼–ç¨‹ï¼Œç†è§£äº†é¢å‘æ¥å£ç¼–ç¨‹ï¼Œä¹Ÿå°±ç†è§£äº†ä¾èµ–å€’è½¬ã€‚</strong></p>
<h4 id="5-æ¥å£éš”ç¦»åŸåˆ™-ISP"><a href="#5-æ¥å£éš”ç¦»åŸåˆ™-ISP" class="headerlink" title="5.æ¥å£éš”ç¦»åŸåˆ™ ISP"></a>5.æ¥å£éš”ç¦»åŸåˆ™ ISP</h4><p>æ¥å£éš”ç¦»åŸåˆ™å¼ºè°ƒï¼š<strong>å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ï¼›ä¸€ä¸ªç±»å¯¹å¦ä¸€ä¸ªç±»çš„ä¾èµ–åº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚</strong></p>
<p>æ¡ˆä¾‹ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/v2-ec9b282b367e9c148a7963b5b23c60e7_720w.webp" alt="img"></p>
<p>å­˜åœ¨æ¥å£å†—ä½™ï¼Œä¾‹å¦‚Aå¹¶ä¸éœ€è¦æ–¹æ³•4,5ï¼Œä½†Bè¿˜æ˜¯å®ç°äº†4ï¼Œ5</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">I</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method5</span><span class="params">()</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend1</span><span class="params">(I i)</span>&#123;  </span><br><span class="line">        i.method1();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend2</span><span class="params">(I i)</span>&#123;  </span><br><span class="line">        i.method2();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend3</span><span class="params">(I i)</span>&#123;  </span><br><span class="line">        i.method3();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">implements</span> <span class="title class_">I</span>&#123;  </span><br><span class="line">	 <span class="comment">// ç±» B åªéœ€è¦å®ç°æ–¹æ³• 1ï¼Œ2, 3ï¼Œè€Œå…¶å®ƒæ–¹æ³•å®ƒå¹¶ä¸éœ€è¦ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦å®ç°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» B å®ç°æ¥å£ I çš„æ–¹æ³• 1&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» B å®ç°æ¥å£ I çš„æ–¹æ³• 2&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» B å®ç°æ¥å£ I çš„æ–¹æ³• 3&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span> &#123;&#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method5</span><span class="params">()</span> &#123;&#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend1</span><span class="params">(I i)</span>&#123;  </span><br><span class="line">        i.method1();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend2</span><span class="params">(I i)</span>&#123;  </span><br><span class="line">        i.method4();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend3</span><span class="params">(I i)</span>&#123;  </span><br><span class="line">        i.method5();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span> <span class="keyword">implements</span> <span class="title class_">I</span>&#123;  </span><br><span class="line">	<span class="comment">// ç±» D åªéœ€è¦å®ç°æ–¹æ³• 1ï¼Œ4ï¼Œ5ï¼Œè€Œå…¶å®ƒæ–¹æ³•å®ƒå¹¶ä¸éœ€è¦ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦å®ç°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» D å®ç°æ¥å£ I çš„æ–¹æ³• 1&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;&#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span> &#123;&#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» D å®ç°æ¥å£ I çš„æ–¹æ³• 4&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method5</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» D å®ç°æ¥å£ I çš„æ–¹æ³• 5&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;  </span><br><span class="line">        <span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">A</span>();  </span><br><span class="line">        a.depend1(<span class="keyword">new</span> <span class="title class_">B</span>());  </span><br><span class="line">        a.depend2(<span class="keyword">new</span> <span class="title class_">B</span>());  </span><br><span class="line">        a.depend3(<span class="keyword">new</span> <span class="title class_">B</span>());  </span><br><span class="line">          </span><br><span class="line">        <span class="type">C</span> <span class="variable">c</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">C</span>();  </span><br><span class="line">        c.depend1(<span class="keyword">new</span> <span class="title class_">D</span>());  </span><br><span class="line">        c.depend2(<span class="keyword">new</span> <span class="title class_">D</span>());  </span><br><span class="line">        c.depend3(<span class="keyword">new</span> <span class="title class_">D</span>());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>æ ¹æ®æ¥å£éš”ç¦»åŸåˆ™è¿›è¡Œä¿®æ”¹:</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/v2-7611098e41bcfbf5113d978b47fc8466_720w.webp" alt="img"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">I1</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">I2</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">I3</span> &#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span>;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method5</span><span class="params">()</span>;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend1</span><span class="params">(I1 i)</span>&#123;  </span><br><span class="line">        i.method1();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend2</span><span class="params">(I2 i)</span>&#123;  </span><br><span class="line">        i.method2();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend3</span><span class="params">(I2 i)</span>&#123;  </span><br><span class="line">        i.method3();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">implements</span> <span class="title class_">I1</span>, I2&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» B å®ç°æ¥å£ I1 çš„æ–¹æ³• 1&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» B å®ç°æ¥å£ I2 çš„æ–¹æ³• 2&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» B å®ç°æ¥å£ I2 çš„æ–¹æ³• 3&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend1</span><span class="params">(I1 i)</span>&#123;  </span><br><span class="line">        i.method1();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend2</span><span class="params">(I3 i)</span>&#123;  </span><br><span class="line">        i.method4();  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">depend3</span><span class="params">(I3 i)</span>&#123;  </span><br><span class="line">        i.method5();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span> <span class="keyword">implements</span> <span class="title class_">I1</span>, I3&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» D å®ç°æ¥å£ I1 çš„æ–¹æ³• 1&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method4</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» D å®ç°æ¥å£ I3 çš„æ–¹æ³• 4&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method5</span><span class="params">()</span> &#123;  </span><br><span class="line">        System.out.println(<span class="string">&quot;ç±» D å®ç°æ¥å£ I3 çš„æ–¹æ³• 5&quot;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ï¼š</p>
<ol>
<li>æ¥å£éš”ç¦»åŸåˆ™çš„æ€æƒ³åœ¨äºå»ºç«‹å•ä¸€æ¥å£ï¼Œå°½å¯èƒ½åœ°å»ç»†åŒ–æ¥å£ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å°½å¯èƒ½å°‘</li>
<li>ä½†æ˜¯å‡¡äº‹éƒ½è¦æœ‰ä¸ªåº¦ï¼Œå¦‚æœæ¥å£è®¾è®¡è¿‡å°ï¼Œåˆ™ä¼šé€ æˆæ¥å£æ•°é‡è¿‡å¤šï¼Œä½¿è®¾è®¡å¤æ‚åŒ–ã€‚æ‰€ä»¥ä¸€å®šè¦é€‚åº¦ã€‚</li>
</ol>
<h4 id="6-è¿ªç±³ç‰¹æ³•åˆ™-LOD"><a href="#6-è¿ªç±³ç‰¹æ³•åˆ™-LOD" class="headerlink" title="6.è¿ªç±³ç‰¹æ³•åˆ™ LOD"></a>6.è¿ªç±³ç‰¹æ³•åˆ™ LOD</h4><p>è¿ªç±³ç‰¹æ³•åˆ™åˆç§°ä¸º æœ€å°‘çŸ¥é“åŸåˆ™ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶å®ƒå¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£ã€‚åªä¸ç›´æ¥çš„æœ‹å‹é€šä¿¡ã€‚</p>
<h4 id="7-ç»„åˆ-x2F-èšåˆå¤ç”¨åŸåˆ™-CRP"><a href="#7-ç»„åˆ-x2F-èšåˆå¤ç”¨åŸåˆ™-CRP" class="headerlink" title="7.ç»„åˆ&#x2F;èšåˆå¤ç”¨åŸåˆ™ CRP"></a>7.ç»„åˆ&#x2F;èšåˆå¤ç”¨åŸåˆ™ CRP</h4><p>ç»„åˆ&#x2F;èšåˆå¤ç”¨åŸåˆ™å°±æ˜¯åœ¨ä¸€ä¸ªæ–°çš„å¯¹è±¡é‡Œé¢ä½¿ç”¨ä¸€äº›å·²æœ‰çš„å¯¹è±¡ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†; æ–°çš„å¯¹è±¡é€šè¿‡å‘è¿™äº›å¯¹è±¡çš„å§”æ´¾è¾¾åˆ°å¤ç”¨å·²æœ‰åŠŸèƒ½çš„ç›®çš„ã€‚</p>
<p>åœ¨é¢å‘å¯¹è±¡çš„è®¾è®¡ä¸­ï¼Œå¦‚æœç›´æ¥ç»§æ‰¿åŸºç±»ï¼Œä¼šç ´åå°è£…ï¼Œå› ä¸ºç»§æ‰¿å°†åŸºç±»çš„å®ç°ç»†èŠ‚æš´éœ²ç»™å­ç±»ï¼›å¦‚æœåŸºç±»çš„å®ç°å‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ™å­ç±»çš„å®ç°ä¹Ÿä¸å¾—ä¸æ”¹å˜ï¼›ä»åŸºç±»ç»§æ‰¿è€Œæ¥çš„å®ç°æ˜¯é™æ€çš„ï¼Œä¸å¯èƒ½åœ¨è¿è¡Œæ—¶å‘ç”Ÿæ”¹å˜ï¼Œæ²¡æœ‰è¶³å¤Ÿçš„çµæ´»æ€§ã€‚äºæ˜¯å°±æå‡ºäº†ç»„åˆ&#x2F;èšåˆå¤ç”¨åŸåˆ™ï¼Œä¹Ÿå°±æ˜¯åœ¨å®é™…å¼€å‘è®¾è®¡ä¸­ï¼Œå°½é‡ä½¿ç”¨ç»„åˆ&#x2F;èšåˆï¼Œä¸è¦ä½¿ç”¨ç±»ç»§æ‰¿ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<ol>
<li>æ€»ä½“è¯´æ¥ï¼Œç»„åˆ&#x2F;èšåˆå¤ç”¨åŸåˆ™å‘Šè¯‰æˆ‘ä»¬ï¼šç»„åˆæˆ–è€…èšåˆå¥½è¿‡äºç»§æ‰¿ã€‚</li>
<li>èšåˆç»„åˆæ˜¯ä¸€ç§ â€œé»‘ç®±â€ å¤ç”¨ï¼Œå› ä¸ºç»†èŠ‚å¯¹è±¡çš„å†…å®¹å¯¹å®¢æˆ·ç«¯æ¥è¯´æ˜¯ä¸å¯è§çš„ã€‚</li>
</ol>
<h2 id="ä¸€ã€åˆ›å»ºå‹æ¨¡å¼"><a href="#ä¸€ã€åˆ›å»ºå‹æ¨¡å¼" class="headerlink" title="ä¸€ã€åˆ›å»ºå‹æ¨¡å¼"></a>ä¸€ã€åˆ›å»ºå‹æ¨¡å¼</h2><h3 id="1ã€å•ä¾‹æ¨¡å¼"><a href="#1ã€å•ä¾‹æ¨¡å¼" class="headerlink" title="1ã€å•ä¾‹æ¨¡å¼"></a>1ã€å•ä¾‹æ¨¡å¼</h3><p><strong>è¦æ±‚</strong></p>
<ul>
<li>æŒæ¡äº”ç§å•ä¾‹æ¨¡å¼çš„å®ç°æ–¹å¼</li>
<li>ç†è§£ä¸ºä½• (åŒæ£€é”)DCL å®ç°æ—¶è¦ä½¿ç”¨ volatile ä¿®é¥°é™æ€å˜é‡</li>
<li>äº†è§£ jdk ä¸­ç”¨åˆ°å•ä¾‹çš„åœºæ™¯</li>
</ul>
<h4 id="static-é¥¿æ±‰å¼"><a href="#static-é¥¿æ±‰å¼" class="headerlink" title="static é¥¿æ±‰å¼"></a>static é¥¿æ±‰å¼</h4><ul>
<li>é¥¿æ±‰å¼å°±æ˜¯åœ¨ç±»çš„åŠ è½½é˜¶æ®µï¼Œä¼šåˆå§‹åŒ–ç±»çš„å®ä¾‹å¯¹è±¡ã€‚</li>
<li>é™æ€ä»£ç çš„æ‰§è¡Œå¤„äºç±»ç”Ÿå‘½å‘¨æœŸä¸­çš„åˆå§‹åŒ–é˜¶æ®µï¼Œç”±è™šæ‹Ÿæœºä¿è¯å…¶åŸå­ä¸”å®‰å…¨æ‰§è¡Œï¼Œæ‰€ä»¥é¥¿æ±‰å¼ä¸ä¼šæœ‰å¹¶å‘çš„é—®é¢˜ï¼Œä½†æ˜¯å­˜åœ¨èµ„æºçš„æµªè´¹ã€‚</li>
<li>é¥¿æ±‰å¼ä¸ºäº†é˜²æ­¢åå°„çš„ç ´åï¼Œè¦åœ¨æ„é€ ä¸ŠåŠ ä¸Šå¯¹å®ä¾‹çš„åˆ¤æ–­ã€‚</li>
<li>é¥¿æ±‰å¼ä¸ºäº†é˜²æ­¢ååºåˆ—åŒ–çš„ç ´åï¼Œéœ€è¦é‡å†™ readResolve æ–¹æ³•ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton1</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å•ä¾‹å¯¹è±¡ä¸èƒ½é‡å¤åˆ›å»º&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;private Singleton1()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton1</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton1</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton1 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ„é€ æ–¹æ³•æŠ›å‡ºå¼‚å¸¸æ˜¯é˜²æ­¢åå°„ç ´åå•ä¾‹</li>
<li><code>readResolve()</code> æ˜¯é˜²æ­¢ååºåˆ—åŒ–ç ´åå•ä¾‹</li>
</ul>
<h4 id="æšä¸¾é¥¿æ±‰å¼"><a href="#æšä¸¾é¥¿æ±‰å¼" class="headerlink" title="æšä¸¾é¥¿æ±‰å¼"></a>æšä¸¾é¥¿æ±‰å¼</h4><ul>
<li>æšä¸¾å®ç°ï¼ŒJVMåœ¨ç¼–è¯‘æˆå­—èŠ‚ç æ—¶ä¼šè‡ªåŠ¨çš„ç»§æ‰¿ Enum ç±»æ¥å®ç°å•åˆ—ã€‚</li>
<li>åç¼–è¯‘åï¼Œå®é™…ä¸Šæ˜¯ä½¿ç”¨ static å®šä¹‰å˜é‡ï¼Œä¹‹åé€šè¿‡å®šä¹‰ static ä»£ç å—æ¥è¿›è¡Œåˆ›å»ºã€‚</li>
<li>æšä¸¾é¥¿æ±‰å¼èƒ½å¤©ç„¶é˜²æ­¢åå°„ã€ååºåˆ—åŒ–ç ´åå•ä¾‹ï¼Œä½†æ˜¯ä¸èƒ½è§£å†³ unsafe() æ¥åˆ›å»ºå¯¹è±¡ã€‚</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Singleton2</span> &#123;</span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;private Singleton2()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getClass().getName() + <span class="string">&quot;@&quot;</span> + Integer.toHexString(hashCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton2 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ‡’æ±‰å¼"><a href="#æ‡’æ±‰å¼" class="headerlink" title="æ‡’æ±‰å¼"></a>æ‡’æ±‰å¼</h4><ul>
<li>æ‰€è°“æ‡’æ±‰å¼å°±æ˜¯åªæœ‰åœ¨è°ƒç”¨è·å–å¯¹è±¡çš„æ–¹æ³•æ—¶æ‰ä¼šåˆ›å»ºå¯¹è±¡ã€‚</li>
<li>æ‡’æ±‰å¼å­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œå¹¶ä¸èƒ½ä¿è¯åˆ›å»ºå¯¹è±¡çš„å®‰å…¨æ€§ã€‚</li>
<li>å¦‚æœç”¨ synchronized æ¥åŒæ­¥è·å–å®ä¾‹çš„æ–¹æ³•ï¼Œå°±ä¼šå½±å“å¹¶å‘çš„æ€§èƒ½ã€‚</li>
<li>å…¶å®åªæœ‰é¦–æ¬¡åˆ›å»ºå•ä¾‹å¯¹è±¡æ—¶æ‰éœ€è¦åŒæ­¥ï¼Œä½†è¯¥ä»£ç å®é™…ä¸Šæ¯æ¬¡è°ƒç”¨éƒ½ä¼šåŒæ­¥</li>
<li>å› æ­¤æœ‰äº†ä¸‹é¢çš„åŒæ£€é”æ”¹è¿›</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton3</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton3</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;private Singleton3()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton3</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Singleton3.class</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton3 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>) &#123;</span><br><span class="line">            INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton3</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åŒæ£€é”æ‡’æ±‰å¼"><a href="#åŒæ£€é”æ‡’æ±‰å¼" class="headerlink" title="åŒæ£€é”æ‡’æ±‰å¼"></a>åŒæ£€é”æ‡’æ±‰å¼</h4><p>é‡‡ç”¨åŒæ£€é”çš„æ–¹å¼ã€‚</p>
<p>ä¸ºä½•å¿…é¡»åŠ  volatileï¼š</p>
<ul>
<li><code>INSTANCE = new Singleton4()</code> ä¸æ˜¯åŸå­çš„ï¼Œåœ¨åº•å±‚çš„JVMä¸­ï¼Œåˆ†æˆ 3 æ­¥ï¼šå¼€è¾Ÿç©ºé—´ã€åˆå§‹åŒ–ã€ç»™å˜é‡èµ‹å€¼ï¼Œå…¶ä¸­åä¸¤æ­¥å¯èƒ½è¢«æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ï¼Œå˜æˆå…ˆèµ‹å€¼ã€å†åˆå§‹åŒ–ï¼Œæ¥æé«˜æ•ˆç‡ã€‚</li>
<li>å¦‚æœçº¿ç¨‹1 å…ˆæ‰§è¡Œäº†èµ‹å€¼ï¼Œçº¿ç¨‹2 æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ª <code>INSTANCE == null</code> æ—¶å‘ç° INSTANCE å·²ç»ä¸ä¸º nullï¼Œæ­¤æ—¶å°±ä¼šè¿”å›ä¸€ä¸ªæœªå®Œå…¨æ„é€ çš„å¯¹è±¡ã€‚</li>
<li>volatile å¯ä»¥ä¿è¯é™æ€çš„å˜é‡èµ‹å€¼ä¸èƒ½è¢«é‡æ’è°ƒä¼˜ï¼Œä¿è¯æ„é€ å’Œèµ‹å€¼çš„æ‰§è¡Œé¡ºåºã€‚ä½†æ˜¯è¿™æ ·å°±æŸå¤±äº†ä¸€ç‚¹ç‚¹é‡æ’ä¼˜åŒ–å¸¦æ¥çš„æ•ˆç‡ã€‚</li>
</ul>
<p>ææ‡‚ volatile çš„ä½œç”¨(å¯è§æ€§å’Œæœ‰åºæ€§)ï¼Œæœ‰åºæ€§æ˜¯é€šè¿‡å†…å­˜å±éšœæ¥å®ç°çš„ï¼Œå¯è§æ€§æ˜¯å› ä¸ºä½¿ç”¨ volatile å…³é”®å­—ï¼Œæ¯æ¬¡éƒ½ä¼šä»ä¸»å­˜ä¸­è·å–æ•°æ®ï¼Œè€Œä¸æ˜¯ CPU çš„ç¼“å­˜ä¸­ï¼Œåœ¨å†™å…¥æ—¶ä¼šç«‹å³åŒæ­¥åˆ°ä¸»å­˜ä¸­ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton4</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton4</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;private Singleton4()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">Singleton4</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// å¯è§æ€§ï¼Œæœ‰åºæ€§</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton4 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton4.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>) &#123;</span><br><span class="line">                    INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton4</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å†…éƒ¨ç±»æ‡’æ±‰å¼"><a href="#å†…éƒ¨ç±»æ‡’æ±‰å¼" class="headerlink" title="å†…éƒ¨ç±»æ‡’æ±‰å¼"></a>å†…éƒ¨ç±»æ‡’æ±‰å¼</h4><ul>
<li>é¿å…äº†åŒæ£€é”çš„ç¼ºç‚¹</li>
<li>ä½¿ç”¨å†…éƒ¨ç±»çš„æ–¹æ³•å–ä»£äº†åŒæ£€é”çš„å®ç°æ–¹å¼</li>
<li>ç¼ºç‚¹å°±æ˜¯å†…éƒ¨ç±»ä¸èƒ½ä¼ é€’å‚æ•°</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton5</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton5</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;private Singleton5()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="type">Singleton5</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton5</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton5 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Holder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CAS-AtomicReference-æ‡’æ±‰å¼"><a href="#CAS-AtomicReference-æ‡’æ±‰å¼" class="headerlink" title="CAS (AtomicReference)æ‡’æ±‰å¼"></a>CAS (AtomicReference)æ‡’æ±‰å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton6</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicReference&lt;Singleton_06&gt; INSTANCE = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;Singleton_06&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton_06</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Singleton_06 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (; ; ) &#123;</span><br><span class="line">            <span class="type">Singleton_06</span> <span class="variable">instance</span> <span class="operator">=</span> INSTANCE.get();</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> != instance) <span class="keyword">return</span> instance;</span><br><span class="line">            INSTANCE.compareAndSet(<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Singleton_06</span>());</span><br><span class="line">            <span class="keyword">return</span> INSTANCE.get();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2ã€å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#2ã€å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="2ã€å·¥å‚æ–¹æ³•æ¨¡å¼"></a>2ã€å·¥å‚æ–¹æ³•æ¨¡å¼</h3><h4 id="æ™®é€šå·¥å‚"><a href="#æ™®é€šå·¥å‚" class="headerlink" title="æ™®é€šå·¥å‚"></a>æ™®é€šå·¥å‚</h4><p>å·¥å‚æ¨¡å¼åˆç§°å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œæ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå…¶åœ¨çˆ¶ç±»ä¸­æä¾›ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ–¹æ³•ï¼Œå…è®¸å­ç±»å†³å®šå®ä¾‹åŒ–å¯¹è±¡çš„ç±»å‹ã€‚</p>
<p>è¿™ç§è®¾è®¡æ¨¡å¼ä¹Ÿæ˜¯ Java å¼€å‘ä¸­æœ€å¸¸è§çš„ä¸€ç§æ¨¡å¼ï¼Œå®ƒçš„ä¸»è¦æ„å›¾æ˜¯å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å…¶å­ç±»è‡ªå·±å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªå·¥å‚ç±»ï¼Œå·¥å‚æ¨¡å¼ä½¿å…¶åˆ›å»ºè¿‡ç¨‹å»¶è¿Ÿåˆ°å­ç±»è¿›è¡Œã€‚</p>
<p>ç®€å•è¯´å°±æ˜¯ä¸ºäº†æä¾›ä»£ç ç»“æ„çš„æ‰©å±•æ€§ï¼Œå±è”½æ¯ä¸€ä¸ªåŠŸèƒ½ç±»ä¸­çš„å…·ä½“å®ç°é€»è¾‘ã€‚è®©å¤–éƒ¨å¯ä»¥æ›´åŠ ç®€å•çš„åªæ˜¯çŸ¥é“è°ƒç”¨å³å¯ï¼ŒåŒæ—¶ï¼Œè¿™ä¹Ÿæ˜¯å»æ‰ä¼—å¤š<code>ifelse</code>çš„æ–¹å¼ã€‚å½“ç„¶è¿™å¯èƒ½ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚éœ€è¦å®ç°çš„ç±»éå¸¸å¤šï¼Œå¦‚ä½•å»ç»´æŠ¤ï¼Œæ€æ ·å‡ä½å¼€å‘æˆæœ¬ã€‚ä½†è¿™äº›é—®é¢˜éƒ½å¯ä»¥åœ¨åç»­çš„è®¾è®¡æ¨¡å¼ç»“åˆä½¿ç”¨ä¸­ï¼Œé€æ­¥é™ä½ã€‚</p>
<p>å¦‚æœè¦è®¾è®¡ä¸€ä¸ªå¤šç§ç±»å‹å•†å“å‘æ”¾çš„ä¸šåŠ¡ï¼Œé‡‡ç”¨å·¥å‚æ¨¡å¼å®ç°ï¼š</p>
<p><strong>æŠ½è±¡å‘å¥–æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICommodity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendCommodity</span><span class="params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å®ç°å¥–å“å‘æ”¾æ¥å£</strong></p>
<p><strong>ä¼˜æƒ åˆ¸</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CouponCommodityService</span> <span class="keyword">implements</span> <span class="title class_">ICommodity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(CouponCommodityService.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">CouponService</span> <span class="variable">couponService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CouponService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendCommodity</span><span class="params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">CouponResult</span> <span class="variable">couponResult</span> <span class="operator">=</span> couponService.sendCoupon(uId, commodityId, bizId);</span><br><span class="line">        logger.info(<span class="string">&quot;è¯·æ±‚å‚æ•°[ä¼˜æƒ åˆ¸] =&gt; uIdï¼š&#123;&#125; commodityIdï¼š&#123;&#125; bizIdï¼š&#123;&#125; extMapï¼š&#123;&#125;&quot;</span>, uId, commodityId, bizId, JSON.toJSON(extMap));</span><br><span class="line">        logger.info(<span class="string">&quot;æµ‹è¯•ç»“æœ[ä¼˜æƒ åˆ¸]ï¼š&#123;&#125;&quot;</span>, JSON.toJSON(couponResult));</span><br><span class="line">        <span class="keyword">if</span> (!<span class="string">&quot;0000&quot;</span>.equals(couponResult.getCode())) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(couponResult.getInfo());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å®ç‰©å•†å“</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GoodsCommodityService</span> <span class="keyword">implements</span> <span class="title class_">ICommodity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(GoodsCommodityService.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">GoodsService</span> <span class="variable">goodsService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GoodsService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendCommodity</span><span class="params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">DeliverReq</span> <span class="variable">deliverReq</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeliverReq</span>();</span><br><span class="line">        deliverReq.setUserName(queryUserName(uId));</span><br><span class="line">        deliverReq.setUserPhone(queryUserPhoneNumber(uId));</span><br><span class="line">        deliverReq.setSku(commodityId);</span><br><span class="line">        deliverReq.setOrderId(bizId);</span><br><span class="line">        deliverReq.setConsigneeUserName(extMap.get(<span class="string">&quot;consigneeUserName&quot;</span>));</span><br><span class="line">        deliverReq.setConsigneeUserPhone(extMap.get(<span class="string">&quot;consigneeUserPhone&quot;</span>));</span><br><span class="line">        deliverReq.setConsigneeUserAddress(extMap.get(<span class="string">&quot;consigneeUserAddress&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> goodsService.deliverGoods(deliverReq);</span><br><span class="line"></span><br><span class="line">        logger.info(<span class="string">&quot;è¯·æ±‚å‚æ•°[ä¼˜æƒ åˆ¸] =&gt; uIdï¼š&#123;&#125; commodityIdï¼š&#123;&#125; bizIdï¼š&#123;&#125; extMapï¼š&#123;&#125;&quot;</span>, uId, commodityId, bizId, JSON.toJSON(extMap));</span><br><span class="line">        logger.info(<span class="string">&quot;æµ‹è¯•ç»“æœ[ä¼˜æƒ åˆ¸]ï¼š&#123;&#125;&quot;</span>, isSuccess);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!isSuccess) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å®ç‰©å•†å“å‘æ”¾å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">queryUserName</span><span class="params">(String uId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;èŠ±èŠ±&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">queryUserPhoneNumber</span><span class="params">(String uId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;15200101232&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¬¬ä¸‰æ–¹å…‘æ¢å¡</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CardCommodityService</span> <span class="keyword">implements</span> <span class="title class_">ICommodity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(CardCommodityService.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿæ³¨å…¥</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">IQiYiCardService</span> <span class="variable">iQiYiCardService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IQiYiCardService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendCommodity</span><span class="params">(String uId, String commodityId, String bizId, Map&lt;String, String&gt; extMap)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">mobile</span> <span class="operator">=</span> queryUserMobile(uId);</span><br><span class="line">        iQiYiCardService.grantToken(mobile, bizId);</span><br><span class="line">        logger.info(<span class="string">&quot;è¯·æ±‚å‚æ•°[çˆ±å¥‡è‰ºå…‘æ¢å¡] =&gt; uIdï¼š&#123;&#125; commodityIdï¼š&#123;&#125; bizIdï¼š&#123;&#125; extMapï¼š&#123;&#125;&quot;</span>, uId, commodityId, bizId, JSON.toJSON(extMap));</span><br><span class="line">        logger.info(<span class="string">&quot;æµ‹è¯•ç»“æœ[çˆ±å¥‡è‰ºå…‘æ¢å¡]ï¼šsuccess&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">queryUserMobile</span><span class="params">(String uId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;15200101232&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;   </span><br></pre></td></tr></table></figure>

<p><strong>åˆ›å»ºå•†åº—å·¥å‚</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StoreFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ICommodity <span class="title function_">getCommodityService</span><span class="params">(Integer commodityType)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == commodityType) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> == commodityType) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CouponCommodityService</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">2</span> == commodityType) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GoodsCommodityService</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="number">3</span> == commodityType) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CardCommodityService</span>();</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ä¸å­˜åœ¨çš„å•†å“æœåŠ¡ç±»å‹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æŠ½è±¡å·¥å‚"><a href="#æŠ½è±¡å·¥å‚" class="headerlink" title="æŠ½è±¡å·¥å‚"></a>æŠ½è±¡å·¥å‚</h4><p>æŠ½è±¡å·¥å‚æ¨¡å¼ä¸å·¥å‚æ–¹æ³•æ¨¡å¼è™½ç„¶ä¸»è¦æ„å›¾éƒ½æ˜¯ä¸ºäº†è§£å†³ï¼Œ<strong>æ¥å£é€‰æ‹©</strong>é—®é¢˜ã€‚ä½†åœ¨å®ç°ä¸Šï¼ŒæŠ½è±¡å·¥å‚æ˜¯ä¸€ä¸ªä¸­å¿ƒå·¥å‚ï¼Œåˆ›å»ºå…¶ä»–å·¥å‚çš„æ¨¡å¼ã€‚</p>
<p>æŠ½è±¡å·¥å‚å’Œæ™®é€šå·¥å‚çš„åŒºåˆ«ï¼š</p>
<ul>
<li><p>æŠ½è±¡å·¥å‚å’Œæ™®é€šå·¥å‚çš„åŒºåˆ«ä¸»è¦åœ¨äºï¼ŒæŠ½è±¡å·¥å‚å¯ä»¥ç”Ÿäº§ä¸€ç»„ç›¸å…³æˆ–ç›¸äº’ä¾èµ–çš„äº§å“ï¼Œè€Œæ™®é€šå·¥å‚åªèƒ½ç”Ÿäº§å•ä¸€çš„äº§å“ã€‚</p>
</li>
<li><p>ä¾‹å¦‚ï¼Œå‡è®¾æœ‰ä¸€ä¸ªç”µè„‘å·¥å‚ï¼Œå®ƒå¯ä»¥ç”Ÿäº§ç”µè„‘çš„å„ç§é…ä»¶ï¼Œå¦‚CPUã€å†…å­˜ã€ç¡¬ç›˜ç­‰ã€‚å¦‚æœä½¿ç”¨æ™®é€šå·¥å‚æ¨¡å¼ï¼Œé‚£ä¹ˆæ¯ç§é…ä»¶éƒ½éœ€è¦ä¸€ä¸ªå•ç‹¬çš„å·¥å‚æ¥ç”Ÿäº§ï¼Œè¿™æ ·ä¼šå¯¼è‡´å·¥å‚ç±»è¿‡å¤šï¼Œä¸åˆ©äºç®¡ç†å’Œæ‰©å±•ã€‚</p>
</li>
<li><p>å¦‚æœä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œé‚£ä¹ˆå¯ä»¥å°†ç”µè„‘é…ä»¶æŒ‰ç…§å“ç‰Œæˆ–è€…ç±»å‹è¿›è¡Œåˆ†ç»„ï¼Œæ¯ä¸ªåˆ†ç»„å¯¹åº”ä¸€ä¸ªæŠ½è±¡å·¥å‚ï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘å·¥å‚ç±»çš„æ•°é‡ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿å¢åŠ æ–°çš„åˆ†ç»„æˆ–è€…æ–°çš„äº§å“ã€‚</p>
</li>
<li><p>ä¾‹å¦‚ï¼Œå¯ä»¥æŒ‰ç…§å“ç‰Œåˆ†ä¸ºæˆ´å°”ã€æƒ æ™®ã€è”æƒ³ç­‰æŠ½è±¡å·¥å‚ï¼Œæ¯ä¸ªæŠ½è±¡å·¥å‚å¯ä»¥ç”Ÿäº§è¯¥å“ç‰Œçš„CPUã€å†…å­˜ã€ç¡¬ç›˜ç­‰äº§å“ï¼›ä¹Ÿå¯ä»¥æŒ‰ç…§ç±»å‹åˆ†ä¸ºCPUå·¥å‚ã€å†…å­˜å·¥å‚ã€ç¡¬ç›˜å·¥å‚ç­‰æŠ½è±¡å·¥å‚ï¼Œæ¯ä¸ªæŠ½è±¡å·¥å‚å¯ä»¥ç”Ÿäº§ä¸åŒå“ç‰Œçš„åŒç±»äº§å“ã€‚</p>
</li>
</ul>
<p>ä¸šåŠ¡åœºæ™¯ï¼šä½¿ç”¨æŠ½åƒå·¥å‚æ¨¡å¼æ›¿æ¢RedisåŒé›†ç¾¤å‡çº§ï¼Œä»£ç†ç±»æŠ½è±¡åœºæ™¯ã€‚ä½¿ç”¨åˆ°äº†(é€‚é…å™¨æ¨¡å¼ï¼Œä»£ç†æ¨¡å¼ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼)</p>
<p>ä¸åŒçš„Redisé›†ç¾¤å¯èƒ½æ–¹æ³•ä¸ä¸€æ ·ï¼Œ<strong>åˆ›å»ºé€‚é…å™¨æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICacheAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">get</span><span class="params">(String key)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, String value)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, String value, <span class="type">long</span> timeout, TimeUnit timeUnit)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(String key)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å®ç°é›†ç¾¤ä½¿ç”¨æœåŠ¡</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EGMCacheAdapter</span> <span class="keyword">implements</span> <span class="title class_">ICacheAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">EGM</span> <span class="variable">egm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EGM</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> egm.gain(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        egm.set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, String value, <span class="type">long</span> timeout, TimeUnit timeUnit)</span> &#123;</span><br><span class="line">        egm.setEx(key, value, timeout, timeUnit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        egm.delete(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IIRCacheAdapter</span> <span class="keyword">implements</span> <span class="title class_">ICacheAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">IIR</span> <span class="variable">iir</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IIR</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> iir.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        iir.set(key, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(String key, String value, <span class="type">long</span> timeout, TimeUnit timeUnit)</span> &#123;</span><br><span class="line">        iir.setExpire(key, value, timeout, timeUnit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">del</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        iir.del(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å®šä¹‰æŠ½è±¡å·¥å‚ä»£ç†ç±»å’Œå®ç°</strong></p>
<p>åˆ›å»ºè·å–ä»£ç†å¯¹è±¡çš„æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getProxy</span><span class="params">(Class&lt;T&gt; interfaceClass, ICacheAdapter cacheAdapter)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JDKInvocationHandler</span>(cacheAdapter);</span><br><span class="line">    <span class="type">ClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> Thread.currentThread().getContextClassLoader();</span><br><span class="line">    Class&lt;?&gt;[] classes = interfaceClass.getInterfaces();</span><br><span class="line">    <span class="keyword">return</span> (T) Proxy.newProxyInstance(classLoader, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;classes[<span class="number">0</span>]&#125;, handler);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä»£ç†ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDKInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ICacheAdapter cacheAdapter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JDKInvocationHandler</span><span class="params">(ICacheAdapter cacheAdapter)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cacheAdapter = cacheAdapter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="keyword">return</span> ICacheAdapter.class.getMethod(method.getName(), ClassLoaderUtils.getClazzByArgs(args)).invoke(cacheAdapter, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3ã€å»ºé€ è€…æ¨¡å¼"><a href="#3ã€å»ºé€ è€…æ¨¡å¼" class="headerlink" title="3ã€å»ºé€ è€…æ¨¡å¼"></a>3ã€å»ºé€ è€…æ¨¡å¼</h3><p>å»ºé€ è€…æ¨¡å¼æ‰€å®Œæˆçš„å†…å®¹å°±æ˜¯é€šè¿‡å°†å¤šä¸ªç®€å•å¯¹è±¡é€šè¿‡ä¸€æ­¥æ­¥çš„ç»„è£…æ„å»ºå‡ºä¸€ä¸ªå¤æ‚å¯¹è±¡çš„è¿‡ç¨‹ã€‚</p>
<p>å»ºé€ è€…æ¨¡å¼ä¸»è¦çš„å®ç°æ–¹æ³•å°±æ˜¯è®© set() æ–¹æ³•è¿”å›å½“å‰å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥ä¸€ç›´ä½¿ç”¨ set() æ–¹æ³•è¿›è¡Œæ„å»ºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DecorationPackageMenu</span> <span class="keyword">implements</span> <span class="title class_">IMenu</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;Matter&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Matter&gt;();  <span class="comment">// è£…ä¿®æ¸…å•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">BigDecimal</span> <span class="variable">price</span> <span class="operator">=</span> BigDecimal.ZERO;      <span class="comment">// è£…ä¿®ä»·æ ¼</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BigDecimal area;  <span class="comment">// é¢ç§¯</span></span><br><span class="line">    <span class="keyword">private</span> String grade;     <span class="comment">// è£…ä¿®ç­‰çº§ï¼›è±ªåæ¬§å¼ã€è½»å¥¢ç”°å›­ã€ç°ä»£ç®€çº¦</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DecorationPackageMenu</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DecorationPackageMenu</span><span class="params">(Double area, String grade)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.area = <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(area);</span><br><span class="line">        <span class="built_in">this</span>.grade = grade;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> IMenu <span class="title function_">appendCeiling</span><span class="params">(Matter matter)</span> &#123;</span><br><span class="line">        list.add(matter);</span><br><span class="line">        price = price.add(area.multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.2&quot;</span>)).multiply(matter.price()));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> IMenu <span class="title function_">appendCoat</span><span class="params">(Matter matter)</span> &#123;</span><br><span class="line">        list.add(matter);</span><br><span class="line">        price = price.add(area.multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;1.4&quot;</span>)).multiply(matter.price()));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> IMenu <span class="title function_">appendFloor</span><span class="params">(Matter matter)</span> &#123;</span><br><span class="line">        list.add(matter);</span><br><span class="line">        price = price.add(area.multiply(matter.price()));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> IMenu <span class="title function_">appendTile</span><span class="params">(Matter matter)</span> &#123;</span><br><span class="line">        list.add(matter);</span><br><span class="line">        price = price.add(area.multiply(matter.price()));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4ã€åŸå‹æ¨¡å¼"><a href="#4ã€åŸå‹æ¨¡å¼" class="headerlink" title="4ã€åŸå‹æ¨¡å¼"></a>4ã€åŸå‹æ¨¡å¼</h3><ul>
<li><p>åŸå‹æ¨¡å¼æ˜¯ä¸€ç§åˆ›å»ºå‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒçš„ç›®çš„æ˜¯é€šè¿‡å¤åˆ¶ä¸€ä¸ªå·²æœ‰çš„å¯¹è±¡æ¥åˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯é€šè¿‡è°ƒç”¨æ„é€ å‡½æ•°æ¥å®ä¾‹åŒ–ã€‚</p>
</li>
<li><p>åŸå‹æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥é¿å…é‡å¤çš„åˆå§‹åŒ–æ“ä½œï¼Œæé«˜æ€§èƒ½å’Œæ•ˆç‡ï¼›ä¹Ÿå¯ä»¥é€ƒé¿æ„é€ å‡½æ•°çš„çº¦æŸï¼Œå®ç°åŠ¨æ€åˆ›å»ºå¯¹è±¡ã€‚</p>
</li>
<li><p>åŸå‹æ¨¡å¼çš„ç¼ºç‚¹æ˜¯éœ€è¦å®ç°å…‹éš†æ–¹æ³•ï¼Œè¿™å¯èƒ½ä¼šæ¯”è¾ƒå¤æ‚ï¼Œç‰¹åˆ«æ˜¯å½“å¯¹è±¡åŒ…å«å¼•ç”¨ç±»å‹çš„å±æ€§æ—¶ï¼Œéœ€è¦è€ƒè™‘æµ…æ‹·è´å’Œæ·±æ‹·è´çš„é—®é¢˜ã€‚</p>
</li>
<li><p>åŸå‹æ¨¡å¼çš„åº”ç”¨åœºæ™¯æœ‰ï¼šèµ„æºä¼˜åŒ–ï¼Œç±»åˆå§‹åŒ–æ¶ˆè€—è¾ƒå¤šèµ„æºæ—¶ï¼›æ€§èƒ½å’Œå®‰å…¨è¦æ±‚é«˜ï¼Œé€šè¿‡ new äº§ç”Ÿå¯¹è±¡éœ€è¦éå¸¸ç¹çæˆ–æƒé™å—é™æ—¶ï¼›ä¸€ä¸ªå¯¹è±¡éœ€è¦æä¾›ç»™å…¶ä»–å¯¹è±¡è®¿é—®ï¼Œä¸”å„ä¸ªè°ƒç”¨è€…å¯èƒ½ä¿®æ”¹å…¶å€¼æ—¶ã€‚</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŠ½è±¡åŸå‹ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Prototype</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    <span class="comment">//æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å®ç°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//é‡å†™clone()æ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Prototype <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Prototype</span> <span class="variable">prototype</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            prototype = (Prototype) <span class="built_in">super</span>.clone();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> prototype;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªç±»å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³• show ()ï¼Œè®©å­ç±»å®ç°ï¼›å¹¶ä¸”é‡å†™äº† clone () æ–¹æ³•ï¼Œè°ƒç”¨äº†çˆ¶ç±» Object çš„ clone () æ–¹æ³•ï¼Œæ¥å®ç°å¯¹è±¡çš„å¤åˆ¶ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸¤ä¸ªå…·ä½“çš„åŸå‹å­ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…·ä½“åŸå‹ç±»A</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcretePrototypeA</span> <span class="keyword">extends</span> <span class="title class_">Prototype</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åŸå‹A&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å…·ä½“åŸå‹ç±»B</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcretePrototypeB</span> <span class="keyword">extends</span> <span class="title class_">Prototype</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åŸå‹B&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æµ‹è¯•ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªåŸå‹Aå¯¹è±¡</span></span><br><span class="line">        <span class="type">Prototype</span> <span class="variable">prototypeA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcretePrototypeA</span>();</span><br><span class="line">        <span class="comment">//è°ƒç”¨åŸå‹Aå¯¹è±¡çš„show()æ–¹æ³•</span></span><br><span class="line">        prototypeA.show();</span><br><span class="line">        <span class="comment">//å¤åˆ¶å‡ºä¸€ä¸ªåŸå‹Aå¯¹è±¡ï¼Œå¹¶èµ‹å€¼ç»™prototypeCopyA</span></span><br><span class="line">        <span class="type">Prototype</span> <span class="variable">prototypeCopyA</span> <span class="operator">=</span> prototypeA.clone();</span><br><span class="line">        <span class="comment">//è°ƒç”¨å¤åˆ¶å‡ºçš„å¯¹è±¡çš„show()æ–¹æ³•</span></span><br><span class="line">        prototypeCopyA.show();</span><br><span class="line">        <span class="comment">//æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒ</span></span><br><span class="line">        System.out.println(prototypeA == prototypeCopyA);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åˆ›å»ºä¸€ä¸ªåŸå‹Bå¯¹è±¡</span></span><br><span class="line">        <span class="type">Prototype</span> <span class="variable">prototypeB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcretePrototypeB</span>();</span><br><span class="line">        <span class="comment">//è°ƒç”¨åŸå‹Bå¯¹è±¡çš„show()æ–¹æ³•</span></span><br><span class="line">        prototypeB.show();</span><br><span class="line">        <span class="comment">//å¤åˆ¶å‡ºä¸€ä¸ªåŸå‹Bå¯¹è±¡ï¼Œå¹¶èµ‹å€¼ç»™prototypeCopyB</span></span><br><span class="line">        <span class="type">Prototype</span> <span class="variable">prototypeCopyB</span> <span class="operator">=</span> prototypeB.clone();</span><br><span class="line">        <span class="comment">//è°ƒç”¨å¤åˆ¶å‡ºçš„å¯¹è±¡çš„show()æ–¹æ³•</span></span><br><span class="line">        prototypeCopyB.show();</span><br><span class="line">        <span class="comment">//æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸åŒ</span></span><br><span class="line">        System.out.println(prototypeB == prototypeCopyB);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªæµ‹è¯•ç±»åˆ›å»ºäº†ä¸¤ä¸ªä¸åŒç±»å‹çš„åŸå‹å¯¹è±¡ï¼Œå¹¶åˆ†åˆ«è°ƒç”¨äº†å®ƒä»¬çš„ show () æ–¹æ³•ã€‚ç„¶åï¼Œå®ƒä½¿ç”¨ clone () æ–¹æ³•å¤åˆ¶äº†ä¸¤ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¹¶å†æ¬¡è°ƒç”¨äº†å®ƒä»¬çš„ show () æ–¹æ³•ã€‚æœ€åï¼Œå®ƒæ¯”è¾ƒäº†ä¸¤å¯¹å¯¹è±¡æ˜¯å¦ç›¸åŒã€‚</p>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">åŸå‹A</span><br><span class="line">åŸå‹A</span><br><span class="line">false</span><br><span class="line">åŸå‹B</span><br><span class="line">åŸå‹B</span><br><span class="line">false</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡ clone () æ–¹æ³•å¤åˆ¶å‡ºæ¥çš„å¯¹è±¡å’ŒåŸæ¥çš„å¯¹è±¡å…·æœ‰ç›¸åŒçš„ç±»å‹å’Œè¡Œä¸ºï¼Œä½†æ˜¯å®ƒä»¬ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚è¿™å°±æ˜¯åŸå‹æ¨¡å¼çš„åŸºæœ¬ç”¨æ³•ã€‚</p>
<h2 id="äºŒã€ç»“æ„æ€§æ¨¡å¼"><a href="#äºŒã€ç»“æ„æ€§æ¨¡å¼" class="headerlink" title="äºŒã€ç»“æ„æ€§æ¨¡å¼"></a>äºŒã€ç»“æ„æ€§æ¨¡å¼</h2><h3 id="1ã€é€‚é…å™¨æ¨¡å¼"><a href="#1ã€é€‚é…å™¨æ¨¡å¼" class="headerlink" title="1ã€é€‚é…å™¨æ¨¡å¼"></a>1ã€é€‚é…å™¨æ¨¡å¼</h3><p>é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥è®©ä¸¤ä¸ªä¸å…¼å®¹çš„æ¥å£èƒ½å¤Ÿä¸€èµ·å·¥ä½œã€‚é€‚é…å™¨æ¨¡å¼çš„æ ¸å¿ƒæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œè¿™ä¸ªç±»å®ç°äº†ç›®æ ‡æ¥å£ï¼ŒåŒæ—¶æŒæœ‰è¢«é€‚é…æ¥å£çš„å¼•ç”¨ï¼Œç„¶ååœ¨ç›®æ ‡æ¥å£çš„æ–¹æ³•ä¸­è°ƒç”¨è¢«é€‚é…æ¥å£çš„æ–¹æ³•ï¼Œä»è€Œå®ç°æ¥å£è½¬æ¢ã€‚</p>
<p>é€‚é…å™¨æ¨¡å¼æœ‰ä¸‰ç§ç±»å‹ï¼šç±»é€‚é…å™¨ã€å¯¹è±¡é€‚é…å™¨å’Œæ¥å£é€‚é…å™¨ã€‚</p>
<ul>
<li><code>ç±»é€‚é…å™¨</code>æ˜¯é€šè¿‡ç»§æ‰¿è¢«é€‚é…ç±»å’Œå®ç°ç›®æ ‡æ¥å£æ¥å®ç°çš„ï¼Œè¿™ç§æ–¹å¼éœ€è¦ä¿®æ”¹è¢«é€‚é…ç±»çš„æºç ï¼Œè€Œä¸”åªèƒ½é€‚é…ä¸€ä¸ªç±»ã€‚</li>
<li><code>å¯¹è±¡é€‚é…å™¨</code>æ˜¯é€šè¿‡ç»„åˆè¢«é€‚é…å¯¹è±¡å’Œå®ç°ç›®æ ‡æ¥å£æ¥å®ç°çš„ï¼Œè¿™ç§æ–¹å¼ä¸éœ€è¦ä¿®æ”¹è¢«é€‚é…å¯¹è±¡çš„æºç ï¼Œè€Œä¸”å¯ä»¥é€‚é…å¤šä¸ªç±»ã€‚</li>
<li><code>æ¥å£é€‚é…å™¨</code>æ˜¯é€šè¿‡ç»§æ‰¿ç›®æ ‡æ¥å£å’ŒæŠ½è±¡ç±»æ¥å®ç°çš„ï¼Œè¿™ç§æ–¹å¼å¯ä»¥è®©å­ç±»åªå®ç°éœ€è¦çš„æ–¹æ³•ï¼Œè€Œä¸ç”¨å®ç°ç›®æ ‡æ¥å£çš„æ‰€æœ‰æ–¹æ³•ã€‚</li>
</ul>
<p>ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ª220vç”µå‹çš„æ’åº§ï¼Œä½†æ˜¯ä½ çš„ç¬”è®°æœ¬ç”µè„‘åªèƒ½ä½¿ç”¨20vç”µå‹ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç”µæºé€‚é…å™¨ï¼Œè¿™ä¸ªé€‚é…å™¨å®ç°äº†20vç”µå‹çš„æ¥å£ï¼ŒåŒæ—¶æŒæœ‰220vç”µå‹çš„å¯¹è±¡ï¼Œç„¶ååœ¨20vç”µå‹çš„æ–¹æ³•ä¸­è°ƒç”¨220vç”µå‹çš„æ–¹æ³•ï¼Œå¹¶è¿›è¡Œä¸€å®šçš„è½¬æ¢ï¼Œä»è€Œè®©ä½ çš„ç¬”è®°æœ¬ç”µè„‘å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>
<h4 id="ç±»é€‚é…å™¨-amp-å¯¹è±¡é€‚é…å™¨"><a href="#ç±»é€‚é…å™¨-amp-å¯¹è±¡é€‚é…å™¨" class="headerlink" title="ç±»é€‚é…å™¨&amp;å¯¹è±¡é€‚é…å™¨"></a>ç±»é€‚é…å™¨&amp;å¯¹è±¡é€‚é…å™¨</h4><p>ä¸šåŠ¡åœºæ™¯ï¼š</p>
<p>å‡è®¾æˆ‘ä»¬è¿˜æ˜¯æœ‰ä¸€ä¸ª220vç”µå‹çš„æ¥å£å’Œä¸€ä¸ª20vç”µå‹çš„æ¥å£ï¼Œä»¥åŠä¸€ä¸ª220vç”µå‹çš„å®ç°ç±»ã€‚æˆ‘ä»¬æƒ³è¦ä½¿ç”¨ä¸€ä¸ªç”µæºé€‚é…å™¨ï¼Œè®©æˆ‘ä»¬çš„ç¬”è®°æœ¬ç”µè„‘å¯ä»¥ä½¿ç”¨220vç”µå‹çš„æ’åº§ã€‚</p>
<p>220v ç”µå‹æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Voltage220V</span> &#123;</span><br><span class="line">    <span class="comment">// è¾“å‡º220vç”µå‹</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">output220V</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>220v ç”µå‹å®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Voltage220VImpl</span> <span class="keyword">implements</span> <span class="title class_">Voltage220V</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">output220V</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">voltage</span> <span class="operator">=</span> <span class="number">220</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¾“å‡º&quot;</span> + voltage + <span class="string">&quot;vç”µå‹&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> voltage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>20v ç”µå‹æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Voltage20V</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡º20vç”µå‹</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">output20V</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é€‚é…å™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Huang RD</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2023/5/7 17:57</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> ç”µæºé€‚é…å™¨ï¼Œç»§æ‰¿äº†è¢«é€‚é…ç±»ï¼ŒåŒæ—¶å®ç°äº†ç›®æ ‡æ¥å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PowerAdapter</span> <span class="keyword">extends</span> <span class="title class_">Voltage220VImpl</span> <span class="keyword">implements</span> <span class="title class_">Voltage20V</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">output20V</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">voltage</span> <span class="operator">=</span> output220V();</span><br><span class="line">        <span class="comment">// è¿›è¡Œè½¬æ¢ é€‚é…æ“ä½œ</span></span><br><span class="line">        voltage = voltage / <span class="number">11</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;è¾“å‡º&quot;</span> + voltage + <span class="string">&quot;vç”µå‹&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> voltage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">PowerAdapter</span> <span class="variable">powerAdapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PowerAdapter</span>();</span><br><span class="line">        powerAdapter.output20V(); <span class="comment">// è¾“å‡º20v</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ¥å£é€‚é…å™¨"><a href="#æ¥å£é€‚é…å™¨" class="headerlink" title="æ¥å£é€‚é…å™¨"></a>æ¥å£é€‚é…å™¨</h4><p>ä¸šåŠ¡åœºæ™¯ï¼š</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤šåŠŸèƒ½çš„æ¥å£ï¼Œå®ƒæœ‰å››ä¸ªæ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯æ‰“å°ã€æ‰«æã€å¤å°å’Œä¼ çœŸã€‚æˆ‘ä»¬æƒ³è¦å®ç°ä¸€ä¸ªåªèƒ½æ‰“å°çš„ç±»ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æƒ³å®ç°æ¥å£çš„å…¶ä»–æ–¹æ³•ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæŠ½è±¡ç±»æ¥å®ç°æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œä½†æ˜¯ä¸åšä»»ä½•æ“ä½œï¼Œç„¶åè®©å­ç±»ç»§æ‰¿è¿™ä¸ªæŠ½è±¡ç±»ï¼Œå¹¶é‡å†™éœ€è¦çš„æ–¹æ³•ã€‚</p>
<p>å¤šåŠŸèƒ½æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MultiFunction</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰“å°</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰«æ</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">scan</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤å°</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">copy</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼ çœŸ</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">fax</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠ½è±¡ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractAdapter</span> <span class="keyword">implements</span> <span class="title class_">MultiFunction</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// nothing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">scan</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// nothing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">copy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// nothing</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">fax</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// nothing</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªè¯»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrintOnly</span> <span class="keyword">extends</span> <span class="title class_">AbstractAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;print paper&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">PrintOnly</span> <span class="variable">printOnly</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintOnly</span>();</span><br><span class="line">        printOnly.print();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2ã€æ¡¥æ¥æ¨¡å¼"><a href="#2ã€æ¡¥æ¥æ¨¡å¼" class="headerlink" title="2ã€æ¡¥æ¥æ¨¡å¼"></a>2ã€æ¡¥æ¥æ¨¡å¼</h3><p><code>æ¡¥æ¥æ¨¡å¼</code>æ˜¯ä¸€ç§ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªæŠ½è±¡éƒ¨åˆ†å’Œä¸€ä¸ªå®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚æ¡¥æ¥æ¨¡å¼çš„ä¸»è¦ç›®çš„æ˜¯è§£å†³å¤šå±‚ç»§æ‰¿å¯¼è‡´çš„ç±»çˆ†ç‚¸é—®é¢˜ï¼Œä»¥åŠæŠ½è±¡å’Œå®ç°çš„è€¦åˆé—®é¢˜ã€‚</p>
<p>æ¡¥æ¥æ¨¡å¼çš„æ ¸å¿ƒæ˜¯åˆ›å»ºä¸€ä¸ªä½œä¸ºæ¡¥æ¥çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£å®šä¹‰äº†å®ç°éƒ¨åˆ†çš„åŠŸèƒ½ï¼Œç„¶åè®©æŠ½è±¡éƒ¨åˆ†æŒæœ‰è¿™ä¸ªæ¥å£çš„å¼•ç”¨ï¼Œå¹¶é€šè¿‡è¿™ä¸ªå¼•ç”¨æ¥è°ƒç”¨å®ç°éƒ¨åˆ†çš„åŠŸèƒ½ã€‚è¿™æ ·ï¼ŒæŠ½è±¡éƒ¨åˆ†å’Œå®ç°éƒ¨åˆ†å°±å¯ä»¥ç‹¬ç«‹åœ°æ‰©å±•ï¼Œè€Œä¸å½±å“å½¼æ­¤</p>
<p>ä¸šåŠ¡åœºæ™¯ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-7-02.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›å¤šç§æ”¯ä»˜å’Œæ¨¡å¼"></p>
<p>å®ç°å¤šæ”¯ä»˜å’Œå¤šæ¨¡å¼çš„èåˆã€‚</p>
<p>äº¤æ¥æ¨¡å¼æ¨¡å‹ç»“æ„ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-7-03.png" alt="æ¡¥æ¥æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>å·¦ä¾§<code>Pay</code>æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå¾€ä¸‹æ˜¯å®ƒçš„ä¸¤ä¸ªæ”¯ä»˜ç±»å‹å®ç°ï¼›å¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®æ”¯ä»˜ã€‚</li>
<li>å³ä¾§<code>IPayMode</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¾€ä¸‹æ˜¯å®ƒçš„ä¸¤ä¸ªæ”¯ä»˜æ¨¡å‹ï¼›åˆ·è„¸æ”¯ä»˜ã€æŒ‡çº¹æ”¯ä»˜ã€‚</li>
<li>é‚£ä¹ˆï¼Œ<code>æ”¯ä»˜ç±»å‹</code> Ã— <code>æ”¯ä»˜æ¨¡å‹</code> &#x3D; å°±å¯ä»¥å¾—åˆ°ç›¸åº”çš„ç»„åˆã€‚</li>
<li><strong>æ³¨æ„</strong>ï¼Œæ¯ç§æ”¯ä»˜æ–¹å¼çš„ä¸åŒï¼Œåˆ·è„¸å’ŒæŒ‡çº¹æ ¡éªŒé€»è¾‘ä¹Ÿæœ‰å·®å¼‚ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼è¿›è¡Œå¤„ç†ï¼Œè¿™é‡Œä¸æ˜¯æœ¬æ–‡é‡ç‚¹ä¸åšä»‹ç»ï¼Œå¯ä»¥çœ‹é€‚é…å™¨æ¨¡å¼ç« èŠ‚ã€‚</li>
</ul>
<p><strong>æ”¯ä»˜ç±»å‹æ¡¥æ¥æŠ½è±¡ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Pay</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(Pay.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> IPayMode payMode;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Pay</span><span class="params">(IPayMode payMode)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.payMode = payMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">transfer</span><span class="params">(String uId, String tradeId, BigDecimal amount)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨è¿™ä¸ªç±»ä¸­å®šä¹‰äº†æ”¯ä»˜æ–¹å¼çš„éœ€è¦å®ç°çš„è½¬è´¦æ¥å£ï¼š<code>transfer</code>ï¼Œä»¥åŠæ¡¥æ¥æ¥å£ï¼›<code>IPayMode</code>ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­ç”¨æˆ·æ–¹è‡ªè¡Œé€‰æ‹©æ”¯ä»˜æ–¹å¼ã€‚</li>
<li>å¦‚æœæ²¡æœ‰æ¥è§¦è¿‡æ­¤ç±»å®ç°ï¼Œå¯ä»¥é‡ç‚¹å…³æ³¨ <code>IPayMode payMode</code>ï¼Œè¿™éƒ¨åˆ†æ˜¯æ¡¥æ¥çš„æ ¸å¿ƒã€‚</li>
</ul>
<p><strong>ä¸¤ä¸ªæ”¯ä»˜ç±»å‹çš„å®ç°</strong></p>
<p>å¾®ä¿¡æ”¯ä»˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WxPay</span> <span class="keyword">extends</span> <span class="title class_">Pay</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WxPay</span><span class="params">(IPayMode payMode)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(payMode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">transfer</span><span class="params">(String uId, String tradeId, BigDecimal amount)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿå¾®ä¿¡æ¸ é“æ”¯ä»˜åˆ’è´¦å¼€å§‹ã€‚uIdï¼š&#123;&#125; tradeIdï¼š&#123;&#125; amountï¼š&#123;&#125;&quot;</span>, uId, tradeId, amount);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">security</span> <span class="operator">=</span> payMode.security(uId);</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿå¾®ä¿¡æ¸ é“æ”¯ä»˜é£æ§æ ¡éªŒã€‚uIdï¼š&#123;&#125; tradeIdï¼š&#123;&#125; securityï¼š&#123;&#125;&quot;</span>, uId, tradeId, security);</span><br><span class="line">        <span class="keyword">if</span> (!security) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;æ¨¡æ‹Ÿå¾®ä¿¡æ¸ é“æ”¯ä»˜åˆ’è´¦æ‹¦æˆªã€‚uIdï¼š&#123;&#125; tradeIdï¼š&#123;&#125; amountï¼š&#123;&#125;&quot;</span>, uId, tradeId, amount);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0001&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿå¾®ä¿¡æ¸ é“æ”¯ä»˜åˆ’è´¦æˆåŠŸã€‚uIdï¼š&#123;&#125; tradeIdï¼š&#123;&#125; amountï¼š&#123;&#125;&quot;</span>, uId, tradeId, amount);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0000&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ”¯ä»˜å®æ”¯ä»˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZfbPay</span> <span class="keyword">extends</span> <span class="title class_">Pay</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ZfbPay</span><span class="params">(IPayMode payMode)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(payMode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">transfer</span><span class="params">(String uId, String tradeId, BigDecimal amount)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿæ”¯ä»˜å®æ¸ é“æ”¯ä»˜åˆ’è´¦å¼€å§‹ã€‚uIdï¼š&#123;&#125; tradeIdï¼š&#123;&#125; amountï¼š&#123;&#125;&quot;</span>, uId, tradeId, amount);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">security</span> <span class="operator">=</span> payMode.security(uId);</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿæ”¯ä»˜å®æ¸ é“æ”¯ä»˜é£æ§æ ¡éªŒã€‚uIdï¼š&#123;&#125; tradeIdï¼š&#123;&#125; securityï¼š&#123;&#125;&quot;</span>, uId, tradeId, security);</span><br><span class="line">        <span class="keyword">if</span> (!security) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;æ¨¡æ‹Ÿæ”¯ä»˜å®æ¸ é“æ”¯ä»˜åˆ’è´¦æ‹¦æˆªã€‚uIdï¼š&#123;&#125; tradeIdï¼š&#123;&#125; amountï¼š&#123;&#125;&quot;</span>, uId, tradeId, amount);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0001&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿæ”¯ä»˜å®æ¸ é“æ”¯ä»˜åˆ’è´¦æˆåŠŸã€‚uIdï¼š&#123;&#125; tradeIdï¼š&#123;&#125; amountï¼š&#123;&#125;&quot;</span>, uId, tradeId, amount);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;0000&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å®šä¹‰æ”¯ä»˜æ¨¡å¼æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IPayMode</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">security</span><span class="params">(String uId)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¸‰ç§æ”¯ä»˜æ¨¡å¼é£æ§(åˆ·è„¸ã€æŒ‡çº¹ã€å¯†ç )</strong></p>
<p>åˆ·è„¸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayFaceMode</span> <span class="keyword">implements</span> <span class="title class_">IPayMode</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(PayCypher.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">security</span><span class="params">(String uId)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;äººè„¸æ”¯ä»˜ï¼Œé£æ§æ ¡éªŒè„¸éƒ¨è¯†åˆ«&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŒ‡çº¹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayFingerprintMode</span> <span class="keyword">implements</span> <span class="title class_">IPayMode</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(PayCypher.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">security</span><span class="params">(String uId)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æŒ‡çº¹æ”¯ä»˜ï¼Œé£æ§æ ¡éªŒæŒ‡çº¹ä¿¡æ¯&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯†ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayCypher</span> <span class="keyword">implements</span> <span class="title class_">IPayMode</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(PayCypher.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">security</span><span class="params">(String uId)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;å¯†ç æ”¯ä»˜ï¼Œé£æ§æ ¡éªŒç¯å¢ƒå®‰å…¨&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_pay</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;\r\næ¨¡æ‹Ÿæµ‹è¯•åœºæ™¯ï¼›å¾®ä¿¡æ”¯ä»˜ã€äººè„¸æ–¹å¼ã€‚&quot;</span>);</span><br><span class="line">    <span class="type">Pay</span> <span class="variable">wxPay</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WxPay</span>(<span class="keyword">new</span> <span class="title class_">PayFaceMode</span>());</span><br><span class="line">    wxPay.transfer(<span class="string">&quot;weixin_1092033111&quot;</span>, <span class="string">&quot;100000109893&quot;</span>, <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;\r\næ¨¡æ‹Ÿæµ‹è¯•åœºæ™¯ï¼›æ”¯ä»˜å®æ”¯ä»˜ã€æŒ‡çº¹æ–¹å¼ã€‚&quot;</span>);</span><br><span class="line">    <span class="type">Pay</span> <span class="variable">zfbPay</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZfbPay</span>(<span class="keyword">new</span> <span class="title class_">PayFingerprintMode</span>());</span><br><span class="line">    zfbPay.transfer(<span class="string">&quot;jlu19dlxo111&quot;</span>,<span class="string">&quot;100000109894&quot;</span>,<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="number">100</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3ã€ç»„åˆæ¨¡å¼"><a href="#3ã€ç»„åˆæ¨¡å¼" class="headerlink" title="3ã€ç»„åˆæ¨¡å¼"></a>3ã€ç»„åˆæ¨¡å¼</h3><p>ç»„åˆæ¨¡å¼å¯ä»¥è®©æœåŠ¡ç»„èŠ‚ç‚¹è¿›è¡Œè‡ªç”±ç»„åˆå¯¹å¤–æä¾›æœåŠ¡ï¼Œä¾‹å¦‚æœ‰ä¸‰ä¸ªåŸå­æ ¡éªŒåŠŸèƒ½(<code>Aï¼šèº«ä»½è¯</code>ã€<code>Bï¼šé“¶è¡Œå¡</code>ã€<code>Cï¼šæ‰‹æœºå·</code>)æœåŠ¡å¹¶å¯¹å¤–æä¾›è°ƒç”¨ä½¿ç”¨ã€‚æœ‰äº›è°ƒç”¨æ–¹éœ€è¦ä½¿ç”¨ABç»„åˆï¼Œæœ‰äº›è°ƒç”¨æ–¹éœ€è¦ä½¿ç”¨åˆ°CBAç»„åˆï¼Œè¿˜æœ‰ä¸€äº›å¯èƒ½åªä½¿ç”¨ä¸‰è€…ä¸­çš„ä¸€ä¸ªã€‚é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä½ å°±å¯ä»¥ä½¿ç”¨ç»„åˆæ¨¡å¼è¿›è¡Œæ„å»ºæœåŠ¡ï¼Œå¯¹äºä¸åŒç±»å‹çš„è°ƒç”¨æ–¹é…ç½®ä¸åŒçš„ç»„ç»‡å…³ç³»æ ‘ï¼Œè€Œè¿™ä¸ªæ ‘ç»“æ„ä½ å¯ä»¥é…ç½®åˆ°æ•°æ®åº“ä¸­ä¹Ÿå¯ä»¥ä¸æ–­çš„é€šè¿‡å›¾å½¢ç•Œé¢æ¥æ§åˆ¶æ ‘ç»“æ„ã€‚</p>
<p>ä¸šåŠ¡åœºæ™¯ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-8-02.png" alt="åœºæ™¯æ¨¡å¼ï¼›è¥é”€å†³ç­–æ ‘"></p>
<p>ä»¥ä¸Šæ˜¯ä¸€ä¸ªéå¸¸ç®€åŒ–ç‰ˆçš„è¥é”€è§„åˆ™<code>å†³ç­–æ ‘</code>ï¼Œæ ¹æ®<code>æ€§åˆ«</code>ã€<code>å¹´é¾„</code>æ¥å‘æ”¾ä¸åŒç±»å‹çš„ä¼˜æƒ åˆ¸ï¼Œæ¥åˆºæ¿€æ¶ˆè´¹èµ·åˆ°ç²¾å‡†ç”¨æˆ·ä¿ƒæ´»çš„ç›®çš„ã€‚</p>
<p>æ ¹æ®æ¡ä»¶ï¼Œé€‰æ‹©å†³ç­–ç»“æœã€‚</p>
<p>ä¸ç”¨è®¾è®¡æ¨¡å¼ï¼Œä»£ç å¦‚ä¸‹ã€‚åœ¨ååºè¦æ±‚ä¸Šï¼Œè¦ä¸æ–­æ·»åŠ  <code>if else</code> ç»´æŠ¤æˆæœ¬é«˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EngineController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(EngineController.class);</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">process</span><span class="params">(<span class="keyword">final</span> String userId, <span class="keyword">final</span> String userSex, <span class="keyword">final</span> <span class="type">int</span> userAge)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;ifelseå®ç°æ–¹å¼åˆ¤æ–­ç”¨æˆ·ç»“æœã€‚userIdï¼š&#123;&#125; userSexï¼š&#123;&#125; userAgeï¼š&#123;&#125;&quot;</span>, userId, userSex, userAge);</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;man&quot;</span>.equals(userSex)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (userAge &lt; <span class="number">25</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;æœå®A&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (userAge &gt;= <span class="number">25</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;æœå®B&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;woman&quot;</span>.equals(userSex)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (userAge &lt; <span class="number">25</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;æœå®C&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (userAge &gt;= <span class="number">25</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;æœå®D&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> <strong>ä½¿ç”¨ç»„åˆæ¨¡å¼ä¿®æ”¹</strong>ã€‚</p>
<p>æ¨¡å‹ç»“æ„ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-8-03.png" alt="ç»„åˆæ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<p><strong>æ ‘èŠ‚ç‚¹é€»è¾‘è¿‡æ»¤æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LogicFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€»è¾‘å†³ç­–å™¨</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> matterValue          å†³ç­–å€¼</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> treeNodeLineInfoList å†³ç­–èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ä¸‹ä¸€ä¸ªèŠ‚ç‚¹Id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    Long <span class="title function_">filter</span><span class="params">(String matterValue, List&lt;TreeNodeLink&gt; treeNodeLineInfoList)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å†³ç­–å€¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> decisionMatter å†³ç­–ç‰©æ–™</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> å†³ç­–å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String <span class="title function_">matterValue</span><span class="params">(Long treeId, String userId, Map&lt;String, String&gt; decisionMatter)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰äº†é€‚é…çš„é€šç”¨æ¥å£ï¼Œé€»è¾‘å†³ç­–å™¨ã€è·å–å†³ç­–å€¼ï¼Œè®©æ¯ä¸€ä¸ªæä¾›å†³ç­–èƒ½åŠ›çš„èŠ‚ç‚¹éƒ½å¿…é¡»å®ç°æ­¤æ¥å£ï¼Œä¿è¯ç»Ÿä¸€æ€§ã€‚</p>
<p><strong>å†³ç­–æŠ½è±¡ç±»æä¾›åŸºç¡€æœåŠ¡</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BaseLogic</span> <span class="keyword">implements</span> <span class="title class_">LogicFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Long <span class="title function_">filter</span><span class="params">(String matterValue, List&lt;TreeNodeLink&gt; treeNodeLinkList)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (TreeNodeLink nodeLine : treeNodeLinkList) &#123;</span><br><span class="line">            <span class="keyword">if</span> (decisionLogic(matterValue, nodeLine)) <span class="keyword">return</span> nodeLine.getNodeIdTo();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> String <span class="title function_">matterValue</span><span class="params">(Long treeId, String userId, Map&lt;String, String&gt; decisionMatter)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">decisionLogic</span><span class="params">(String matterValue, TreeNodeLink nodeLink)</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (nodeLink.getRuleLimitType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> matterValue.equals(nodeLink.getRuleLimitValue());</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">return</span> Double.parseDouble(matterValue) &gt; Double.parseDouble(nodeLink.getRuleLimitValue());</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">return</span> Double.parseDouble(matterValue) &lt; Double.parseDouble(nodeLink.getRuleLimitValue());</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                <span class="keyword">return</span> Double.parseDouble(matterValue) &lt;= Double.parseDouble(nodeLink.getRuleLimitValue());</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                <span class="keyword">return</span> Double.parseDouble(matterValue) &gt;= Double.parseDouble(nodeLink.getRuleLimitValue());</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨æŠ½è±¡æ–¹æ³•ä¸­å®ç°äº†æ¥å£æ–¹æ³•ï¼ŒåŒæ—¶å®šä¹‰äº†åŸºæœ¬çš„å†³ç­–æ–¹æ³•ï¼›<code>1ã€2ã€3ã€4ã€5</code>ï¼Œ<code>ç­‰äºã€å°äºã€å¤§äºã€å°äºç­‰äºã€å¤§äºç­‰äº</code>çš„åˆ¤æ–­é€»è¾‘ã€‚</li>
<li>åŒæ—¶å®šä¹‰äº†æŠ½è±¡æ–¹æ³•ï¼Œè®©æ¯ä¸€ä¸ªå®ç°æ¥å£çš„ç±»éƒ½å¿…é¡»æŒ‰ç…§è§„åˆ™æä¾›<code>å†³ç­–å€¼</code>ï¼Œè¿™ä¸ªå†³ç­–å€¼ç”¨äºåšé€»è¾‘æ¯”å¯¹ã€‚</li>
</ul>
<p><strong>æ ‘èŠ‚ç‚¹é€»è¾‘å®ç°ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¹´é¾„èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserAgeFilter</span> <span class="keyword">extends</span> <span class="title class_">BaseLogic</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">matterValue</span><span class="params">(Long treeId, String userId, Map&lt;String, String&gt; decisionMatter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> decisionMatter.get(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ€§åˆ«èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserGenderFilter</span> <span class="keyword">extends</span> <span class="title class_">BaseLogic</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">matterValue</span><span class="params">(Long treeId, String userId, Map&lt;String, String&gt; decisionMatter)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> decisionMatter.get(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»¥ä¸Šä¸¤ä¸ªå†³ç­–é€»è¾‘çš„èŠ‚ç‚¹è·å–å€¼çš„æ–¹å¼éƒ½éå¸¸ç®€å•ï¼Œåªæ˜¯è·å–ç”¨æˆ·çš„å…¥å‚å³å¯ã€‚å®é™…çš„ä¸šåŠ¡å¼€å‘å¯ä»¥ä»æ•°æ®åº“ã€RPCæ¥å£ã€ç¼“å­˜è¿ç®—ç­‰å„ç§æ–¹å¼è·å–ã€‚</li>
</ul>
<p><strong>å†³ç­–å¼•æ“æ¥å£å®šä¹‰</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IEngine</span> &#123;</span><br><span class="line"></span><br><span class="line">    EngineResult <span class="title function_">process</span><span class="params">(<span class="keyword">final</span> Long treeId, <span class="keyword">final</span> String userId, TreeRich treeRich, <span class="keyword">final</span> Map&lt;String, String&gt; decisionMatter)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å¯¹äºä½¿ç”¨æ–¹æ¥è¯´ä¹ŸåŒæ ·éœ€è¦å®šä¹‰ç»Ÿä¸€çš„æ¥å£æ“ä½œï¼Œè¿™æ ·çš„å¥½å¤„éå¸¸æ–¹ä¾¿åç»­æ‹“å±•å‡ºä¸åŒç±»å‹çš„å†³ç­–å¼•æ“ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å»ºé€ ä¸åŒçš„å†³ç­–å·¥å‚ã€‚</li>
</ul>
<p>å†³ç­–èŠ‚ç‚¹çš„é…ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EngineConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Map&lt;String, LogicFilter&gt; logicFilterMap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        logicFilterMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">        logicFilterMap.put(<span class="string">&quot;userAge&quot;</span>, <span class="keyword">new</span> <span class="title class_">UserAgeFilter</span>());</span><br><span class="line">        logicFilterMap.put(<span class="string">&quot;userGender&quot;</span>, <span class="keyword">new</span> <span class="title class_">UserGenderFilter</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, LogicFilter&gt; <span class="title function_">getLogicFilterMap</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> logicFilterMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLogicFilterMap</span><span class="params">(Map&lt;String, LogicFilter&gt; logicFilterMap)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.logicFilterMap = logicFilterMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨è¿™é‡Œå°†å¯æä¾›æœåŠ¡çš„å†³ç­–èŠ‚ç‚¹é…ç½®åˆ°<code>map</code>ç»“æ„ä¸­ï¼Œå¯¹äºè¿™æ ·çš„<code>map</code>ç»“æ„å¯ä»¥æŠ½å–åˆ°æ•°æ®åº“ä¸­ï¼Œé‚£ä¹ˆå°±å¯ä»¥éå¸¸æ–¹ä¾¿çš„ç®¡ç†ã€‚</li>
</ul>
<p>åŸºç¡€å†³ç­–å¼•æ“é…ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">EngineBase</span> <span class="keyword">extends</span> <span class="title class_">EngineConfig</span> <span class="keyword">implements</span> <span class="title class_">IEngine</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(EngineBase.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> EngineResult <span class="title function_">process</span><span class="params">(Long treeId, String userId, TreeRich treeRich, Map&lt;String, String&gt; decisionMatter)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> TreeNode <span class="title function_">engineDecisionMaker</span><span class="params">(TreeRich treeRich, Long treeId, String userId, Map&lt;String, String&gt; decisionMatter)</span> &#123;</span><br><span class="line">        <span class="type">TreeRoot</span> <span class="variable">treeRoot</span> <span class="operator">=</span> treeRich.getTreeRoot();</span><br><span class="line">        Map&lt;Long, TreeNode&gt; treeNodeMap = treeRich.getTreeNodeMap();</span><br><span class="line">        <span class="comment">// è§„åˆ™æ ‘æ ¹ID</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">rootNodeId</span> <span class="operator">=</span> treeRoot.getTreeRootNodeId();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">treeNodeInfo</span> <span class="operator">=</span> treeNodeMap.get(rootNodeId);</span><br><span class="line">        <span class="comment">//èŠ‚ç‚¹ç±»å‹[NodeType]ï¼›1å­å¶ã€2æœå®</span></span><br><span class="line">        <span class="keyword">while</span> (treeNodeInfo.getNodeType().equals(<span class="number">1</span>)) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">ruleKey</span> <span class="operator">=</span> treeNodeInfo.getRuleKey();</span><br><span class="line">            <span class="type">LogicFilter</span> <span class="variable">logicFilter</span> <span class="operator">=</span> logicFilterMap.get(ruleKey);</span><br><span class="line">            <span class="type">String</span> <span class="variable">matterValue</span> <span class="operator">=</span> logicFilter.matterValue(treeId, userId, decisionMatter);</span><br><span class="line">            <span class="type">Long</span> <span class="variable">nextNode</span> <span class="operator">=</span> logicFilter.filter(matterValue, treeNodeInfo.getTreeNodeLinkList());</span><br><span class="line">            treeNodeInfo = treeNodeMap.get(nextNode);</span><br><span class="line">            logger.info(<span class="string">&quot;å†³ç­–æ ‘å¼•æ“=&gt;&#123;&#125; userIdï¼š&#123;&#125; treeIdï¼š&#123;&#125; treeNodeï¼š&#123;&#125; ruleKeyï¼š&#123;&#125; matterValueï¼š&#123;&#125;&quot;</span>, treeRoot.getTreeName(), userId, treeId, treeNodeInfo.getTreeNodeId(), ruleKey, matterValue);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> treeNodeInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™é‡Œä¸»è¦æä¾›å†³ç­–æ ‘æµç¨‹çš„å¤„ç†è¿‡ç¨‹ï¼Œæœ‰ç‚¹åƒé€šè¿‡é“¾è·¯çš„å…³ç³»(<code>æ€§åˆ«</code>ã€<code>å¹´é¾„</code>)åœ¨äºŒå‰æ ‘ä¸­å¯»æ‰¾æœå®èŠ‚ç‚¹çš„è¿‡ç¨‹ã€‚</li>
<li>åŒæ—¶æä¾›ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œæ‰§è¡Œå†³ç­–æµç¨‹çš„æ–¹æ³•ä¾›å¤–éƒ¨å»åšå…·ä½“çš„å®ç°ã€‚</li>
</ul>
<p><strong>å†³ç­–å¼•æ“çš„å®ç°</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeEngineHandle</span> <span class="keyword">extends</span> <span class="title class_">EngineBase</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> EngineResult <span class="title function_">process</span><span class="params">(Long treeId, String userId, TreeRich treeRich, Map&lt;String, String&gt; decisionMatter)</span> &#123;</span><br><span class="line">        <span class="comment">// å†³ç­–æµç¨‹</span></span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">treeNode</span> <span class="operator">=</span> engineDecisionMaker(treeRich, treeId, userId, decisionMatter);</span><br><span class="line">        <span class="comment">// å†³ç­–ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EngineResult</span>(userId, treeId, treeNode.getTreeNodeId(), treeNode.getNodeValue());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4ã€è£…é¥°å™¨æ¨¡å¼"><a href="#4ã€è£…é¥°å™¨æ¨¡å¼" class="headerlink" title="4ã€è£…é¥°å™¨æ¨¡å¼"></a>4ã€è£…é¥°å™¨æ¨¡å¼</h3><p>è£…é¥°å™¨çš„æ ¸å¿ƒå°±æ˜¯<strong>åœ¨ä¸æ”¹åŸæœ‰ç±»çš„åŸºç¡€ä¸Šç»™ç±»æ–°å¢åŠŸèƒ½</strong>ã€‚</p>
<p><strong>ä¸æ”¹å˜åŸæœ‰ç±»</strong>ï¼Œé€šè¿‡ç»§æ‰¿ã€AOPåˆ‡é¢ï¼Œå½“ç„¶è¿™äº›æ–¹å¼éƒ½å¯ä»¥å®ç°ï¼Œä½†æ˜¯ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ä¼šæ˜¯å¦å¤–ä¸€ç§æ€è·¯æ›´ä¸ºçµæ´»ï¼Œå¯ä»¥é¿å…ç»§æ‰¿å¯¼è‡´çš„å­ç±»è¿‡å¤šï¼Œä¹Ÿå¯ä»¥é¿å…AOPå¸¦æ¥çš„å¤æ‚æ€§ã€‚</p>
<p>ä¸šåŠ¡åœºæ™¯ï¼šSSO å•ç‚¹ç™»å½•åŠŸèƒ½æ‹“å±•ï¼Œå¢åŠ æ‹¦æˆªç”¨æˆ·è®¿é—®æ–¹æ³•èŒƒå›´åœºæ™¯</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-9-02.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›å•ç‚¹ç™»å½•åŠŸèƒ½æ‰©å±•"></p>
<p>ä¸€èˆ¬ä½¿ç”¨çš„ä½¿ç”¨çš„<code>SSO</code>æ˜¯ä¸€ä¸ªç»„ä»¶åŒ–é€šç”¨çš„æœåŠ¡ï¼Œä¸èƒ½åœ¨é‡Œé¢æ·»åŠ éœ€è¦çš„ç”¨æˆ·è®¿é—®éªŒè¯åŠŸèƒ½ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼ï¼Œæ‰©å……åŸæœ‰çš„å•ç‚¹ç™»å½•æœåŠ¡ã€‚ä½†åŒæ—¶ä¹Ÿä¿è¯åŸæœ‰åŠŸèƒ½ä¸å—ç ´åï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨ã€‚</p>
<ul>
<li>è¿™é‡Œæ¨¡æ‹Ÿçš„æ˜¯springä¸­çš„ç±»ï¼š<code>HandlerInterceptor</code>ï¼Œå®ç°æ¥å£åŠŸèƒ½<code>SsoInterceptor</code>æ¨¡æ‹Ÿçš„å•ç‚¹ç™»å½•æ‹¦æˆªæœåŠ¡ã€‚</li>
<li>ä¸ºäº†é¿å…å¼•å…¥å¤ªå¤šspringçš„å†…å®¹å½±å“å¯¹è®¾è®¡æ¨¡å¼çš„é˜…è¯»ï¼Œè¿™é‡Œä½¿ç”¨äº†åŒåçš„ç±»å’Œæ–¹æ³•ï¼Œå°½å¯èƒ½å‡å°‘å¤–éƒ¨çš„ä¾èµ–ã€‚</li>
</ul>
<p>æ¨¡æ‹Ÿ Spring çš„ HandlerInterceptor</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(String request, String response, Object handler)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¨¡æ‹Ÿå•ç‚¹ç™»å½•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SsoInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(String request, String response, Object handler)</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿè·å–cookie</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ticket</span> <span class="operator">=</span> request.substring(<span class="number">1</span>, <span class="number">8</span>);</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ ¡éªŒ</span></span><br><span class="line">        <span class="keyword">return</span> ticket.equals(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">&#125;                                                                                                       </span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™é‡Œçš„æ¨¡æ‹Ÿå®ç°éå¸¸ç®€å•åªæ˜¯æˆªå–å­—ç¬¦ä¸²ï¼Œå®é™…ä½¿ç”¨éœ€è¦ä»<code>HttpServletRequest request</code>å¯¹è±¡ä¸­è·å–<code>cookie</code>ä¿¡æ¯ï¼Œè§£æ<code>ticket</code>å€¼åšæ ¡éªŒã€‚</li>
<li>åœ¨è¿”å›çš„é‡Œé¢ä¹Ÿéå¸¸ç®€å•ï¼Œåªè¦è·å–åˆ°äº†<code>success</code>å°±è®¤ä¸ºæ˜¯å…è®¸ç™»å½•ã€‚</li>
</ul>
<p>é€šè¿‡ç»§æ‰¿çš„ä¸€èˆ¬å®ç°æ–¹å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginSsoDecorator</span> <span class="keyword">extends</span> <span class="title class_">SsoInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; authMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        authMap.put(<span class="string">&quot;huahua&quot;</span>, <span class="string">&quot;queryUserInfo&quot;</span>);</span><br><span class="line">        authMap.put(<span class="string">&quot;doudou&quot;</span>, <span class="string">&quot;queryUserInfo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(String request, String response, Object handler)</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿè·å–cookie</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">ticket</span> <span class="operator">=</span> request.substring(<span class="number">1</span>, <span class="number">8</span>);</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ ¡éªŒ</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> ticket.equals(<span class="string">&quot;success&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!success) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> request.substring(<span class="number">9</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> authMap.get(userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ–¹æ³•æ ¡éªŒ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;queryUserInfo&quot;</span>.equals(method);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»¥ä¸Šè¿™éƒ¨åˆ†é€šè¿‡ç»§æ‰¿é‡å†™æ–¹æ³•ï¼Œå°†ä¸ªäººå¯è®¿é—®å“ªäº›æ–¹æ³•çš„åŠŸèƒ½æ·»åŠ åˆ°æ–¹æ³•ä¸­ã€‚</li>
<li>ä»¥ä¸Šçœ‹ç€ä»£ç è¿˜ç®—æ¯”è¾ƒæ¸…æ™°ï¼Œä½†å¦‚æœæ˜¯æ¯”è¾ƒå¤æ‚çš„ä¸šåŠ¡æµç¨‹ä»£ç ï¼Œå°±ä¼šå¾ˆæ··ä¹±ã€‚</li>
</ul>
<p>ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼é‡æ„ä»£ç ï¼š</p>
<p>è£…é¥°å™¨ä¸»è¦è§£å†³çš„æ˜¯ç›´æ¥ç»§æ‰¿ä¸‹å› åŠŸèƒ½çš„ä¸æ–­æ¨ªå‘æ‰©å±•å¯¼è‡´å­ç±»è†¨èƒ€çš„é—®é¢˜ï¼Œè€Œæ˜¯ç”¨è£…é¥°å™¨æ¨¡å¼åå°±ä¼šæ¯”ç›´æ¥ç»§æ‰¿æ˜¾å¾—æ›´åŠ çµæ´»åŒæ—¶è¿™æ ·ä¹Ÿå°±ä¸å†éœ€è¦è€ƒè™‘å­ç±»çš„ç»´æŠ¤ã€‚</p>
<p>åœ¨è£…é¥°å™¨æ¨¡å¼ä¸­æœ‰å››ä¸ªæ¯”è¾ƒé‡è¦ç‚¹æŠ½è±¡å‡ºæ¥çš„ç‚¹ï¼›</p>
<ol>
<li>æŠ½è±¡æ„ä»¶è§’è‰²(Component) - <code>å®šä¹‰æŠ½è±¡æ¥å£</code></li>
<li>å…·ä½“æ„ä»¶è§’è‰²(ConcreteComponent) - <code>å®ç°æŠ½è±¡æ¥å£ï¼Œå¯ä»¥æ˜¯ä¸€ç»„</code></li>
<li>è£…é¥°è§’è‰²(Decorator) - <code>å®šä¹‰æŠ½è±¡ç±»å¹¶ç»§æ‰¿æ¥å£ä¸­çš„æ–¹æ³•ï¼Œä¿è¯ä¸€è‡´æ€§</code></li>
<li>å…·ä½“è£…é¥°è§’è‰²(ConcreteDecorator) - <code>æ‰©å±•è£…é¥°å…·ä½“çš„å®ç°é€»è¾‘</code></li>
</ol>
<p>é€šè¿‡ä»¥ä¸Šè¿™å››é¡¹æ¥å®ç°è£…é¥°å™¨æ¨¡å¼ï¼Œä¸»è¦æ ¸å¿ƒå†…å®¹ä¼šä½“ç°åœ¨æŠ½è±¡ç±»çš„å®šä¹‰å’Œå®ç°ä¸Šã€‚</p>
<p>æ¨¡å‹ç»“æ„ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-9-03.png" alt="è£…é¥°å™¨æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>ä»¥ä¸Šæ˜¯ä¸€ä¸ªè£…é¥°å™¨å®ç°çš„ç±»å›¾ç»“æ„ï¼Œé‡ç‚¹çš„ç±»æ˜¯<code>SsoDecorator</code>ï¼Œè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ä¸»è¦å®Œæˆäº†å¯¹æ¥å£<code>HandlerInterceptor</code>ç»§æ‰¿ã€‚</li>
<li>å½“è£…é¥°è§’è‰²ç»§æ‰¿æ¥å£åä¼šæä¾›æ„é€ å‡½æ•°ï¼Œå…¥å‚å°±æ˜¯ç»§æ‰¿çš„æ¥å£å®ç°ç±»å³å¯ï¼Œè¿™æ ·å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰©å±•å‡ºä¸åŒåŠŸèƒ½ç»„ä»¶ã€‚</li>
</ul>
<p>æŠ½è±¡ç±»è£…é¥°è§’è‰²ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">SsoDecorator</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> HandlerInterceptor handlerInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SsoDecorator</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SsoDecorator</span><span class="params">(HandlerInterceptor handlerInterceptor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.handlerInterceptor = handlerInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(String request, String response, Object handler)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> handlerInterceptor.preHandle(request, response, handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨è£…é¥°ç±»ä¸­æœ‰ä¸¤ä¸ªé‡ç‚¹çš„åœ°æ–¹æ˜¯ï¼›1)ç»§æ‰¿äº†å¤„ç†æ¥å£ã€2)æä¾›äº†æ„é€ å‡½æ•°ã€3)è¦†ç›–äº†æ–¹æ³•<code>preHandle</code>ã€‚</li>
<li>ä»¥ä¸Šä¸‰ä¸ªç‚¹æ˜¯è£…é¥°å™¨æ¨¡å¼çš„æ ¸å¿ƒå¤„ç†éƒ¨åˆ†ï¼Œè¿™æ ·å¯ä»¥è¸¢æ‰å¯¹å­ç±»ç»§æ‰¿çš„æ–¹å¼å®ç°é€»è¾‘åŠŸèƒ½æ‰©å±•ã€‚</li>
</ul>
<p>è£…é¥°å™¨è§’è‰²é€»è¾‘å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginSsoDecorator</span> <span class="keyword">extends</span> <span class="title class_">SsoDecorator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LoginSsoDecorator.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; authMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        authMap.put(<span class="string">&quot;huahua&quot;</span>, <span class="string">&quot;queryUserInfo&quot;</span>);</span><br><span class="line">        authMap.put(<span class="string">&quot;doudou&quot;</span>, <span class="string">&quot;queryUserInfo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginSsoDecorator</span><span class="params">(HandlerInterceptor handlerInterceptor)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(handlerInterceptor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(String request, String response, Object handler)</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> <span class="built_in">super</span>.preHandle(request, response, handler);</span><br><span class="line">        <span class="keyword">if</span> (!success) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> request.substring(<span class="number">8</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> authMap.get(userId);</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿå•ç‚¹ç™»å½•æ–¹æ³•è®¿é—®æ‹¦æˆªæ ¡éªŒï¼š&#123;&#125; &#123;&#125;&quot;</span>, userId, method);</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ–¹æ³•æ ¡éªŒ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;queryUserInfo&quot;</span>.equals(method);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨å…·ä½“çš„è£…é¥°ç±»å®ç°ä¸­ï¼Œç»§æ‰¿äº†è£…é¥°ç±»<code>SsoDecorator</code>ï¼Œé‚£ä¹ˆç°åœ¨å°±å¯ä»¥æ‰©å±•æ–¹æ³•ï¼›<code>preHandle</code></li>
<li>åœ¨<code>preHandle</code>çš„å®ç°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåªå…³å¿ƒæ‰©å±•éƒ¨åˆ†çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¸ä¼šå½±å“åŸæœ‰ç±»çš„æ ¸å¿ƒæœåŠ¡ï¼Œä¹Ÿä¸ä¼šå› ä¸ºä½¿ç”¨ç»§æ‰¿æ–¹å¼è€Œå¯¼è‡´çš„å¤šä½™å­ç±»ï¼Œå¢åŠ äº†æ•´ä½“çš„çµæ´»æ€§ã€‚</li>
</ul>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>ä½¿ç”¨è£…é¥°å™¨æ¨¡å¼æ»¡è¶³å•ä¸€èŒè´£åŸåˆ™ï¼Œä½ å¯ä»¥åœ¨è‡ªå·±çš„è£…é¥°ç±»ä¸­å®ŒæˆåŠŸèƒ½é€»è¾‘çš„æ‰©å±•ï¼Œè€Œä¸å½±å“ä¸»ç±»ï¼ŒåŒæ—¶å¯ä»¥æŒ‰éœ€åœ¨è¿è¡Œæ—¶æ·»åŠ å’Œåˆ é™¤è¿™éƒ¨åˆ†é€»è¾‘ã€‚å¦å¤–è£…é¥°å™¨æ¨¡å¼ä¸ç»§æ‰¿çˆ¶ç±»é‡å†™æ–¹æ³•ï¼Œåœ¨æŸäº›æ—¶å€™éœ€è¦æŒ‰éœ€é€‰æ‹©ï¼Œå¹¶ä¸ä¸€å®šæŸä¸€ä¸ªå°±æ˜¯æœ€å¥½ã€‚</li>
<li>è£…é¥°å™¨å®ç°çš„é‡ç‚¹æ˜¯å¯¹æŠ½è±¡ç±»ç»§æ‰¿æ¥å£æ–¹å¼çš„ä½¿ç”¨ï¼ŒåŒæ—¶è®¾å®šè¢«ç»§æ‰¿çš„æ¥å£å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’å…¶å®ç°ç±»ï¼Œç”±æ­¤å¢åŠ æ‰©å±•æ€§å¹¶é‡å†™æ–¹æ³•é‡Œå¯ä»¥å®ç°æ­¤éƒ¨åˆ†çˆ¶ç±»å®ç°çš„åŠŸèƒ½ã€‚</li>
<li>å°±åƒå¤å¤©çƒ­ä½ ç©¿çŸ­è£¤ï¼Œå†¬å¤©å†·ä½ ç©¿æ£‰è£¤ï¼Œé›¨å¤©æŒ¨æµ‡ä½ ç©¿é›¨è¡£ä¸€æ ·ï¼Œä½ çš„æ ¹æœ¬æœ¬èº«æ²¡æœ‰è¢«æ”¹å˜ï¼Œè€Œä½ çš„éœ€æ±‚å´è¢«ä¸åŒçš„è£…é¥°è€Œå®ç°ã€‚ç”Ÿæ´»ä¸­å¾€å¾€æ¯”æ¯”çš†æ˜¯è®¾è®¡ï¼Œå½“ä½ å¯ä»¥èåˆè¿™éƒ¨åˆ†æ´»çµæ´»ç°çš„ä¾‹å­åˆ°ä»£ç å®ç°ä¸­ï¼Œå¾€å¾€ä¼šåˆ›é€ å‡ºæ›´åŠ ä¼˜é›…çš„å®ç°æ–¹å¼ã€‚</li>
</ul>
<h3 id="5ã€å¤–è§‚æ¨¡å¼"><a href="#5ã€å¤–è§‚æ¨¡å¼" class="headerlink" title="5ã€å¤–è§‚æ¨¡å¼"></a>5ã€å¤–è§‚æ¨¡å¼</h3><p>å¤–è§‚æ¨¡å¼ä¹Ÿå«é—¨é¢æ¨¡å¼ï¼Œä¸»è¦è§£å†³çš„æ˜¯é™ä½è°ƒç”¨æ–¹çš„ä½¿ç”¨æ¥å£çš„å¤æ‚é€»è¾‘ç»„åˆã€‚è¿™æ ·è°ƒç”¨æ–¹ä¸å®é™…çš„æ¥å£æä¾›æ–¹æä¾›æ–¹æä¾›äº†ä¸€ä¸ªä¸­é—´å±‚ï¼Œç”¨äºåŒ…è£…é€»è¾‘æä¾›APIæ¥å£ã€‚æœ‰äº›æ—¶å€™å¤–è§‚æ¨¡å¼ä¹Ÿè¢«ç”¨åœ¨ä¸­é—´ä»¶å±‚ï¼Œå¯¹æœåŠ¡ä¸­çš„é€šç”¨æ€§å¤æ‚é€»è¾‘è¿›è¡Œä¸­é—´ä»¶å±‚åŒ…è£…ï¼Œè®©ä½¿ç”¨æ–¹å¯ä»¥åªå…³å¿ƒä¸šåŠ¡å¼€å‘ã€‚</p>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼š</p>
<p>ç»™æœåŠ¡æ¥å£åŠ ä¸Šç™½åå•ã€‚</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-10-02.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›æ‰€æœ‰æœåŠ¡æ·»åŠ ç™½åå•æ ¡éªŒ"></p>
<p>å®šä¹‰åŸºç¡€çš„æŸ¥è¯¢æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorldController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * keyï¼šéœ€è¦ä»å…¥å‚å–å€¼çš„å±æ€§å­—æ®µï¼Œå¦‚æœæ˜¯å¯¹è±¡åˆ™ä»å¯¹è±¡ä¸­å–å€¼ï¼Œå¦‚æœæ˜¯å•ä¸ªå€¼åˆ™ç›´æ¥ä½¿ç”¨</span></span><br><span class="line"><span class="comment">     * returnJsonï¼šé¢„è®¾æ‹¦æˆªæ—¶è¿”å›å€¼ï¼Œæ˜¯è¿”å›å¯¹è±¡çš„Json</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * http://localhost:8080/api/queryUserInfo?userId=1001</span></span><br><span class="line"><span class="comment">     * http://localhost:8080/api/queryUserInfo?userId=å°å›¢å›¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestMapping(path = &quot;/api/queryUserInfo&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> UserInfo <span class="title function_">queryUserInfo</span><span class="params">(<span class="meta">@RequestParam</span> String userId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserInfo</span>(<span class="string">&quot;è™«è™«:&quot;</span> + userId, <span class="number">19</span>, <span class="string">&quot;å¤©æ´¥å¸‚å—å¼€åŒºæ—®æ—¯èƒ¡åŒ100å·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™é‡Œæä¾›äº†ä¸€ä¸ªåŸºæœ¬çš„æŸ¥è¯¢æœåŠ¡ï¼Œé€šè¿‡å…¥å‚<code>userId</code>ï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ã€‚åç»­å°±éœ€è¦åœ¨è¿™é‡Œæ‰©å±•ç™½åå•ï¼Œåªæœ‰æŒ‡å®šç”¨æˆ·æ‰å¯ä»¥æŸ¥è¯¢ï¼Œå…¶ä»–ç”¨æˆ·ä¸èƒ½æŸ¥è¯¢ã€‚</li>
</ul>
<p>ä½¿ç”¨å¤–è§‚å™¨æ¨¡å¼æ¥è¿›è¡Œä»£ç ä¼˜åŒ–ï¼Œä¹Ÿç®—æ˜¯ä¸€æ¬¡å¾ˆå°çš„é‡æ„ã€‚</p>
<p>è¿™æ¬¡é‡æ„çš„æ ¸å¿ƒæ˜¯ä½¿ç”¨å¤–è§‚æ¨¡å¼ä¹Ÿå¯ä»¥è¯´é—¨é¢æ¨¡å¼ï¼Œç»“åˆ<code>SpringBoot</code>ä¸­çš„è‡ªå®šä¹‰<code>starter</code>ä¸­é—´ä»¶å¼€å‘çš„æ–¹å¼ï¼Œç»Ÿä¸€å¤„ç†æ‰€æœ‰éœ€è¦ç™½åå•çš„åœ°æ–¹ã€‚</p>
<p>åç»­æ¥ä¸‹æ¥çš„å®ç°ä¸­ï¼Œä¼šæ¶‰åŠçš„çŸ¥è¯†ï¼›</p>
<ol>
<li>SpringBootçš„starterä¸­é—´ä»¶å¼€å‘æ–¹å¼ã€‚</li>
<li>é¢å‘åˆ‡é¢ç¼–ç¨‹å’Œè‡ªå®šä¹‰æ³¨è§£çš„ä½¿ç”¨ã€‚</li>
<li>å¤–éƒ¨è‡ªå®šä¹‰é…ç½®ä¿¡æ¯çš„é€ä¼ ï¼ŒSpringBootä¸Springä¸åŒï¼Œå¯¹äºæ­¤ç±»æ–¹å¼è·å–ç™½åå•é…ç½®å­˜åœ¨å·®å¼‚ã€‚</li>
</ol>
<p>ç»“æ„ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-10-03.png" alt="é—¨é¢æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>ä»¥ä¸Šæ˜¯å¤–è§‚æ¨¡å¼çš„ä¸­é—´ä»¶å®ç°æ€è·¯ï¼Œå³ä¾§æ˜¯ä¸ºäº†è·å–é…ç½®æ–‡ä»¶ï¼Œå·¦ä¾§æ˜¯å¯¹äºåˆ‡é¢çš„å¤„ç†ã€‚</li>
<li>é—¨é¢æ¨¡å¼å¯ä»¥æ˜¯å¯¹æ¥å£çš„åŒ…è£…æä¾›å‡ºæ¥å£æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹é€»è¾‘çš„åŒ…è£…é€šè¿‡è‡ªå®šä¹‰æ³¨è§£å¯¹æ¥å£æä¾›æœåŠ¡èƒ½åŠ›ã€‚</li>
</ul>
<p>æœåŠ¡ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StarterService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userStr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StarterService</span><span class="params">(String userStr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userStr = userStr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] split(String separatorChar) &#123;</span><br><span class="line">        <span class="keyword">return</span> StringUtils.split(<span class="built_in">this</span>.userStr, separatorChar);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»¥ä¸Šç±»çš„å†…å®¹è¾ƒç®€å•åªæ˜¯ä¸ºäº†è·å–é…ç½®ä¿¡æ¯ã€‚</li>
</ul>
<p>é…ç½®ç±»æ³¨è§£å®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;itstack.door&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StarterServiceProperties</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userStr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUserStr</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userStr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserStr</span><span class="params">(String userStr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userStr = userStr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ç”¨äºå®šä¹‰å¥½åç»­åœ¨ <code>application.yml</code> ä¸­æ·»åŠ  <code>itstack.door</code> çš„é…ç½®ä¿¡æ¯ã€‚</li>
</ul>
<p>è‡ªå®šä¹‰é…ç½®ç±»ä¿¡æ¯è·å–</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(StarterService.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(StarterServiceProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StarterAutoConfigure</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StarterServiceProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty(prefix = &quot;itstack.door&quot;, value = &quot;enabled&quot;, havingValue = &quot;true&quot;)</span></span><br><span class="line">    StarterService <span class="title function_">starterService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">StarterService</span>(properties.getUserStr());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»¥ä¸Šä»£ç æ˜¯å¯¹é…ç½®çš„è·å–æ“ä½œï¼Œä¸»è¦æ˜¯å¯¹æ³¨è§£çš„å®šä¹‰ï¼›<code>@Configuration</code>ã€<code>@ConditionalOnClass</code>ã€<code>@EnableConfigurationProperties</code>ï¼Œè¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯ä¸SpringBootçš„ç»“åˆä½¿ç”¨ã€‚</li>
</ul>
<p>åˆ‡é¢æ³¨è§£å®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> DoDoor &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">key</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">returnJson</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å®šä¹‰äº†å¤–è§‚æ¨¡å¼é—¨é¢æ³¨è§£ï¼Œåç»­å°±æ˜¯æ­¤æ³¨è§£æ·»åŠ åˆ°éœ€è¦æ‰©å±•ç™½åå•çš„æ–¹æ³•ä¸Šã€‚</li>
<li>è¿™é‡Œæä¾›äº†ä¸¤ä¸ªå…¥å‚ï¼Œ<strong>key</strong>ï¼šè·å–æŸä¸ªå­—æ®µä¾‹å¦‚ç”¨æˆ·IDã€<strong>returnJson</strong>ï¼šç¡®å®šç™½åå•æ‹¦æˆªåè¿”å›çš„å…·ä½“å†…å®¹ã€‚</li>
</ul>
<p>ç™½åå•åˆ‡ç‰‡é€»è¾‘</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoJoinPoint</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(DoJoinPoint.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StarterService starterService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(org.itstack.demo.design.door.annotation.DoDoor)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aopPoint</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;aopPoint()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doRouter</span><span class="params">(ProceedingJoinPoint jp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//è·å–å†…å®¹</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> getMethod(jp);</span><br><span class="line">        <span class="type">DoDoor</span> <span class="variable">door</span> <span class="operator">=</span> method.getAnnotation(DoDoor.class);</span><br><span class="line">        <span class="comment">//è·å–å­—æ®µå€¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">keyValue</span> <span class="operator">=</span> getFiledValue(door.key(), jp.getArgs());</span><br><span class="line">        logger.info(<span class="string">&quot;itstack door handler methodï¼š&#123;&#125; valueï¼š&#123;&#125;&quot;</span>, method.getName(), keyValue);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == keyValue || <span class="string">&quot;&quot;</span>.equals(keyValue)) <span class="keyword">return</span> jp.proceed();</span><br><span class="line">        <span class="comment">//é…ç½®å†…å®¹</span></span><br><span class="line">        String[] split = starterService.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="comment">//ç™½åå•è¿‡æ»¤</span></span><br><span class="line">        <span class="keyword">for</span> (String str : split) &#123;</span><br><span class="line">            <span class="keyword">if</span> (keyValue.equals(str)) &#123;</span><br><span class="line">                <span class="keyword">return</span> jp.proceed();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ‹¦æˆª</span></span><br><span class="line">        <span class="keyword">return</span> returnObject(door, method);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Method <span class="title function_">getMethod</span><span class="params">(JoinPoint jp)</span> <span class="keyword">throws</span> NoSuchMethodException &#123;</span><br><span class="line">        <span class="type">Signature</span> <span class="variable">sig</span> <span class="operator">=</span> jp.getSignature();</span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">methodSignature</span> <span class="operator">=</span> (MethodSignature) sig;</span><br><span class="line">        <span class="keyword">return</span> getClass(jp).getMethod(methodSignature.getName(), methodSignature.getParameterTypes());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Class&lt;? <span class="keyword">extends</span> <span class="title class_">Object</span>&gt; getClass(JoinPoint jp) <span class="keyword">throws</span> NoSuchMethodException &#123;</span><br><span class="line">        <span class="keyword">return</span> jp.getTarget().getClass();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è¿”å›å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">returnObject</span><span class="params">(DoDoor doGate, Method method)</span> <span class="keyword">throws</span> IllegalAccessException, InstantiationException &#123;</span><br><span class="line">        Class&lt;?&gt; returnType = method.getReturnType();</span><br><span class="line">        <span class="type">String</span> <span class="variable">returnJson</span> <span class="operator">=</span> doGate.returnJson();</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(returnJson)) &#123;</span><br><span class="line">            <span class="keyword">return</span> returnType.newInstance();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> JSON.parseObject(returnJson, returnType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è·å–å±æ€§å€¼</span></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getFiledValue</span><span class="params">(String filed, Object[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">filedValue</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">for</span> (Object arg : args) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == filedValue || <span class="string">&quot;&quot;</span>.equals(filedValue)) &#123;</span><br><span class="line">                    filedValue = BeanUtils.getProperty(arg, filed);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                <span class="keyword">if</span> (args.length == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> args[<span class="number">0</span>].toString();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> filedValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™é‡ŒåŒ…æ‹¬çš„å†…å®¹è¾ƒå¤šï¼Œæ ¸å¿ƒé€»è¾‘ä¸»è¦æ˜¯ï¼›<code>Object doRouter(ProceedingJoinPoint jp)</code>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ†åˆ«ä»‹ç»ã€‚</li>
</ul>
<p><strong>@Pointcut(â€œ@annotation(org.itstack.demo.design.door.annotation.DoDoor)â€)</strong></p>
<p>å®šä¹‰åˆ‡é¢ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯æ³¨è§£è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„åŠ å…¥è¿™ä¸ªæ³¨è§£çš„æ–¹æ³•éƒ½ä¼šè¢«åˆ‡é¢è¿›è¡Œç®¡ç†ã€‚</p>
<p><strong>getFiledValue</strong></p>
<p>è·å–æŒ‡å®škeyä¹Ÿå°±æ˜¯è·å–å…¥å‚ä¸­çš„æŸä¸ªå±æ€§ï¼Œè¿™é‡Œä¸»è¦æ˜¯è·å–ç”¨æˆ·IDï¼Œé€šè¿‡IDè¿›è¡Œæ‹¦æˆªæ ¡éªŒã€‚</p>
<p><strong>returnObject</strong></p>
<p>è¿”å›æ‹¦æˆªåçš„è½¬æ¢å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å½“éç™½åå•ç”¨æˆ·è®¿é—®æ—¶åˆ™è¿”å›ä¸€äº›æç¤ºä¿¡æ¯ã€‚</p>
<p><strong>doRouter</strong></p>
<p>åˆ‡é¢æ ¸å¿ƒé€»è¾‘ï¼Œè¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯åˆ¤æ–­å½“å‰è®¿é—®çš„ç”¨æˆ·IDæ˜¯å¦ç™½åå•ç”¨æˆ·ï¼Œå¦‚æœæ˜¯åˆ™æ”¾è¡Œ<code>jp.proceed();</code>ï¼Œå¦åˆ™è¿”å›è‡ªå®šä¹‰çš„æ‹¦æˆªæç¤ºä¿¡æ¯ã€‚</p>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>ä»¥ä¸Šæˆ‘ä»¬é€šè¿‡ä¸­é—´ä»¶çš„æ–¹å¼å®ç°å¤–è§‚æ¨¡å¼ï¼Œè¿™æ ·çš„è®¾è®¡å¯ä»¥å¾ˆå¥½çš„å¢å¼ºä»£ç çš„éš”ç¦»æ€§ï¼Œä»¥åŠå¤ç”¨æ€§ï¼Œä¸ä»…ä½¿ç”¨ä¸Šéå¸¸çµæ´»ä¹Ÿé™ä½äº†æ¯ä¸€ä¸ªç³»ç»Ÿéƒ½å¼€å‘è¿™æ ·çš„æœåŠ¡å¸¦æ¥çš„é£é™©ã€‚</li>
<li>å¯èƒ½ç›®å‰ä½ çœ‹è¿™åªæ˜¯éå¸¸ç®€å•çš„ç™½åå•æ§åˆ¶ï¼Œæ˜¯å¦éœ€è¦è¿™æ ·çš„å¤„ç†ã€‚ä½†å¾€å¾€ä¸€ä¸ªå°å°çš„å¼€å§‹ä¼šå½±å“ç€åç»­æ— é™çš„æ‰©å±•ï¼Œå®é™…çš„ä¸šåŠ¡å¼€å‘å¾€å¾€ä¹Ÿè¦å¤æ‚çš„å¾ˆå¤šï¼Œä¸å¯èƒ½å¦‚æ­¤ç®€å•ã€‚å› è€Œä½¿ç”¨è®¾è®¡æ¨¡å¼æ¥è®©ä»£ç ç»“æ„æ›´åŠ å¹²å‡€æ•´æ´ã€‚</li>
</ul>
<h3 id="6ã€äº«å…ƒæ¨¡å¼"><a href="#6ã€äº«å…ƒæ¨¡å¼" class="headerlink" title="6ã€äº«å…ƒæ¨¡å¼"></a>6ã€äº«å…ƒæ¨¡å¼</h3><p>äº«å…ƒæ¨¡å¼ï¼Œä¸»è¦åœ¨äºå…±äº«é€šç”¨å¯¹è±¡ï¼Œå‡å°‘å†…å­˜çš„ä½¿ç”¨ï¼Œæå‡ç³»ç»Ÿçš„è®¿é—®æ•ˆç‡ã€‚è€Œè¿™éƒ¨åˆ†å…±äº«å¯¹è±¡é€šå¸¸æ¯”è¾ƒè€—è´¹å†…å­˜æˆ–è€…éœ€è¦æŸ¥è¯¢å¤§é‡æ¥å£æˆ–è€…ä½¿ç”¨æ•°æ®åº“èµ„æºï¼Œå› æ­¤ç»Ÿä¸€æŠ½ç¦»ä½œä¸ºå…±äº«å¯¹è±¡ä½¿ç”¨ã€‚</p>
<p>å¦å¤–äº«å…ƒæ¨¡å¼å¯ä»¥åˆ†ä¸ºåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œä¸€èˆ¬äº’è”ç½‘H5å’ŒWebåœºæ™¯ä¸‹å¤§éƒ¨åˆ†æ•°æ®éƒ½éœ€è¦æœåŠ¡ç«¯è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± çš„ä½¿ç”¨ã€å¤šçº¿ç¨‹çº¿ç¨‹æ± çš„ä½¿ç”¨ï¼Œé™¤äº†è¿™äº›åŠŸèƒ½å¤–ï¼Œè¿˜æœ‰äº›éœ€è¦æœåŠ¡ç«¯è¿›è¡ŒåŒ…è£…åçš„å¤„ç†ä¸‹å‘ç»™å®¢æˆ·ç«¯ï¼Œå› ä¸ºæœåŠ¡ç«¯éœ€è¦åšäº«å…ƒå¤„ç†ã€‚ä½†åœ¨ä¸€äº›æ¸¸æˆåœºæ™¯ä¸‹ï¼Œå¾ˆå¤šéƒ½æ˜¯å®¢æˆ·ç«¯éœ€è¦è¿›è¡Œæ¸²æŸ“åœ°å›¾æ•ˆæœï¼Œæ¯”å¦‚ï¼›æ ‘æœ¨ã€èŠ±è‰ã€é±¼è™«ï¼Œé€šè¿‡è®¾ç½®ä¸åŒå…ƒç´ æè¿°ä½¿ç”¨äº«å…ƒå…¬ç”¨å¯¹è±¡ï¼Œå‡å°‘å†…å­˜çš„å ç”¨ï¼Œè®©å®¢æˆ·ç«¯çš„æ¸¸æˆæ›´åŠ æµç•…ã€‚</p>
<p>åœ¨äº«å…ƒæ¨¡å‹çš„å®ç°ä¸­éœ€è¦ä½¿ç”¨åˆ°äº«å…ƒå·¥å‚æ¥è¿›è¡Œç®¡ç†è¿™éƒ¨åˆ†ç‹¬ç«‹çš„å¯¹è±¡å’Œå…±äº«çš„å¯¹è±¡ï¼Œé¿å…å‡ºç°çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</p>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-11-02.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›ç§’æ€åœºæ™¯ä¸‹å•†å“æŸ¥è¯¢"></p>
<p>æ¨¡æ‹Ÿç§’æ€åœºæ™¯</p>
<p>æ¨¡æ‹Ÿä½¿ç”¨äº«å…ƒæ¨¡å¼å·¥å‚ç»“æ„ï¼Œæä¾›æ´»åŠ¨å•†å“çš„æŸ¥è¯¢ã€‚æ´»åŠ¨å•†å“ç›¸å½“äºä¸å˜çš„ä¿¡æ¯ï¼Œè€Œåº“å­˜éƒ¨åˆ†å±äºå˜åŒ–çš„ä¿¡æ¯ã€‚</p>
<p>å±å±±ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Activity <span class="title function_">queryActivityInfo</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿä»å®é™…ä¸šåŠ¡åº”ç”¨ä»æ¥å£ä¸­è·å–æ´»åŠ¨ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Activity</span> <span class="variable">activity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Activity</span>();</span><br><span class="line">        activity.setId(<span class="number">10001L</span>);</span><br><span class="line">        activity.setName(<span class="string">&quot;å›¾ä¹¦å—¨ä¹&quot;</span>);</span><br><span class="line">        activity.setDesc(<span class="string">&quot;å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ&quot;</span>);</span><br><span class="line">        activity.setStartTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        activity.setStopTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        activity.setStock(<span class="keyword">new</span> <span class="title class_">Stock</span>(<span class="number">1000</span>,<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> activity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æœ€å¼€å§‹çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ•°æ®åº“å¯ä»¥æŠ—ä½å¹¶å‘çš„è´­ç‰©é‡ã€‚</li>
<li>ä¹‹åä¸šåŠ¡å‘å±•æ‹“å±•çš„ä»£ç äº¤ç»™rediså¤„ç†</li>
</ul>
<p><strong>ä½¿ç”¨äº«å…ƒæ¨¡å¼</strong></p>
<p>äº«å…ƒæ¨¡å¼ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨æ­¤ç»“æ„åœ¨å¹³æ—¶çš„å¼€å‘ä¸­å¹¶ä¸å¤ªå¤šï¼Œé™¤äº†ä¸€äº›çº¿ç¨‹æ± ã€æ•°æ®åº“è¿æ¥æ± å¤–ï¼Œå†å°±æ˜¯æ¸¸æˆåœºæ™¯ä¸‹çš„åœºæ™¯æ¸²æŸ“ã€‚å¦å¤–è¿™ä¸ªè®¾è®¡çš„æ¨¡å¼æ€æƒ³æ˜¯å‡å°‘å†…å­˜çš„ä½¿ç”¨æå‡æ•ˆç‡ï¼Œä¸æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„<strong>åŸå‹æ¨¡å¼</strong>é€šè¿‡å…‹éš†å¯¹è±¡çš„æ–¹å¼ç”Ÿæˆå¤æ‚å¯¹è±¡ï¼Œå‡å°‘rpcçš„è°ƒç”¨ï¼Œéƒ½æ˜¯æ­¤ç±»æ€æƒ³ã€‚</p>
<p><strong>äº«å…ƒæ¨¡å¼ç»“æ„</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-11-03.png" alt="äº«å…ƒæ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>æ¨¡æ‹ŸæŸ¥è¯¢æ´»åŠ¨åœºæ™¯çš„ç±»å›¾ç»“æ„ï¼Œå·¦ä¾§æ„å»ºçš„æ˜¯äº«å…ƒå·¥å‚ï¼Œæä¾›å›ºå®šæ´»åŠ¨æ•°æ®çš„æŸ¥è¯¢ï¼Œå³ä¾§æ˜¯Rediså­˜æ”¾çš„åº“å­˜æ•°æ®ã€‚</li>
<li>æœ€ç»ˆäº¤ç»™æ´»åŠ¨æ§åˆ¶ç±»æ¥å¤„ç†æŸ¥è¯¢æ“ä½œï¼Œå¹¶æä¾›æ´»åŠ¨çš„æ‰€æœ‰ä¿¡æ¯å’Œåº“å­˜ã€‚å› ä¸ºåº“å­˜æ˜¯å˜åŒ–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨¡æ‹Ÿçš„<code>RedisUtils</code>ä¸­è®¾ç½®äº†å®šæ—¶ä»»åŠ¡ä½¿ç”¨åº“å­˜</li>
</ul>
<p>æ´»åŠ¨ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Activity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;        <span class="comment">// æ´»åŠ¨ID</span></span><br><span class="line">    <span class="keyword">private</span> String name;    <span class="comment">// æ´»åŠ¨åç§°</span></span><br><span class="line">    <span class="keyword">private</span> String desc;    <span class="comment">// æ´»åŠ¨æè¿°</span></span><br><span class="line">    <span class="keyword">private</span> Date startTime; <span class="comment">// å¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> Date stopTime;  <span class="comment">// ç»“æŸæ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> Stock stock;    <span class="comment">// æ´»åŠ¨åº“å­˜</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...get/set</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åº“å­˜ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Stock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> total; <span class="comment">// åº“å­˜æ€»é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> used;  <span class="comment">// åº“å­˜å·²ç”¨</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...get/set</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>äº«å…ƒå·¥å‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> Map&lt;Long, Activity&gt; activityMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Long, Activity&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Activity <span class="title function_">getActivity</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Activity</span> <span class="variable">activity</span> <span class="operator">=</span> activityMap.get(id);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == activity) &#123;</span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿä»å®é™…ä¸šåŠ¡åº”ç”¨ä»æ¥å£ä¸­è·å–æ´»åŠ¨ä¿¡æ¯</span></span><br><span class="line">            activity = <span class="keyword">new</span> <span class="title class_">Activity</span>();</span><br><span class="line">            activity.setId(<span class="number">10001L</span>);</span><br><span class="line">            activity.setName(<span class="string">&quot;å›¾ä¹¦å—¨ä¹&quot;</span>);</span><br><span class="line">            activity.setDesc(<span class="string">&quot;å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ&quot;</span>);</span><br><span class="line">            activity.setStartTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            activity.setStopTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">            activityMap.put(id, activity);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> activity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™é‡Œæä¾›çš„æ˜¯ä¸€ä¸ªäº«å…ƒå·¥å‚ğŸ­ï¼Œé€šè¿‡<code>map</code>ç»“æ„å­˜æ”¾å·²ç»ä»åº“è¡¨æˆ–è€…æ¥å£ä¸­æŸ¥è¯¢åˆ°çš„æ•°æ®ï¼Œå­˜æ”¾åˆ°å†…å­˜ä¸­ï¼Œç”¨äºä¸‹æ¬¡å¯ä»¥ç›´æ¥è·å–ã€‚</li>
<li>è¿™æ ·çš„ç»“æ„ä¸€èˆ¬åœ¨æˆ‘ä»¬çš„ç¼–ç¨‹å¼€å‘ä¸­è¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰äº›æ—¶å€™ä¸ºäº†åˆ†å¸ƒå¼çš„è·å–ï¼Œä¼šæŠŠæ•°æ®å­˜æ”¾åˆ°redisä¸­ï¼Œå¯ä»¥æŒ‰éœ€é€‰æ‹©ã€‚</li>
</ul>
<p>æ¨¡æ‹Ÿreids</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">ScheduledExecutorService</span> <span class="variable">scheduledExecutorService</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">AtomicInteger</span> <span class="variable">stock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RedisUtils</span><span class="params">()</span> &#123;</span><br><span class="line">        scheduledExecutorService.scheduleAtFixedRate(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// æ¨¡æ‹Ÿåº“å­˜æ¶ˆè€—</span></span><br><span class="line">            stock.addAndGet(<span class="number">1</span>);</span><br><span class="line">        &#125;, <span class="number">0</span>, <span class="number">100000</span>, TimeUnit.MICROSECONDS);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getStockUsed</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stock.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ´»åŠ¨æ§åˆ¶ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">RedisUtils</span> <span class="variable">redisUtils</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RedisUtils</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Activity <span class="title function_">queryActivityInfo</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Activity</span> <span class="variable">activity</span> <span class="operator">=</span> ActivityFactory.getActivity(id);</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿä»Redisä¸­è·å–åº“å­˜å˜åŒ–ä¿¡æ¯</span></span><br><span class="line">        <span class="type">Stock</span> <span class="variable">stock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Stock</span>(<span class="number">1000</span>, redisUtils.getStockUsed());</span><br><span class="line">        activity.setStock(stock);</span><br><span class="line">        <span class="keyword">return</span> activity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨æ´»åŠ¨æ§åˆ¶ç±»ä¸­ä½¿ç”¨äº†äº«å…ƒå·¥å‚è·å–æ´»åŠ¨ä¿¡æ¯ï¼ŒæŸ¥è¯¢åå°†åº“å­˜ä¿¡æ¯åœ¨è¡¥å……ä¸Šã€‚å› ä¸ºåº“å­˜ä¿¡æ¯æ˜¯å˜åŒ–çš„ï¼Œè€Œæ´»åŠ¨ä¿¡æ¯æ˜¯å›ºå®šä¸å˜çš„ã€‚</li>
<li>æœ€ç»ˆé€šè¿‡ç»Ÿä¸€çš„æ§åˆ¶ç±»å°±å¯ä»¥æŠŠå®Œæ•´åŒ…è£…åçš„æ´»åŠ¨ä¿¡æ¯è¿”å›ç»™è°ƒç”¨æ–¹ã€‚</li>
</ul>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>å…³äºäº«å…ƒæ¨¡å¼çš„è®¾è®¡å¯ä»¥ç€é‡å­¦ä¹ äº«å…ƒå·¥å‚çš„è®¾è®¡ï¼Œåœ¨ä¸€äº›æœ‰å¤§é‡é‡å¤å¯¹è±¡å¯å¤ç”¨çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨æ­¤åœºæ™¯åœ¨æœåŠ¡ç«¯å‡å°‘æ¥å£çš„è°ƒç”¨ï¼Œåœ¨å®¢æˆ·ç«¯å‡å°‘å†…å­˜çš„å ç”¨ã€‚æ˜¯è¿™ä¸ªè®¾è®¡æ¨¡å¼çš„ä¸»è¦åº”ç”¨æ–¹å¼ã€‚</li>
<li>å¦å¤–é€šè¿‡<code>map</code>ç»“æ„çš„ä½¿ç”¨æ–¹å¼ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ä¸€ä¸ªå›ºå®šidæ¥å­˜æ”¾å’Œè·å–å¯¹è±¡ï¼Œæ˜¯éå¸¸å…³é”®çš„ç‚¹ã€‚è€Œä¸”ä¸åªæ˜¯åœ¨äº«å…ƒæ¨¡å¼ä¸­ä½¿ç”¨ï¼Œä¸€äº›å…¶ä»–å·¥å‚æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ã€ç»„åˆæ¨¡å¼ä¸­éƒ½å¯ä»¥é€šè¿‡mapç»“æ„å­˜æ”¾æœåŠ¡ä¾›å¤–éƒ¨è·å–ï¼Œå‡å°‘ifelseçš„åˆ¤æ–­ä½¿ç”¨ã€‚</li>
<li>å½“ç„¶é™¤äº†è¿™ç§è®¾è®¡çš„å‡å°‘å†…å­˜çš„ä½¿ç”¨ä¼˜ç‚¹å¤–ï¼Œä¹Ÿæœ‰å®ƒå¸¦æ¥çš„ç¼ºç‚¹ï¼Œåœ¨ä¸€äº›å¤æ‚çš„ä¸šåŠ¡å¤„ç†åœºæ™¯ï¼Œå¾ˆä¸å®¹æ˜“åŒºåˆ†å‡ºå†…éƒ¨å’Œå¤–éƒ¨çŠ¶æ€ï¼Œå°±åƒæˆ‘ä»¬æ´»åŠ¨ä¿¡æ¯éƒ¨åˆ†ä¸åº“å­˜å˜åŒ–éƒ¨åˆ†ã€‚å¦‚æœä¸èƒ½å¾ˆå¥½çš„æ‹†åˆ†ï¼Œå°±ä¼šæŠŠäº«å…ƒå·¥å‚è®¾è®¡çš„éå¸¸æ··ä¹±ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚</li>
</ul>
<h3 id="7ã€ä»£ç†æ¨¡å¼"><a href="#7ã€ä»£ç†æ¨¡å¼" class="headerlink" title="7ã€ä»£ç†æ¨¡å¼"></a>7ã€ä»£ç†æ¨¡å¼</h3><p>ä»£ç†æ¨¡å¼ä¸»è¦è§£å†³çš„æ˜¯é—®é¢˜æ˜¯ä¸ºæŸäº›èµ„æºçš„è®¿é—®ã€å¯¹è±¡çš„ç±»çš„æ˜“ç”¨æ“ä½œä¸Šæä¾›æ–¹ä¾¿ä½¿ç”¨çš„ä»£ç†æœåŠ¡ã€‚è€Œè¿™ç§è®¾è®¡æ€æƒ³çš„æ¨¡å¼ç»å¸¸ä¼šå‡ºç°åœ¨æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ï¼Œæˆ–è€…ä½ ç”¨åˆ°è¿‡çš„ç»„ä»¶ä¸­ï¼Œå®ƒä»¬éƒ½æä¾›ç»™ä½ ä¸€ç§éå¸¸ç®€å•æ˜“ç”¨çš„æ–¹å¼æ§åˆ¶åŸæœ¬ä½ éœ€è¦ç¼–å†™å¾ˆå¤šä»£ç çš„è¿›è¡Œä½¿ç”¨çš„æœåŠ¡ç±»ã€‚</p>
<p>ç±»ä¼¼è¿™æ ·çš„åœºæ™¯å¯ä»¥æƒ³åˆ°ï¼›</p>
<ol>
<li>ä½ çš„æ•°æ®åº“è®¿é—®å±‚é¢ç»å¸¸ä¼šæä¾›ä¸€ä¸ªè¾ƒä¸ºåŸºç¡€çš„åº”ç”¨ï¼Œä»¥æ­¤æ¥å‡å°‘åº”ç”¨æœåŠ¡æ‰©å®¹æ—¶ä¸è‡³äºæ•°æ®åº“è¿æ¥æ•°æš´å¢ã€‚</li>
<li>ä½¿ç”¨è¿‡çš„ä¸€äº›ä¸­é—´ä»¶ä¾‹å¦‚ï¼›RPCæ¡†æ¶ï¼Œåœ¨æ‹¿åˆ°jaråŒ…å¯¹æ¥å£çš„æè¿°åï¼Œä¸­é—´ä»¶ä¼šåœ¨æœåŠ¡å¯åŠ¨çš„æ—¶å€™ç”Ÿæˆå¯¹åº”çš„ä»£ç†ç±»ï¼Œå½“è°ƒç”¨æ¥å£çš„æ—¶å€™ï¼Œå®é™…æ˜¯é€šè¿‡ä»£ç†ç±»å‘å‡ºçš„socketä¿¡æ¯è¿›è¡Œé€šè¿‡ã€‚</li>
<li>å¦å¤–åƒæˆ‘ä»¬å¸¸ç”¨çš„<code>MyBatis</code>ï¼ŒåŸºæœ¬æ˜¯å®šä¹‰æ¥å£ä½†æ˜¯ä¸éœ€è¦å†™å®ç°ç±»ï¼Œå°±å¯ä»¥å¯¹<code>xml</code>æˆ–è€…è‡ªå®šä¹‰æ³¨è§£é‡Œçš„<code>sql</code>è¯­å¥è¿›è¡Œå¢åˆ æ”¹æŸ¥æ“ä½œã€‚</li>
</ol>
<p>ä¸šåŠ¡åœºæ™¯ï¼š</p>
<p><strong>æ¨¡æ‹Ÿå®ç°mybatis-springä¸­ä»£ç†ç±»ç”Ÿæˆéƒ¨åˆ†</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-12-02-16841988792742.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›å®ç°mybatis-springä¸­ä»£ç†ç±»ç”Ÿæˆéƒ¨åˆ†"></p>
<p>æ¨¡æ‹Ÿå®ç°ä¸€ä¸ªMybatisä¸­å¯¹ç±»çš„ä»£ç†è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯åªéœ€è¦å®šä¹‰æ¥å£ï¼Œå°±å¯ä»¥å…³è”åˆ°æ–¹æ³•æ³¨è§£ä¸­çš„<code>sql</code>è¯­å¥å®Œæˆå¯¹æ•°æ®åº“çš„æ“ä½œã€‚</p>
<p>æ³¨æ„ä¸€äº›çŸ¥è¯†ç‚¹ï¼›</p>
<ol>
<li><code>BeanDefinitionRegistryPostProcessor</code>ï¼Œspringçš„æ¥å£ç±»ç”¨äºå¤„ç†å¯¹beançš„å®šä¹‰æ³¨å†Œã€‚</li>
<li><code>GenericBeanDefinition</code>ï¼Œå®šä¹‰beançš„ä¿¡æ¯ï¼Œåœ¨mybatis-springä¸­ä½¿ç”¨åˆ°çš„æ˜¯ï¼›<code>ScannedGenericBeanDefinition</code> ç•¥æœ‰ä¸åŒã€‚</li>
<li><code>FactoryBean</code>ï¼Œç”¨äºå¤„ç†beanå·¥å‚çš„ç±»ï¼Œè¿™ä¸ªç±»éå¸¸è§ã€‚</li>
</ol>
<p><strong>ä»£ç†æ¨¡å¼ä¸­é—´ä»¶æ¨¡å‹ç»“æ„</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-12-03.png" alt="ä»£ç†æ¨¡å¼ä¸­é—´ä»¶æ¨¡å‹ç»“æ„"></p>
<p>è‡ªå®šä¹‰æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Select &#123;</span><br><span class="line"></span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;  <span class="comment">// sqlè¯­å¥</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Daoå±‚æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select userName from user where id = #&#123;uId&#125;&quot;)</span></span><br><span class="line">    String <span class="title function_">queryUserInfo</span><span class="params">(String uId)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»£ç†ç±»å®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapperFactoryBean</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(MapperFactoryBean.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Class&lt;T&gt; mapperInterface;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MapperFactoryBean</span><span class="params">(Class&lt;T&gt; mapperInterface)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mapperInterface = mapperInterface;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> (proxy, method, args) -&gt; &#123;</span><br><span class="line">            <span class="type">Select</span> <span class="variable">select</span> <span class="operator">=</span> method.getAnnotation(Select.class);</span><br><span class="line">            logger.info(<span class="string">&quot;SQLï¼š&#123;&#125;&quot;</span>, select.value().replace(<span class="string">&quot;#&#123;uId&#125;&quot;</span>, args[<span class="number">0</span>].toString()));</span><br><span class="line">            <span class="keyword">return</span> args[<span class="number">0</span>] + <span class="string">&quot;,å°å‚…å“¥,bugstack.cn - æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼&quot;</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> (T) Proxy.newProxyInstance(<span class="built_in">this</span>.getClass().getClassLoader(), <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;mapperInterface&#125;, handler);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> mapperInterface;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚æœä½ æœ‰é˜…è¯»è¿‡mybatisæºç ï¼Œæ˜¯å¯ä»¥çœ‹åˆ°è¿™æ ·çš„ä¸€ä¸ªç±»ï¼›<code>MapperFactoryBean</code>ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿæ¨¡æ‹Ÿä¸€ä¸ªè¿™æ ·çš„ç±»ï¼Œåœ¨é‡Œé¢å®ç°æˆ‘ä»¬å¯¹ä»£ç†ç±»çš„å®šä¹‰ã€‚</li>
<li>é€šè¿‡ç»§æ‰¿<code>FactoryBean</code>ï¼Œæä¾›beanå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•ï¼›<code>T getObject()</code>ã€‚</li>
<li>åœ¨æ–¹æ³•<code>getObject()</code>ä¸­æä¾›ç±»çš„ä»£ç†ä»¥åŠæ¨¡æ‹Ÿå¯¹sqlè¯­å¥çš„å¤„ç†ï¼Œè¿™é‡ŒåŒ…å«äº†ç”¨æˆ·è°ƒç”¨daoå±‚æ–¹æ³•æ—¶å€™çš„å¤„ç†é€»è¾‘ã€‚</li>
<li>è¿˜æœ‰æœ€ä¸Šé¢æˆ‘ä»¬æä¾›æ„é€ å‡½æ•°æ¥é€ä¼ éœ€è¦è¢«ä»£ç†ç±»ï¼Œ<code>Class&lt;T&gt; mapperInterface</code>ï¼Œåœ¨mybatisä¸­ä¹Ÿæ˜¯ä½¿ç”¨è¿™æ ·çš„æ–¹å¼è¿›è¡Œé€ä¼ ã€‚</li>
<li>å¦å¤–<code>getObjectType()</code>æä¾›å¯¹è±¡ç±»å‹åé¦ˆï¼Œä»¥åŠ<code>isSingleton()</code>è¿”å›ç±»æ˜¯å•ä¾‹çš„ã€‚</li>
</ul>
<p>å°†Beanå®šä¹‰æ³¨å†Œåˆ°Springå®¹å™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RegisterBeanFactory</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">GenericBeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericBeanDefinition</span>();</span><br><span class="line">        beanDefinition.setBeanClass(MapperFactoryBean.class);</span><br><span class="line">        beanDefinition.setScope(<span class="string">&quot;singleton&quot;</span>);</span><br><span class="line">        	           			                                                   beanDefinition.getConstructorArgumentValues().addGenericArgumentValue(IUserDao.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">BeanDefinitionHolder</span> <span class="variable">definitionHolder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionHolder</span>(beanDefinition, <span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">        BeanDefinitionReaderUtils.registerBeanDefinition(definitionHolder, registry);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">// left intentionally blank</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™é‡Œæˆ‘ä»¬å°†ä»£ç†çš„beanäº¤ç»™springå®¹å™¨ç®¡ç†ï¼Œä¹Ÿå°±å¯ä»¥éå¸¸æ–¹ä¾¿è®©æˆ‘ä»¬å¯ä»¥è·å–åˆ°ä»£ç†çš„beanã€‚è¿™éƒ¨åˆ†æ˜¯springä¸­å…³äºä¸€ä¸ªbeanæ³¨å†Œè¿‡ç¨‹çš„æºç ã€‚</li>
<li><code>GenericBeanDefinition</code>ï¼Œç”¨äºå®šä¹‰ä¸€ä¸ªbeançš„åŸºæœ¬ä¿¡æ¯<code>setBeanClass(MapperFactoryBean.class);</code>ï¼Œä¹ŸåŒ…æ‹¬å¯ä»¥é€ä¼ ç»™æ„é€ å‡½æ•°ä¿¡æ¯<code>addGenericArgumentValue(IUserDao.class);</code></li>
<li>æœ€åä½¿ç”¨ <code>BeanDefinitionReaderUtils.registerBeanDefinition</code>ï¼Œè¿›è¡Œbeançš„æ³¨å†Œï¼Œä¹Ÿå°±æ˜¯æ³¨å†Œåˆ°<code>DefaultListableBeanFactory</code>ä¸­ã€‚</li>
</ul>
<p>é…ç½®æ–‡ä»¶spring-config</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span></span><br><span class="line">       <span class="keyword">default</span>-autowire=<span class="string">&quot;byName&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;org.itstack.demo.design.agent.RegisterBeanFactory&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test_IUserDao</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">BeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;spring-config.xml&quot;</span>);</span><br><span class="line">    <span class="type">IUserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> beanFactory.getBean(<span class="string">&quot;userDao&quot;</span>, IUserDao.class);</span><br><span class="line">    <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> userDao.queryUserInfo(<span class="string">&quot;100001&quot;</span>);</span><br><span class="line">    logger.info(<span class="string">&quot;æµ‹è¯•ç»“æœï¼š&#123;&#125;&quot;</span>, res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="ä¸‰ã€è¡Œä¸ºå‹æ¨¡å¼"><a href="#ä¸‰ã€è¡Œä¸ºå‹æ¨¡å¼" class="headerlink" title="ä¸‰ã€è¡Œä¸ºå‹æ¨¡å¼"></a>ä¸‰ã€è¡Œä¸ºå‹æ¨¡å¼</h2><h3 id="1ã€è´£ä»»é“¾æ¨¡å¼"><a href="#1ã€è´£ä»»é“¾æ¨¡å¼" class="headerlink" title="1ã€è´£ä»»é“¾æ¨¡å¼"></a>1ã€è´£ä»»é“¾æ¨¡å¼</h3><p>è´£ä»»é“¾æ¨¡å¼å…è®¸å°†è¯·æ±‚æ²¿ç€ä¸€ä¸ªå¤„ç†é“¾è¿›è¡Œä¼ é€’ï¼Œç›´åˆ°æœ‰ä¸€ä¸ªå¤„ç†è€…èƒ½å¤Ÿå¤„ç†è¯¥è¯·æ±‚ä¸ºæ­¢ã€‚æ¯ä¸ªå¤„ç†è€…éƒ½æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä½†å…·ä½“ç”±å“ªä¸ªå¤„ç†è€…æ¥å¤„ç†å–å†³äºé“¾ä¸­çš„é¡ºåºå’Œå¤„ç†è€…çš„èƒ½åŠ›ã€‚</p>
<p>åœ¨è´£ä»»é“¾æ¨¡å¼ä¸­ï¼Œé€šå¸¸æœ‰ä¸€ä¸ª<code>æŠ½è±¡å¤„ç†è€…</code>ï¼ˆAbstract Handlerï¼‰å®šä¹‰äº†å¤„ç†è¯·æ±‚çš„æ¥å£å’ŒåŸºæœ¬è¡Œä¸ºã€‚æ¯ä¸ª<code>å…·ä½“å¤„ç†è€…</code>ï¼ˆConcrete Handlerï¼‰éƒ½å®ç°äº†æŠ½è±¡å¤„ç†è€…ï¼Œå¹¶æ ¹æ®è‡ªå·±çš„èƒ½åŠ›æ¥åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿå¤„ç†è¯·æ±‚ï¼Œå¦‚æœèƒ½å¤Ÿå¤„ç†ï¼Œåˆ™è¿›è¡Œå¤„ç†ï¼›å¦‚æœä¸èƒ½å¤„ç†ï¼Œåˆ™å°†è¯·æ±‚ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†è€…ã€‚</p>
<p>è´£ä»»é“¾æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼š</p>
<ol>
<li>è§£è€¦è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…ï¼šè¯·æ±‚å‘é€è€…ä¸éœ€è¦çŸ¥é“å…·ä½“çš„æ¥æ”¶è€…æ˜¯è°ï¼Œåªéœ€å°†è¯·æ±‚å‘é€ç»™ç¬¬ä¸€ä¸ªå¤„ç†è€…å³å¯ï¼Œå®ç°äº†è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…çš„è§£è€¦ã€‚</li>
<li>çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼šè´£ä»»é“¾å¯ä»¥åŠ¨æ€åœ°ç»„åˆå’Œæ‰©å±•ï¼Œå¯ä»¥éšæ—¶æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹å¤„ç†è€…ï¼Œä»¥é€‚åº”ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚</li>
<li>å¯ä»¥å‡å°‘å¯¹è±¡ä¹‹é—´çš„ç›´æ¥å¼•ç”¨å…³ç³»ï¼šè¯·æ±‚è€…åªéœ€æŒæœ‰ä¸€ä¸ªå¯¹æŠ½è±¡å¤„ç†è€…çš„å¼•ç”¨ï¼Œè€Œä¸éœ€è¦ç›´æ¥å¼•ç”¨å…·ä½“çš„å¤„ç†è€…ï¼Œé™ä½äº†å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚</li>
</ol>
<p>è´£ä»»é“¾æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š</p>
<ol>
<li>å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€ç§ç±»å‹çš„è¯·æ±‚ï¼Œä½†å…·ä½“ç”±å“ªä¸ªå¯¹è±¡æ¥å¤„ç†åœ¨è¿è¡Œæ—¶æ‰èƒ½ç¡®å®šã€‚</li>
<li>è¯·æ±‚çš„å¤„ç†é¡ºåºéœ€è¦åŠ¨æ€ç¡®å®šæˆ–å¯é…ç½®ã€‚</li>
<li>éœ€è¦åœ¨ä¸æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå°†è¯·æ±‚ä¼ é€’ç»™å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªã€‚</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè´£ä»»é“¾æ¨¡å¼å¯èƒ½å¯¼è‡´è¯·æ±‚çš„æœªè¢«å¤„ç†ã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡è´£ä»»é“¾æ—¶ï¼Œéœ€è¦åˆç†å®‰æ’å¤„ç†è€…çš„é¡ºåºï¼Œç¡®ä¿æ‰€æœ‰è¯·æ±‚éƒ½èƒ½å¾—åˆ°é€‚å½“çš„å¤„ç†ï¼Œæˆ–è€…æä¾›ä¸€ä¸ªé»˜è®¤çš„å¤„ç†è€…æ¥å¤„ç†æœªè¢«å¤„ç†çš„è¯·æ±‚ã€‚</p>
<p><strong>ä¸šåŠ¡æ¡ˆä¾‹</strong>ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-13-02.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›618å¤§ä¿ƒåœºæ™¯ä¸Šçº¿å®¡æ‰¹åœºæ™¯"></p>
<p>æ¨¡æ‹Ÿç³»ç»Ÿä¸Šçº¿å®¡æ ¸åœºæ™¯ã€‚</p>
<p>æ¨¡æ‹Ÿå®¡æ ¸æœåŠ¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Date&gt; authMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Date&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title function_">queryAuthInfo</span><span class="params">(String uId, String orderId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> authMap.get(uId.concat(orderId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">auth</span><span class="params">(String uId, String orderId)</span> &#123;</span><br><span class="line">        authMap.put(uId.concat(orderId), <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™é‡Œé¢æä¾›äº†ä¸¤ä¸ªæ¥å£ä¸€ä¸ªæ˜¯æŸ¥è¯¢å®¡æ ¸ç»“æœ(<code>queryAuthInfo</code>)ã€å¦å¤–ä¸€ä¸ªæ˜¯å¤„ç†å®¡æ ¸(<code>auth</code>)ã€‚</li>
<li>è¿™éƒ¨åˆ†æ˜¯æŠŠç”±è°å®¡æ ¸çš„å’Œå®¡æ ¸çš„å•å­IDä½œä¸ºå”¯ä¸€keyå€¼è®°å½•åˆ°å†…å­˜Mapç»“æ„ä¸­ã€‚</li>
</ul>
<p>å¸¸è§„ä»£ç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">SimpleDateFormat</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<span class="comment">// æ—¶é—´æ ¼å¼åŒ–</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AuthInfo <span class="title function_">doAuth</span><span class="params">(String uId, String orderId, Date authDate)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸‰çº§å®¡æ‰¹</span></span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> AuthService.queryAuthInfo(<span class="string">&quot;1000013&quot;</span>, orderId);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == date) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šå¾…ä¸‰çº§å®¡æ‰¹è´Ÿè´£äºº &quot;</span>, <span class="string">&quot;ç‹å·¥&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// äºŒçº§å®¡æ‰¹</span></span><br><span class="line">        <span class="keyword">if</span> (authDate.after(f.parse(<span class="string">&quot;2020-06-01 00:00:00&quot;</span>)) &amp;&amp; authDate.before(f.parse(<span class="string">&quot;2020-06-25 23:59:59&quot;</span>))) &#123;</span><br><span class="line">            date = AuthService.queryAuthInfo(<span class="string">&quot;1000012&quot;</span>, orderId);</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == date) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šå¾…äºŒçº§å®¡æ‰¹è´Ÿè´£äºº &quot;</span>, <span class="string">&quot;å¼ ç»ç†&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¸€çº§å®¡æ‰¹</span></span><br><span class="line">        <span class="keyword">if</span> (authDate.after(f.parse(<span class="string">&quot;2020-06-11 00:00:00&quot;</span>)) &amp;&amp; authDate.before(f.parse(<span class="string">&quot;2020-06-20 23:59:59&quot;</span>))) &#123;</span><br><span class="line">            date = AuthService.queryAuthInfo(<span class="string">&quot;1000011&quot;</span>, orderId);</span><br><span class="line">            <span class="keyword">if</span> (<span class="literal">null</span> == date) <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šå¾…ä¸€çº§å®¡æ‰¹è´Ÿè´£äºº &quot;</span>, <span class="string">&quot;æ®µæ€»&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šå®¡æ‰¹å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨è´£ä»»é“¾å®Œæˆé¡¹ç›®çš„é‡æ„ï¼š</p>
<p>è´£ä»»é“¾æ¨¡å¼å¯ä»¥è®©å„ä¸ªæœåŠ¡æ¨¡å—æ›´åŠ æ¸…æ™°ï¼Œè€Œæ¯ä¸€ä¸ªæ¨¡å—é—´å¯ä»¥é€šè¿‡<code>next</code>çš„æ–¹å¼è¿›è¡Œè·å–ã€‚è€Œæ¯ä¸€ä¸ª<code>next</code>æ˜¯ç”±ç»§æ‰¿çš„ç»Ÿä¸€æŠ½è±¡ç±»å®ç°çš„ã€‚æœ€ç»ˆæ‰€æœ‰ç±»çš„èŒè´£å¯ä»¥åŠ¨æ€çš„è¿›è¡Œç¼–æ’ä½¿ç”¨ï¼Œç¼–æ’çš„è¿‡ç¨‹å¯ä»¥åšæˆå¯é…ç½®åŒ–ã€‚</p>
<p><strong>è´£ä»»é“¾ç±»å›¾</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-13-03-01.png" alt="è´£ä»»é“¾ç±»å›¾"></p>
<p><strong>è´£ä»»é“¾æ¨¡å¼æ¨¡å‹ç»“æ„</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-13-03.png" alt="è´£ä»»é“¾æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>ä¸Šå›¾æ˜¯è¿™ä¸ªä¸šåŠ¡æ¨¡å‹ä¸­è´£ä»»é“¾ç»“æ„çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé€šè¿‡ä¸‰ä¸ªå®ç°äº†ç»Ÿä¸€æŠ½è±¡ç±»<code>AuthLink</code>çš„ä¸åŒè§„åˆ™ï¼Œå†è¿›è¡Œè´£ä»»ç¼–æ’æ¨¡æ‹Ÿå‡ºä¸€æ¡é“¾è·¯ã€‚è¿™ä¸ªé“¾è·¯å°±æ˜¯ä¸šåŠ¡ä¸­çš„è´£ä»»é“¾ã€‚</li>
<li>ä¸€èˆ¬åœ¨ä½¿ç”¨è´£ä»»é“¾æ—¶å€™å¦‚æœæ˜¯åœºæ™¯æ¯”è¾ƒå›ºå®šï¼Œå¯ä»¥é€šè¿‡å†™æ­»åˆ°ä»£ç ä¸­è¿›è¡Œåˆå§‹åŒ–ã€‚ä½†å¦‚æœä¸šåŠ¡åœºæ™¯ç»å¸¸å˜åŒ–å¯ä»¥åšæˆxmlé…ç½®çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œä¹Ÿå¯ä»¥è½åˆ°åº“é‡Œè¿›è¡Œåˆå§‹åŒ–æ“ä½œã€‚</li>
</ul>
<p>è´£ä»»é“¾ä¸­è¿”å›å¯¹è±¡å®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">info</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AuthInfo</span><span class="params">(String code, String ...infos)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="keyword">for</span> (String str:infos)&#123;</span><br><span class="line">            <span class="built_in">this</span>.info = <span class="built_in">this</span>.info.concat(str);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...get/set</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™ä¸ªç±»çš„æ˜¯åŒ…è£…äº†è´£ä»»é“¾å¤„ç†è¿‡ç¨‹ä¸­è¿”å›ç»“æœçš„ç±»ï¼Œæ–¹é¢å¤„ç†æ¯ä¸ªè´£ä»»é“¾çš„è¿”å›ä¿¡æ¯ã€‚</li>
</ul>
<p>é“¾è·¯æŠ½è±¡ç±»çš„å®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AuthLink</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(AuthLink.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">SimpleDateFormat</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>);<span class="comment">// æ—¶é—´æ ¼å¼åŒ–</span></span><br><span class="line">    <span class="keyword">protected</span> String levelUserId;                           <span class="comment">// çº§åˆ«äººå‘˜ID</span></span><br><span class="line">    <span class="keyword">protected</span> String levelUserName;                         <span class="comment">// çº§åˆ«äººå‘˜å§“å</span></span><br><span class="line">    <span class="keyword">private</span> AuthLink next;                                  <span class="comment">// è´£ä»»é“¾</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AuthLink</span><span class="params">(String levelUserId, String levelUserName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.levelUserId = levelUserId;</span><br><span class="line">        <span class="built_in">this</span>.levelUserName = levelUserName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AuthLink <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AuthLink <span class="title function_">appendNext</span><span class="params">(AuthLink next)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.next = next;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> AuthInfo <span class="title function_">doAuth</span><span class="params">(String uId, String orderId, Date authDate)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™éƒ¨åˆ†æ˜¯è´£ä»»é“¾ï¼Œ<strong>é“¾æ¥èµ·æ¥</strong>çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚<code>AuthLink next</code>ï¼Œé‡ç‚¹åœ¨äºå¯ä»¥é€šè¿‡<code>next</code>æ–¹å¼è·å–ä¸‹ä¸€ä¸ªé“¾è·¯éœ€è¦å¤„ç†çš„èŠ‚ç‚¹ã€‚</li>
<li><code>levelUserId</code>ã€<code>levelUserName</code>ï¼Œæ˜¯è´£ä»»é“¾ä¸­çš„å…¬ç”¨ä¿¡æ¯ï¼Œæ ‡è®°æ¯ä¸€ä¸ªå®¡æ ¸èŠ‚ç‚¹çš„äººå‘˜ä¿¡æ¯ã€‚</li>
<li>æŠ½è±¡ç±»ä¸­å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œ<code>abstract AuthInfo doAuth</code>ï¼Œè¿™æ˜¯æ¯ä¸€ä¸ªå®ç°è€…å¿…é¡»å®ç°çš„ç±»ï¼Œä¸åŒçš„å®¡æ ¸çº§åˆ«å¤„ç†ä¸åŒçš„ä¸šåŠ¡ã€‚</li>
</ul>
<p>ä¸‰ä¸ªå®¡æ ¸å®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Level1AuthLink</span> <span class="keyword">extends</span> <span class="title class_">AuthLink</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Level1AuthLink</span><span class="params">(String levelUserId, String levelUserName)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(levelUserId, levelUserName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AuthInfo <span class="title function_">doAuth</span><span class="params">(String uId, String orderId, Date authDate)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> AuthService.queryAuthInfo(levelUserId, orderId);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == date) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šå¾…ä¸€çº§å®¡æ‰¹è´Ÿè´£äºº &quot;</span>, levelUserName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">AuthLink</span> <span class="variable">next</span> <span class="operator">=</span> <span class="built_in">super</span>.next();</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == next) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šä¸€çº§å®¡æ‰¹å®Œæˆè´Ÿè´£äºº&quot;</span>, <span class="string">&quot; æ—¶é—´ï¼š&quot;</span>, f.format(date), <span class="string">&quot; å®¡æ‰¹äººï¼š&quot;</span>, levelUserName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> next.doAuth(uId, orderId, authDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Level2AuthLink</span> <span class="keyword">extends</span> <span class="title class_">AuthLink</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Date</span> <span class="variable">beginDate</span> <span class="operator">=</span> f.parse(<span class="string">&quot;2020-06-11 00:00:00&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Date</span> <span class="variable">endDate</span> <span class="operator">=</span> f.parse(<span class="string">&quot;2020-06-20 23:59:59&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Level2AuthLink</span><span class="params">(String levelUserId, String levelUserName)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">        <span class="built_in">super</span>(levelUserId, levelUserName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AuthInfo <span class="title function_">doAuth</span><span class="params">(String uId, String orderId, Date authDate)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> AuthService.queryAuthInfo(levelUserId, orderId);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == date) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šå¾…äºŒçº§å®¡æ‰¹è´Ÿè´£äºº &quot;</span>, levelUserName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">AuthLink</span> <span class="variable">next</span> <span class="operator">=</span> <span class="built_in">super</span>.next();</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == next) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šäºŒçº§å®¡æ‰¹å®Œæˆè´Ÿè´£äºº&quot;</span>, <span class="string">&quot; æ—¶é—´ï¼š&quot;</span>, f.format(date), <span class="string">&quot; å®¡æ‰¹äººï¼š&quot;</span>, levelUserName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (authDate.before(beginDate) || authDate.after(endDate)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šäºŒçº§å®¡æ‰¹å®Œæˆè´Ÿè´£äºº&quot;</span>, <span class="string">&quot; æ—¶é—´ï¼š&quot;</span>, f.format(date), <span class="string">&quot; å®¡æ‰¹äººï¼š&quot;</span>, levelUserName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> next.doAuth(uId, orderId, authDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Level3AuthLink</span> <span class="keyword">extends</span> <span class="title class_">AuthLink</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Date</span> <span class="variable">beginDate</span> <span class="operator">=</span> f.parse(<span class="string">&quot;2020-06-01 00:00:00&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Date</span> <span class="variable">endDate</span> <span class="operator">=</span> f.parse(<span class="string">&quot;2020-06-25 23:59:59&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Level3AuthLink</span><span class="params">(String levelUserId, String levelUserName)</span> <span class="keyword">throws</span> ParseException &#123;</span><br><span class="line">        <span class="built_in">super</span>(levelUserId, levelUserName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> AuthInfo <span class="title function_">doAuth</span><span class="params">(String uId, String orderId, Date authDate)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> AuthService.queryAuthInfo(levelUserId, orderId);</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == date) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šå¾…ä¸‰çº§å®¡æ‰¹è´Ÿè´£äºº &quot;</span>, levelUserName);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">AuthLink</span> <span class="variable">next</span> <span class="operator">=</span> <span class="built_in">super</span>.next();</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == next) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šä¸‰çº§å®¡æ‰¹è´Ÿè´£äººå®Œæˆ&quot;</span>, <span class="string">&quot; æ—¶é—´ï¼š&quot;</span>, f.format(date), <span class="string">&quot; å®¡æ‰¹äººï¼š&quot;</span>, levelUserName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (authDate.before(beginDate) || authDate.after(endDate)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AuthInfo</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;å•å·ï¼š&quot;</span>, orderId, <span class="string">&quot; çŠ¶æ€ï¼šä¸‰çº§å®¡æ‰¹è´Ÿè´£äººå®Œæˆ&quot;</span>, <span class="string">&quot; æ—¶é—´ï¼š&quot;</span>, f.format(date), <span class="string">&quot; å®¡æ‰¹äººï¼š&quot;</span>, levelUserName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> next.doAuth(uId, orderId, authDate);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>å¦‚ä¸Šä¸‰ä¸ªç±»ï¼›<code>Level1AuthLink</code>ã€<code>Level2AuthLink</code>ã€<code>Level3AuthLink</code>ï¼Œå®ç°äº†ä¸åŒçš„å®¡æ ¸çº§åˆ«å¤„ç†çš„ç®€å•é€»è¾‘ã€‚</li>
<li>ä¾‹å¦‚ç¬¬ä¸€ä¸ªå®¡æ ¸ç±»ä¸­ä¼šå…ˆåˆ¤æ–­æ˜¯å¦å®¡æ ¸é€šè¿‡ï¼Œå¦‚æœæ²¡æœ‰å®¡æ ¸é€šè¿‡åˆ™è¿”å›ç»“æœç»™è°ƒç”¨æ–¹ï¼Œå¼•å¯¼å»å®¡æ ¸ã€‚<em>ï¼ˆè¿™é‡Œç®€å•æ¨¡æ‹Ÿå®¡æ ¸åæœ‰æ—¶é—´ä¿¡æ¯ä¸ä¸ºç©ºï¼Œä½œä¸ºåˆ¤æ–­æ¡ä»¶ï¼‰</em></li>
<li>åˆ¤æ–­å®Œæˆåè·å–ä¸‹ä¸€ä¸ªå®¡æ ¸èŠ‚ç‚¹ï¼›<code>super.next();</code>ï¼Œå¦‚æœä¸å­˜åœ¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™ç›´æ¥è¿”å›ç»“æœã€‚</li>
<li>ä¹‹åæ˜¯æ ¹æ®ä¸åŒçš„ä¸šåŠ¡æ—¶é—´æ®µè¿›è¡Œåˆ¤æ–­æ˜¯å¦éœ€è¦ï¼ŒäºŒçº§å’Œä¸€çº§çš„å®¡æ ¸ã€‚</li>
<li>æœ€åè¿”å›ä¸‹ä¸€ä¸ªå®¡æ ¸ç»“æœï¼›<code>next.doAuth(uId, orderId, authDate);</code>ï¼Œæœ‰ç‚¹åƒé€’å½’è°ƒç”¨ã€‚</li>
</ul>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>åœ¨æˆ‘ä»¬å‰é¢å­¦ä¹ ç»“æ„æ€§æ¨¡å¼ä¸­è®²åˆ°è¿‡ç»„åˆæ¨¡å¼ï¼Œå®ƒåƒæ˜¯ä¸€é¢—ç»„åˆæ ‘ä¸€æ ·ï¼Œæˆ‘ä»¬æ­å»ºå‡ºä¸€ä¸ªæµç¨‹å†³ç­–æ ‘ã€‚å…¶å®è¿™æ ·çš„æ¨¡å¼ä¹Ÿæ˜¯å¯ä»¥å’Œè´£ä»»é“¾æ¨¡å‹è¿›è¡Œç»„åˆæ‰©å±•ä½¿ç”¨ï¼Œè€Œè¿™éƒ¨åˆ†çš„é‡ç‚¹åœ¨äºå¦‚ä½•å…³è”<strong>é“¾è·¯çš„å…³è”</strong>ï¼Œæœ€ç»ˆçš„æ‰§è¡Œéƒ½æ˜¯åœ¨æ‰§è¡Œåœ¨ä¸­é—´çš„å…³ç³»é“¾ã€‚</li>
<li>è´£ä»»é“¾æ¨¡å¼å¾ˆå¥½çš„å¤„ç†å•ä¸€èŒè´£å’Œå¼€é—­åŸåˆ™ï¼Œç®€å•äº†è€¦åˆä¹Ÿä½¿å¯¹è±¡å…³ç³»æ›´åŠ æ¸…æ™°ï¼Œè€Œä¸”å¤–éƒ¨çš„è°ƒç”¨æ–¹å¹¶ä¸éœ€è¦å…³å¿ƒè´£ä»»é“¾æ˜¯å¦‚ä½•è¿›è¡Œå¤„ç†çš„*(ä»¥ä¸Šç¨‹åºä¸­å¯ä»¥æŠŠè´£ä»»é“¾çš„ç»„åˆè¿›è¡ŒåŒ…è£…ï¼Œåœ¨æä¾›ç»™å¤–éƒ¨ä½¿ç”¨)*ã€‚ä½†é™¤äº†è¿™äº›ä¼˜ç‚¹å¤–ä¹Ÿéœ€è¦æ˜¯é€‚å½“çš„åœºæ™¯æ‰è¿›è¡Œä½¿ç”¨ï¼Œé¿å…é€ æˆæ€§èƒ½ä»¥åŠç¼–æ’æ··ä¹±è°ƒè¯•æµ‹è¯•ç–æ¼é—®é¢˜ã€‚</li>
</ul>
<h3 id="2ã€å‘½ä»¤æ¨¡å¼"><a href="#2ã€å‘½ä»¤æ¨¡å¼" class="headerlink" title="2ã€å‘½ä»¤æ¨¡å¼"></a>2ã€å‘½ä»¤æ¨¡å¼</h3><p>å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰æ˜¯ä¸€ç§è¡Œä¸ºè®¾è®¡æ¨¡å¼ï¼Œå®ƒå°†è¯·æ±‚ï¼ˆå‘½ä»¤ï¼‰å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œä½¿ä½ å¯ä»¥ç”¨ä¸åŒçš„è¯·æ±‚å‚æ•°åŒ–å®¢æˆ·ç«¯å¯¹è±¡ï¼Œé˜Ÿåˆ—æˆ–è®°å½•è¯·æ±‚ï¼Œå¹¶æ”¯æŒå¯æ’¤é”€çš„æ“ä½œã€‚</p>
<p>åœ¨å‘½ä»¤æ¨¡å¼ä¸­ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒè§’è‰²ï¼š</p>
<ol>
<li>æŠ½è±¡å‘½ä»¤ç±»ï¼›å£°æ˜æ‰§è¡Œå‘½ä»¤çš„æ¥å£å’Œæ–¹æ³•</li>
<li>å…·ä½“çš„å‘½ä»¤å®ç°ç±»ï¼›æ¥å£ç±»çš„å…·ä½“å®ç°ï¼Œå¯ä»¥æ˜¯ä¸€ç»„ç›¸ä¼¼çš„è¡Œä¸ºé€»è¾‘</li>
<li>å®ç°è€…ï¼›ä¹Ÿå°±æ˜¯ä¸ºå‘½ä»¤åšå®ç°çš„å…·ä½“å®ç°ç±»</li>
<li>è°ƒç”¨è€…ï¼›å¤„ç†å‘½ä»¤ã€å®ç°çš„å…·ä½“æ“ä½œè€…ï¼Œè´Ÿè´£å¯¹å¤–æä¾›å‘½ä»¤æœåŠ¡</li>
</ol>
<p>ä½¿ç”¨å‘½ä»¤æ¨¡å¼çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼š</p>
<ol>
<li><p>è§£è€¦è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…ï¼šå‘½ä»¤å¯¹è±¡å°†è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…è§£è€¦ï¼Œå‘é€è€…åªéœ€è¦çŸ¥é“å¦‚ä½•å‘é€å‘½ä»¤ï¼Œè€Œæ— éœ€çŸ¥é“å…·ä½“å¦‚ä½•æ‰§è¡Œå‘½ä»¤ã€‚</p>
</li>
<li><p>å®¹æ˜“æ‰©å±•å’Œä¿®æ”¹ï¼šå¯ä»¥æ·»åŠ æ–°çš„å…·ä½“å‘½ä»¤ç±»ï¼Œæ— éœ€ä¿®æ”¹è°ƒç”¨è€…å’Œæ¥æ”¶è€…çš„ä»£ç ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚</p>
</li>
<li><p>æ”¯æŒæ’¤é”€å’Œé‡åšæ“ä½œï¼šç”±äºå‘½ä»¤å¯¹è±¡å°è£…äº†æ“ä½œï¼Œå¯ä»¥è½»æ¾å®ç°æ’¤é”€å’Œé‡åšåŠŸèƒ½ã€‚</p>
</li>
<li><p>æ”¯æŒå‘½ä»¤çš„é˜Ÿåˆ—å’Œæ—¥å¿—ï¼šå¯ä»¥å°†å‘½ä»¤å¯¹è±¡æ”¾å…¥é˜Ÿåˆ—ä¸­è¿›è¡Œç®¡ç†ï¼Œæ”¯æŒæ’¤é”€ã€æ¢å¤ã€å›æ»šç­‰æ“ä½œã€‚</p>
</li>
</ol>
<p>å‘½ä»¤æ¨¡å¼é€‚ç”¨äºä»¥ä¸‹æƒ…å†µï¼š</p>
<ol>
<li><p>éœ€è¦å°†è¯·æ±‚å‘é€è€…å’Œæ¥æ”¶è€…è§£è€¦ï¼Œä»¥æ”¯æŒæ¾æ•£è€¦åˆçš„è®¾è®¡ã€‚</p>
</li>
<li><p>éœ€è¦æ”¯æŒæ’¤é”€ã€é‡åšã€äº‹åŠ¡ç­‰åŠŸèƒ½ã€‚</p>
</li>
<li><p>éœ€è¦åœ¨ä¸åŒçš„æ—¶é—´æŒ‡å®šã€æ’é˜Ÿå’Œæ‰§è¡Œè¯·æ±‚ã€‚</p>
</li>
<li><p>éœ€è¦å°†ä¸€ç»„æ“ä½œç»„åˆæˆé«˜å±‚æ¬¡çš„æ“ä½œï¼Œå½¢æˆå¤æ‚çš„æ“ä½œé€»è¾‘ã€‚</p>
</li>
</ol>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‘½ä»¤æ¨¡å¼å¢åŠ äº†é¢å¤–çš„ç±»å’Œå¯¹è±¡ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä»£ç çš„å¤æ‚æ€§å¢åŠ ã€‚å› æ­¤ï¼Œåœ¨åº”ç”¨å‘½ä»¤æ¨¡å¼æ—¶éœ€è¦æƒè¡¡å¥½è®¾è®¡çš„å¤æ‚æ€§å’Œçµæ´»æ€§ä¹‹é—´çš„å…³ç³»ã€‚</p>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong></p>
<p>æ¨¡æ‹Ÿé¥­åº—ä¸­åœ¨å°äºŒè¿™ç‚¹é¤ï¼Œè®©å¯¹åº”çš„å¨å¸ˆè¿›è¡Œåˆ¶ä½œçš„è¿‡ç¨‹ã€‚</p>
<p>å¸¸è§„ä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiaoEr</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(XiaoEr.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, String&gt; cuisineMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;Integer, String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">order</span><span class="params">(<span class="type">int</span> cuisine)</span> &#123;</span><br><span class="line">        <span class="comment">// å¹¿ä¸œï¼ˆç²¤èœï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> == cuisine) &#123;</span><br><span class="line">            cuisineMap.put(<span class="number">1</span>, <span class="string">&quot;å¹¿ä¸œå¨å¸ˆï¼Œçƒ¹é¥ªé²èœï¼Œå®«å»·æœ€å¤§èœç³»ï¼Œä»¥å­”åºœé£å‘³ä¸ºé¾™å¤´&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ±Ÿè‹ï¼ˆè‹èœï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">2</span> == cuisine) &#123;</span><br><span class="line">            cuisineMap.put(<span class="number">2</span>, <span class="string">&quot;æ±Ÿè‹å¨å¸ˆï¼Œçƒ¹é¥ªè‹èœï¼Œå®«å»·ç¬¬äºŒå¤§èœç³»ï¼Œå¤ä»Šå›½å®´ä¸Šæœ€å—äººæ¬¢è¿çš„èœç³»ã€‚&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å±±ä¸œï¼ˆé²èœï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">3</span> == cuisine) &#123;</span><br><span class="line">            cuisineMap.put(<span class="number">3</span>, <span class="string">&quot;å±±ä¸œå¨å¸ˆï¼Œçƒ¹é¥ªé²èœï¼Œå®«å»·æœ€å¤§èœç³»ï¼Œä»¥å­”åºœé£å‘³ä¸ºé¾™å¤´.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å››å·ï¼ˆå·èœï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">4</span> == cuisine) &#123;</span><br><span class="line">            cuisineMap.put(<span class="number">4</span>, <span class="string">&quot;å››å·å¨å¸ˆï¼Œçƒ¹é¥ªå·èœï¼Œä¸­å›½æœ€æœ‰ç‰¹è‰²çš„èœç³»ï¼Œä¹Ÿæ˜¯æ°‘é—´æœ€å¤§èœç³»ã€‚&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">placeOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;èœå•ï¼š&#123;&#125;&quot;</span>, JSON.toJSONString(cuisineMap));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨è¿™ä¸ªç±»çš„å®ç°ä¸­æä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ–¹æ³•ç”¨äºç‚¹å•æ·»åŠ èœå“<code>order()</code>ï¼Œå¦å¤–ä¸€ä¸ªæ–¹æ³•å±•ç¤ºèœå“çš„ä¿¡æ¯<code>placeOrder()</code>ã€‚</li>
<li>ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°æœ‰æ¯”è¾ƒå¤šçš„ifè¯­å¥åˆ¤æ–­ç±»å‹è¿›è¡Œæ·»åŠ èœå“ï¼Œé‚£ä¹ˆå¯¹äºè¿™æ ·çš„ä»£ç åç»­å°±éœ€è¦å¤§é‡çš„ç»å†è¿›è¡Œç»´æŠ¤ï¼ŒåŒæ—¶å¯èƒ½å®é™…çš„é€»è¾‘è¦æ¯”è¿™å¤æ‚çš„å¤šã€‚éƒ½å†™åœ¨è¿™æ ·ä¸€ä¸ªç±»é‡Œä¼šå˜å¾—è€¦åˆçš„éå¸¸ä¸¥é‡ã€‚</li>
</ul>
<p>å‘½ä»¤æ¨¡å¼é‡æ„ä»£ç </p>
<p>å‘½ä»¤æ¨¡å¼å¯ä»¥å°†ä¸Šè¿°çš„æ¨¡å¼æ‹†è§£ä¸‰å±‚å¤§å—ï¼Œå‘½ä»¤ã€å‘½ä»¤å®ç°è€…ã€å‘½ä»¤çš„è°ƒç”¨è€…ï¼Œå½“æœ‰æ–°çš„èœå“æˆ–è€…å¨å¸ˆæ‰©å……æ—¶å€™å°±å¯ä»¥åœ¨æŒ‡å®šçš„ç±»ç»“æ„ä¸‹è¿›è¡Œå®ç°æ·»åŠ å³å¯ï¼Œå¤–éƒ¨çš„è°ƒç”¨ä¹Ÿä¼šéå¸¸çš„å®¹æ˜“æ‰©å±•ã€‚</p>
<p><strong>å‘½ä»¤æ¨¡å¼æ¨¡å‹ç»“æ„</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-14-03.png" alt="å‘½ä»¤æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°æ•´ä½“åˆ†ä¸ºä¸‰å¤§å—ï¼›å‘½ä»¤å®ç°(èœå“)ã€é€»è¾‘å®ç°(å¨å¸ˆ)ã€è°ƒç”¨è€…(å°äºŒ)ï¼Œä»¥ä¸Šè¿™ä¸‰é¢çš„å®ç°å°±æ˜¯å‘½ä»¤æ¨¡å¼çš„æ ¸å¿ƒå†…å®¹ã€‚</li>
<li>ç»è¿‡è¿™æ ·çš„æ‹†è§£å°±å¯ä»¥éå¸¸æ–¹é¢çš„æ‰©å±•èœå“ã€å¨å¸ˆï¼Œå¯¹äºè°ƒç”¨è€…æ¥è¯´è¿™éƒ¨åˆ†éƒ½æ˜¯æ¾è€¦åˆçš„ï¼Œåœ¨æ•´ä½“çš„æ¡†æ¶ä¸‹å¯ä»¥éå¸¸å®¹æ˜“åŠ å…¥å®ç°é€»è¾‘ã€‚</li>
</ul>
<p>æŠ½è±¡å‘½ä»¤æ¥å£(èœå“)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åšå®¢ï¼šhttps://bugstack.cn - æ²‰æ·€ã€åˆ†äº«ã€æˆé•¿ï¼Œè®©è‡ªå·±å’Œä»–äººéƒ½èƒ½æœ‰æ‰€æ”¶è·ï¼</span></span><br><span class="line"><span class="comment"> * å…¬ä¼—å·ï¼šbugstackè™«æ´æ ˆ</span></span><br><span class="line"><span class="comment"> * Create by å°å‚…å“¥(fustack) @2020</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * èœç³»</span></span><br><span class="line"><span class="comment"> * 01ã€å±±ä¸œï¼ˆé²èœï¼‰â€”â€”å®«å»·æœ€å¤§èœç³»ï¼Œä»¥å­”åºœé£å‘³ä¸ºé¾™å¤´ã€‚</span></span><br><span class="line"><span class="comment"> * 02ã€å››å·ï¼ˆå·èœï¼‰â€”â€”ä¸­å›½æœ€æœ‰ç‰¹è‰²çš„èœç³»ï¼Œä¹Ÿæ˜¯æ°‘é—´æœ€å¤§èœç³»ã€‚</span></span><br><span class="line"><span class="comment"> * 03ã€æ±Ÿè‹ï¼ˆè‹èœï¼‰â€”â€”å®«å»·ç¬¬äºŒå¤§èœç³»ï¼Œå¤ä»Šå›½å®´ä¸Šæœ€å—äººæ¬¢è¿çš„èœç³»ã€‚</span></span><br><span class="line"><span class="comment"> * 04ã€å¹¿ä¸œï¼ˆç²¤èœï¼‰â€”â€”å›½å†…æ°‘é—´ç¬¬äºŒå¤§èœç³»ï¼Œå›½å¤–æœ€æœ‰å½±å“åŠ›çš„ä¸­å›½èœç³»ï¼Œå¯ä»¥ä»£è¡¨ä¸­å›½ã€‚</span></span><br><span class="line"><span class="comment"> * 05ã€ç¦å»ºï¼ˆé—½èœï¼‰â€”â€”å®¢å®¶èœçš„ä»£è¡¨èœç³»ã€‚</span></span><br><span class="line"><span class="comment"> * 06ã€æµ™æ±Ÿï¼ˆæµ™èœï¼‰â€”â€”ä¸­å›½æœ€å¤è€çš„èœç³»ä¹‹ä¸€ï¼Œå®«å»·ç¬¬ä¸‰å¤§èœç³»ã€‚</span></span><br><span class="line"><span class="comment"> * 07ã€æ¹–å—ï¼ˆæ¹˜èœï¼‰â€”â€”æ°‘é—´ç¬¬ä¸‰å¤§èœç³»ã€‚</span></span><br><span class="line"><span class="comment"> * 08ã€å®‰å¾½ï¼ˆå¾½èœï¼‰â€”â€”å¾½å·æ–‡åŒ–çš„å…¸å‹ä»£è¡¨ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICuisine</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">cook</span><span class="params">()</span>; <span class="comment">// çƒ¹è°ƒã€åˆ¶ä½œ</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å…·ä½“çš„å‘½ä»¤å®ç°(å››ç§èœå“)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GuangDoneCuisine</span> <span class="keyword">implements</span> <span class="title class_">ICuisine</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ICook cook;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GuangDoneCuisine</span><span class="params">(ICook cook)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cook = cook;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cook</span><span class="params">()</span> &#123;</span><br><span class="line">        cook.doCooking();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JiangSuCuisine</span> <span class="keyword">implements</span> <span class="title class_">ICuisine</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ICook cook;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JiangSuCuisine</span><span class="params">(ICook cook)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cook = cook;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cook</span><span class="params">()</span> &#123;</span><br><span class="line">        cook.doCooking();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShanDongCuisine</span> <span class="keyword">implements</span> <span class="title class_">ICuisine</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ICook cook;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ShanDongCuisine</span><span class="params">(ICook cook)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cook = cook;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cook</span><span class="params">()</span> &#123;</span><br><span class="line">        cook.doCooking();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SiChuanCuisine</span> <span class="keyword">implements</span> <span class="title class_">ICuisine</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ICook cook;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SiChuanCuisine</span><span class="params">(ICook cook)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cook = cook;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cook</span><span class="params">()</span> &#123;</span><br><span class="line">        cook.doCooking();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>ä»¥ä¸Šæ˜¯å››ç§èœå“çš„å®ç°ï¼Œåœ¨å®ç°çš„ç±»ä¸­éƒ½æœ‰æ·»åŠ äº†ä¸€ä¸ªå¨å¸ˆç±»(<code>ICook</code>)ï¼Œå¹¶é€šè¿‡è¿™ä¸ªç±»æä¾›çš„æ–¹æ³•è¿›è¡Œæ“ä½œå‘½ä»¤(çƒ¹é¥ªèœå“)<code>cook.doCooking()</code>ã€‚</li>
<li>å‘½ä»¤çš„å®ç°è¿‡ç¨‹å¯ä»¥æ˜¯æŒ‰ç…§é€»è¾‘è¿›è¡Œæ·»åŠ è¡¥å……ï¼Œç›®å‰è¿™é‡ŒæŠ½è±¡çš„æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯æ¨¡æ‹Ÿä¸€ä¸ªçƒ¹é¥ªçš„è¿‡ç¨‹ï¼Œç›¸å½“äºåŒæ—¶å¨å¸ˆè¿›è¡Œèœå“çƒ¹é¥ªã€‚</li>
</ul>
<p>æŠ½è±¡å®ç°è€…æ¥å£(å¨å¸ˆ)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICook</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doCooking</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ç°è€…çš„å…·ä½“å®ç°(å››ç±»å¨å¸ˆ)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GuangDongCook</span> <span class="keyword">implements</span> <span class="title class_">ICook</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ICook.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doCooking</span><span class="params">()</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;å¹¿ä¸œå¨å¸ˆï¼Œçƒ¹é¥ªé²èœï¼Œå®«å»·æœ€å¤§èœç³»ï¼Œä»¥å­”åºœé£å‘³ä¸ºé¾™å¤´&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JiangSuCook</span> <span class="keyword">implements</span> <span class="title class_">ICook</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ICook.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doCooking</span><span class="params">()</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æ±Ÿè‹å¨å¸ˆï¼Œçƒ¹é¥ªè‹èœï¼Œå®«å»·ç¬¬äºŒå¤§èœç³»ï¼Œå¤ä»Šå›½å®´ä¸Šæœ€å—äººæ¬¢è¿çš„èœç³»ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShanDongCook</span> <span class="keyword">implements</span> <span class="title class_">ICook</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ICook.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doCooking</span><span class="params">()</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;å±±ä¸œå¨å¸ˆï¼Œçƒ¹é¥ªé²èœï¼Œå®«å»·æœ€å¤§èœç³»ï¼Œä»¥å­”åºœé£å‘³ä¸ºé¾™å¤´&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SiChuanCook</span> <span class="keyword">implements</span> <span class="title class_">ICook</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(ICook.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doCooking</span><span class="params">()</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;å››å·å¨å¸ˆï¼Œçƒ¹é¥ªå·èœï¼Œä¸­å›½æœ€æœ‰ç‰¹è‰²çš„èœç³»ï¼Œä¹Ÿæ˜¯æ°‘é—´æœ€å¤§èœç³»ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>è°ƒç”¨è€…(åº—å°äºŒ)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XiaoEr</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(XiaoEr.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;ICuisine&gt; cuisineList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;ICuisine&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">order</span><span class="params">(ICuisine cuisine)</span> &#123;</span><br><span class="line">        cuisineList.add(cuisine);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">placeOrder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (ICuisine cuisine : cuisineList) &#123;</span><br><span class="line">            cuisine.cook();</span><br><span class="line">        &#125;</span><br><span class="line">        cuisineList.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>åœ¨è°ƒç”¨è€…çš„å…·ä½“å®ç°ä¸­ï¼Œæä¾›äº†èœå“çš„æ·»åŠ å’Œèœå•æ‰§è¡Œçƒ¹é¥ªã€‚è¿™ä¸ªè¿‡ç¨‹æ˜¯å‘½ä»¤æ¨¡å¼çš„å…·ä½“è°ƒç”¨ï¼Œé€šè¿‡å¤–éƒ¨å°†èœå“å’Œå¨å¸ˆä¼ é€’è¿›æ¥è€Œè¿›è¡Œå…·ä½“çš„è°ƒç”¨.</p>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èœç³» + å¨å¸ˆï¼›å¹¿ä¸œï¼ˆç²¤èœï¼‰ã€æ±Ÿè‹ï¼ˆè‹èœï¼‰ã€å±±ä¸œï¼ˆé²èœï¼‰ã€å››å·ï¼ˆå·èœï¼‰</span></span><br><span class="line">    <span class="type">ICuisine</span> <span class="variable">guangDoneCuisine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GuangDoneCuisine</span>(<span class="keyword">new</span> <span class="title class_">GuangDongCook</span>());</span><br><span class="line">    <span class="type">JiangSuCuisine</span> <span class="variable">jiangSuCuisine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JiangSuCuisine</span>(<span class="keyword">new</span> <span class="title class_">JiangSuCook</span>());</span><br><span class="line">    <span class="type">ShanDongCuisine</span> <span class="variable">shanDongCuisine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShanDongCuisine</span>(<span class="keyword">new</span> <span class="title class_">ShanDongCook</span>());</span><br><span class="line">    <span class="type">SiChuanCuisine</span> <span class="variable">siChuanCuisine</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SiChuanCuisine</span>(<span class="keyword">new</span> <span class="title class_">SiChuanCook</span>());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç‚¹å•</span></span><br><span class="line">    <span class="type">XiaoEr</span> <span class="variable">xiaoEr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XiaoEr</span>();</span><br><span class="line">    xiaoEr.order(guangDoneCuisine);</span><br><span class="line">    xiaoEr.order(jiangSuCuisine);</span><br><span class="line">    xiaoEr.order(shanDongCuisine);</span><br><span class="line">    xiaoEr.order(siChuanCuisine);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹å•</span></span><br><span class="line">    xiaoEr.placeOrder();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™é‡Œå¯ä»¥ä¸»è¦è§‚å¯Ÿ<code>èœå“</code>ä¸<code>å¨å¸ˆ</code>çš„ç»„åˆï¼›<code>new GuangDoneCuisine(new GuangDongCook());</code>ï¼Œæ¯ä¸€ä¸ªå…·ä½“çš„å‘½ä»¤éƒ½æ‹¥æœ‰ä¸€ä¸ªå¯¹åº”çš„å®ç°ç±»ï¼Œå¯ä»¥è¿›è¡Œç»„åˆã€‚</li>
<li>å½“èœå“å’Œå…·ä½“çš„å®ç°å®šä¹‰å®Œæˆåï¼Œç”±å°äºŒè¿›è¡Œæ“ä½œç‚¹å•ï¼Œ<code>xiaoEr.order(guangDoneCuisine);</code>ï¼Œè¿™é‡Œåˆ†åˆ«æ·»åŠ äº†å››ç§èœå“ï¼Œç»™å°äºŒã€‚</li>
<li>æœ€åæ˜¯ä¸‹å•ï¼Œè¿™ä¸ªæ˜¯å…·ä½“å‘½ä»¤å®ç°çš„æ“ä½œï¼Œç›¸å½“äºæŠŠå°äºŒæ‰‹é‡Œçš„èœå•ä¼ é€’ç»™å¨å¸ˆã€‚å½“ç„¶è¿™é‡Œä¹Ÿå¯ä»¥æä¾›åˆ é™¤å’Œæ’¤é”€ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·å–æ¶ˆäº†è‡ªå·±çš„æŸä¸ªèœå“ã€‚</li>
</ul>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>å‘½ä»¤æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯éœ€è¦åˆ†ä¸ºä¸‰ä¸ªæ¯”è¾ƒå¤§çš„å—ï¼›<code>å‘½ä»¤</code>ã€<code>å®ç°</code>ã€<code>è°ƒç”¨è€…</code>ï¼Œè€Œè¿™ä¸‰å—å†…å®¹çš„æ‹†åˆ†ä¹Ÿæ˜¯é€‰æ‹©é€‚åˆåœºæ™¯çš„å…³é”®å› ç´ ï¼Œç»è¿‡è¿™æ ·çš„æ‹†åˆ†å¯ä»¥è®©é€»è¾‘å…·å¤‡å•ä¸€èŒè´£çš„æ€§è´¨ï¼Œä¾¿äºæ‰©å±•ã€‚</li>
<li>é€šè¿‡è¿™æ ·çš„å®ç°æ–¹å¼ä¸ifè¯­å¥ç›¸æ¯”ï¼Œé™ä½äº†è€¦åˆæ€§ä¹Ÿæ–¹ä¾¿å…¶ä»–çš„å‘½ä»¤å’Œå®ç°çš„æ‰©å±•ã€‚ä½†åŒæ—¶è¿™æ ·çš„è®¾è®¡æ¨¡å¼ä¹Ÿå¸¦æ¥äº†ä¸€ç‚¹é—®é¢˜ï¼Œå°±æ˜¯åœ¨å„ç§å‘½ä»¤ä¸å®ç°çš„ç»„åˆä¸‹ï¼Œä¼šæ‰©å±•å‡ºå¾ˆå¤šçš„å®ç°ç±»ï¼Œéœ€è¦è¿›è¡Œç®¡ç†ã€‚</li>
</ul>
<h3 id="3ã€è¿­ä»£å™¨æ¨¡å¼"><a href="#3ã€è¿­ä»£å™¨æ¨¡å¼" class="headerlink" title="3ã€è¿­ä»£å™¨æ¨¡å¼"></a>3ã€è¿­ä»£å™¨æ¨¡å¼</h3><p>è¿­ä»£å™¨æ¨¡å¼ï¼Œå¸¸è§çš„å°±æ˜¯æˆ‘ä»¬æ—¥å¸¸ä½¿ç”¨çš„<code>iterator</code>éå†ã€‚è™½ç„¶è¿™ä¸ªè®¾è®¡æ¨¡å¼åœ¨æˆ‘ä»¬çš„å®é™…ä¸šåŠ¡å¼€å‘ä¸­çš„åœºæ™¯å¹¶ä¸å¤šï¼Œä½†å´å‡ ä¹æ¯å¤©éƒ½è¦ä½¿ç”¨<code>jdk</code>ä¸ºæˆ‘ä»¬æä¾›çš„<code>list</code>é›†åˆéå†ã€‚å¦å¤–å¢å¼ºçš„forå¾ªç¯è™½ç„¶æ˜¯å¾ªç¯è¾“å‡ºæ•°æ®ï¼Œä½†æ˜¯ä»–ä¸æ˜¯è¿­ä»£å™¨æ¨¡å¼ã€‚è¿­ä»£å™¨æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯å®ç°<code>Iterable</code>æ¥å£ï¼Œé€šè¿‡<code>next</code>çš„æ–¹å¼è·å–é›†åˆå…ƒç´ ï¼ŒåŒæ—¶å…·å¤‡å¯¹å…ƒç´ çš„åˆ é™¤ç­‰æ“ä½œã€‚è€Œå¢å¼ºçš„forå¾ªç¯æ˜¯ä¸å¯ä»¥çš„ã€‚</p>
<p>è¿™ç§è®¾è®¡æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥è®©æˆ‘ä»¬ä»¥ç›¸åŒçš„æ–¹å¼ï¼Œéå†ä¸åŒçš„æ•°æ®ç»“æ„å…ƒç´ ï¼Œè¿™äº›æ•°æ®ç»“æ„åŒ…æ‹¬ï¼›<code>æ•°ç»„</code>ã€<code>é“¾è¡¨</code>ã€<code>æ ‘</code>ç­‰ï¼Œè€Œç”¨æˆ·åœ¨ä½¿ç”¨éå†çš„æ—¶å€™å¹¶ä¸éœ€è¦å»å…³å¿ƒæ¯ä¸€ç§æ•°æ®ç»“æ„çš„éå†å¤„ç†é€»è¾‘ï¼Œä»è®©ä½¿ç”¨å˜å¾—ç»Ÿä¸€æ˜“ç”¨ã€‚</p>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-15-02.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›å…¬å¸æ ‘å½¢ç»„ç»‡æ¶æ„"></p>
<p>æ¨¡æ‹Ÿè¿­ä»£éå†è¾“å‡ºå…¬å¸ä¸­æ ‘å½¢ç»“æ„çš„ç»„ç»‡æ¶æ„å…³ç³»ä¸­é›‡å‘˜åˆ—è¡¨</p>
<p>ä¸€èˆ¬æˆ‘ä»¬å¸¸ç”¨çš„éå†å°±æ˜¯jdké»˜è®¤æä¾›çš„æ–¹æ³•ï¼Œå¯¹listé›†åˆéå†ã€‚ä½†æ˜¯å¯¹äºè¿™æ ·çš„åä¸šåŠ¡ç‰¹æ€§è¾ƒå¤§çš„æ ‘å½¢ç»“æ„ï¼Œå¦‚æœéœ€è¦ä½¿ç”¨åˆ°éå†ï¼Œé‚£ä¹ˆå°±å¯ä»¥è‡ªå·±æ¥å®ç°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šæŠŠè¿™ä¸ªç»„ç»‡å±‚æ¬¡å…³ç³»é€šè¿‡æ ‘å½¢æ•°æ®ç»“æ„æ¥å®ç°ï¼Œå¹¶å®Œæˆè¿­ä»£å™¨åŠŸèƒ½ã€‚</p>
<p>è¿­ä»£å™¨æ¨¡å¼çš„ç»“æ„ï¼š</p>
<ol>
<li>Collectionï¼Œé›†åˆæ–¹æ³•éƒ¨åˆ†ç”¨äºå¯¹è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„æ·»åŠ é€šç”¨æ–¹æ³•ï¼›<code>add</code>ã€<code>remove</code>ã€<code>iterator</code>ç­‰æ ¸å¿ƒæ–¹æ³•ã€‚</li>
<li>Iterableï¼Œæä¾›è·å–è¿­ä»£å™¨ï¼Œè¿™ä¸ªæ¥å£ç±»ä¼šè¢«<code>Collection</code>ç»§æ‰¿ã€‚</li>
<li>Iteratorï¼Œæä¾›äº†ä¸¤ä¸ªæ–¹æ³•çš„å®šä¹‰ï¼›<code>hasNext</code>ã€<code>next</code>ï¼Œä¼šåœ¨å…·ä½“çš„æ•°æ®ç»“æ„ä¸­å†™å®ç°æ–¹å¼ã€‚</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-15-03.png" alt="è¿­ä»£å™¨æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>å·¦ä¾§æ˜¯å¯¹è¿­ä»£å™¨çš„å®šä¹‰ï¼Œå³ä¾§æ˜¯åœ¨æ•°æ®ç»“æ„ä¸­å®ç°è¿­ä»£å™¨åŠŸèƒ½ã€‚</li>
<li>å·¦ä¾§éƒ¨åˆ†çš„å®ç°ä¸jdkä¸­çš„æ–¹å¼æ˜¯ä¸€æ ·çš„ã€‚</li>
<li>è¿™ä¸ªéå†æ–¹å¼ä¸€ä¸ªæ ‘å½¢ç»“æ„çš„æ·±åº¦éå†ã€‚</li>
</ul>
<p>é›‡å‘˜å®ä½“ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String uId;   <span class="comment">// ID</span></span><br><span class="line">    <span class="keyword">private</span> String name;  <span class="comment">// å§“å</span></span><br><span class="line">    <span class="keyword">private</span> String desc;  <span class="comment">// å¤‡æ³¨</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ ‘èŠ‚ç‚¹é“¾è·¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Link</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String fromId; <span class="comment">// é›‡å‘˜ID</span></span><br><span class="line">    <span class="keyword">private</span> String toId;   <span class="comment">// é›‡å‘˜ID    </span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™ä¸ªç±»ç”¨äºæè¿°ç»“æ„æ ‘ä¸­çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»é“¾ï¼Œä¹Ÿå°±æ˜¯<code>A to B</code>ã€<code>B to C</code>ã€<code>B to D</code>ï¼Œä»¥æ­¤æè¿°å‡ºä¸€å¥—å®Œæ•´çš„æ ‘ç»„ç»‡ç»“æ„ã€‚</li>
</ul>
<p>è¿­ä»£å™¨å®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Iterator</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    E <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯è¿­ä»£æ¥å£å®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Iterable</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™ä¸ªæ¥å£ä¸­æä¾›äº†ä¸Šé¢è¿­ä»£å™¨çš„å®ç°<code>Iterator</code>çš„è·å–ï¼Œä¹Ÿå°±æ˜¯åç»­åœ¨è‡ªå·±çš„æ•°æ®ç»“æ„ä¸­éœ€è¦å®ç°è¿­ä»£å™¨çš„åŠŸèƒ½å¹¶äº¤ç»™<code>Iterable</code>ï¼Œç”±æ­¤è®©å¤–éƒ¨è°ƒç”¨æ–¹è¿›è¡Œè·å–ä½¿ç”¨ã€‚</li>
</ul>
<p>é›†åˆåŠŸèƒ½æ¥å£çš„å®šä¹‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Collection</span>&lt;E, L&gt; <span class="keyword">extends</span> <span class="title class_">Iterable</span>&lt;E&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(E e)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">addLink</span><span class="params">(String key, L l)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">removeLink</span><span class="params">(String key)</span>;</span><br><span class="line"></span><br><span class="line">    Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å®šä¹‰é›†åˆæ“ä½œæ¥å£ï¼›<code>Collection</code>ï¼ŒåŒæ—¶ç»§æ‰¿äº†å¦å¤–ä¸€ä¸ªæ¥å£<code>Iterable</code>çš„æ–¹æ³•<code>iterator()</code>ã€‚è¿™æ ·åç»­è°æ¥å®ç°è¿™ä¸ªæ¥å£ï¼Œå°±éœ€è¦å®ç°ä¸Šè¿°å®šä¹‰çš„ä¸€äº›åŸºæœ¬åŠŸèƒ½ï¼›<code>æ·»åŠ å…ƒç´ </code>ã€<code>åˆ é™¤å…ƒç´ </code>ã€<code>éå†</code>ã€‚</li>
<li>å®šä¹‰äº†ä¸¤ä¸ªæ³›å‹<code>&lt;E, L&gt;</code>ï¼Œå› ä¸ºæˆ‘ä»¬çš„æ•°æ®ç»“æ„ä¸€ä¸ªæ˜¯ç”¨äºæ·»åŠ å…ƒç´ ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯ç”¨äºæ·»åŠ æ ‘èŠ‚ç‚¹çš„é“¾è·¯å…³ç³»ã€‚</li>
</ul>
<p>è¿­ä»£å™¨åŠŸèƒ½çš„å®ç°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GroupStructure</span> <span class="keyword">implements</span> <span class="title class_">Collection</span>&lt;Employee, Link&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String groupId;                                                 <span class="comment">// ç»„ç»‡IDï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç»„ç»‡é“¾çš„å¤´éƒ¨ID</span></span><br><span class="line">    <span class="keyword">private</span> String groupName;                                               <span class="comment">// ç»„ç»‡åç§°</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Employee&gt; employeeMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Employee&gt;();  <span class="comment">// é›‡å‘˜åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;Link&gt;&gt; linkMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, List&lt;Link&gt;&gt;();  <span class="comment">// ç»„ç»‡æ¶æ„å…³ç³»ï¼›id-&gt;list</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, String&gt; invertedMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, String&gt;();       <span class="comment">// åå‘å…³ç³»é“¾</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GroupStructure</span><span class="params">(String groupId, String groupName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.groupId = groupId;</span><br><span class="line">        <span class="built_in">this</span>.groupName = groupName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(Employee employee)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span> != employeeMap.put(employee.getuId(), employee);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Employee o)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span> != employeeMap.remove(o.getuId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">addLink</span><span class="params">(String key, Link link)</span> &#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ åå‘å…³ç³»é“¾</span></span><br><span class="line">        invertedMap.put(link.getToId(), link.getFromId());</span><br><span class="line">        <span class="comment">// æ·»åŠ æ­£å‘é“¾è·¯å…³ç³»</span></span><br><span class="line">        <span class="keyword">if</span> (linkMap.containsKey(key)) &#123;</span><br><span class="line">            <span class="keyword">return</span> linkMap.get(key).add(link);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            List&lt;Link&gt; links = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;Link&gt;();</span><br><span class="line">            links.add(link);</span><br><span class="line">            linkMap.put(key, links);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">removeLink</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span> != linkMap.remove(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;Employee&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;Employee&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            HashMap&lt;String, Integer&gt; keyMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Integer&gt;();</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">totalIdx</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">private</span> <span class="type">String</span> <span class="variable">fromId</span> <span class="operator">=</span> groupId;  <span class="comment">// é›‡å‘˜IDï¼ŒFrom</span></span><br><span class="line">            <span class="keyword">private</span> <span class="type">String</span> <span class="variable">toId</span> <span class="operator">=</span> groupId;   <span class="comment">// é›‡å‘˜IDï¼ŒTo</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> totalIdx &lt; employeeMap.size();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">public</span> Employee <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å‘ä¸‹æ‰«æ</span></span><br><span class="line">                List&lt;Link&gt; links = linkMap.get(toId);</span><br><span class="line">                <span class="type">int</span> <span class="variable">cursorIdx</span> <span class="operator">=</span> getCursorIdx(toId);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// åŒçº§èŠ‚ç‚¹æ‰«æ</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="literal">null</span> == links)&#123;</span><br><span class="line">                    cursorIdx = getCursorIdx(fromId);</span><br><span class="line">                    links = linkMap.get(fromId);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// ä¸Šçº§èŠ‚ç‚¹æ‰«æ</span></span><br><span class="line">                <span class="keyword">while</span> (cursorIdx &gt; links.size() - <span class="number">1</span>)&#123;</span><br><span class="line">                    fromId = invertedMap.get(fromId);</span><br><span class="line">                    cursorIdx = getCursorIdx(fromId);</span><br><span class="line">                    links = linkMap.get(fromId);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è·å–èŠ‚ç‚¹</span></span><br><span class="line">                <span class="type">Link</span> <span class="variable">link</span> <span class="operator">=</span> links.get(cursorIdx);</span><br><span class="line">                toId = link.getToId();</span><br><span class="line">                fromId = link.getFromId();</span><br><span class="line">                totalIdx++;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> employeeMap.get(link.getToId());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * è·å–æ¸¸æ ‡çš„key</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCursorIdx</span><span class="params">(String key)</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (keyMap.containsKey(key)) &#123;</span><br><span class="line">                    idx = keyMap.get(key);</span><br><span class="line">                    keyMap.put(key, ++idx);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    keyMap.put(key, idx);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> idx;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»¥ä¸Šçš„è¿™éƒ¨åˆ†ä»£ç ç¨å¾®æœ‰ç‚¹é•¿ï¼Œä¸»è¦åŒ…æ‹¬äº†å¯¹å…ƒç´ çš„æ·»åŠ å’Œåˆ é™¤ã€‚å¦å¤–æœ€é‡è¦çš„æ˜¯å¯¹éå†çš„å®ç°<code>new Iterator&lt;Employee&gt;</code>ã€‚</li>
<li>æ·»åŠ å’Œåˆ é™¤å…ƒç´ ç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨äº†ä¸¤ä¸ªmapæ•°ç»„ç»“æ„è¿›è¡Œå®šä¹‰ï¼›<code>é›‡å‘˜åˆ—è¡¨</code>ã€<code>ç»„ç»‡æ¶æ„å…³ç³»ï¼›id-&gt;list</code>ã€‚å½“å…ƒç´ æ·»åŠ å…ƒç´ çš„æ—¶å€™ï¼Œä¼šåˆ†åˆ«åœ¨ä¸åŒçš„æ–¹æ³•ä¸­å‘<code>map</code>ç»“æ„ä¸­è¿›è¡Œå¡«å……**æŒ‡å‘å…³ç³»(A-&gt;B)**ï¼Œä¹Ÿå°±æ„å»ºå‡ºäº†æˆ‘ä»¬çš„æ ‘å½¢ç»„ç»‡å…³ç³»ã€‚</li>
</ul>
<p><strong>è¿­ä»£å™¨å®ç°æ€è·¯</strong></p>
<ol>
<li>è¿™é‡Œçš„æ ‘å½¢ç»“æ„æˆ‘ä»¬éœ€è¦åšçš„æ˜¯æ·±åº¦éå†ï¼Œä¹Ÿå°±æ˜¯å·¦ä¾§çš„ä¸€ç›´éå†åˆ°æœ€æ·±èŠ‚ç‚¹ã€‚</li>
<li>å½“éå†åˆ°æœ€æ·±èŠ‚ç‚¹åï¼Œå¼€å§‹éå†æœ€æ·±èŠ‚ç‚¹çš„æ¨ªå‘èŠ‚ç‚¹ã€‚</li>
<li>å½“æ¨ªå‘èŠ‚ç‚¹éå†å®Œæˆååˆ™å‘ä¸Šå¯»æ‰¾æ¨ªå‘èŠ‚ç‚¹ï¼Œç›´è‡³æ ‘ç»“æ„å…¨éƒ¨éå†å®Œæˆã€‚</li>
</ol>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>è¿­ä»£å™¨çš„è®¾è®¡æ¨¡å¼ä»ä»¥ä¸Šçš„åŠŸèƒ½å®ç°å¯ä»¥çœ‹åˆ°ï¼Œæ»¡è¶³äº†å•ä¸€èŒè´£å’Œå¼€é—­åŸåˆ™ï¼Œå¤–ç•Œçš„è°ƒç”¨æ–¹ä¹Ÿä¸éœ€è¦çŸ¥é“ä»»ä½•ä¸€ä¸ªä¸åŒçš„æ•°æ®ç»“æ„åœ¨ä½¿ç”¨ä¸Šçš„éå†å·®å¼‚ã€‚å¯ä»¥éå¸¸æ–¹ä¾¿çš„æ‰©å±•ï¼Œä¹Ÿè®©æ•´ä¸ªéå†å˜å¾—æ›´åŠ å¹²å‡€æ•´æ´ã€‚</li>
<li>ä½†ä»ç»“æ„çš„å®ç°ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œè¿­ä»£å™¨æ¨¡å¼çš„å®ç°è¿‡ç¨‹ç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œç±»çš„å®ç°ä¸Šä¹Ÿæ‰©å¢äº†éœ€è¦å¤–éƒ¨å®šä¹‰çš„ç±»ï¼Œä½¿å¾—éå†ä¸åŸæ•°æ®ç»“æ„åˆ†å¼€ã€‚è™½ç„¶è¿™æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œä½†å¯ä»¥çœ‹åˆ°åœ¨ä½¿ç”¨javaçš„jdkæ—¶å€™ï¼Œè¿­ä»£å™¨çš„æ¨¡å¼è¿˜æ˜¯å¾ˆå¥½ç”¨çš„ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿æ‰©å±•å’Œå‡çº§ã€‚</li>
</ul>
<h3 id="4ã€ä¸­ä»‹è€…æ¨¡å¼"><a href="#4ã€ä¸­ä»‹è€…æ¨¡å¼" class="headerlink" title="4ã€ä¸­ä»‹è€…æ¨¡å¼"></a>4ã€ä¸­ä»‹è€…æ¨¡å¼</h3><p>ä¸­ä»‹è€…æ¨¡å¼è¦è§£å†³çš„å°±æ˜¯å¤æ‚åŠŸèƒ½åº”ç”¨ä¹‹é—´çš„é‡å¤è°ƒç”¨ï¼Œåœ¨è¿™ä¸­é—´æ·»åŠ ä¸€å±‚ä¸­ä»‹è€…åŒ…è£…æœåŠ¡ï¼Œå¯¹å¤–æä¾›ç®€å•ã€é€šç”¨ã€æ˜“æ‰©å±•çš„æœåŠ¡èƒ½åŠ›ã€‚</p>
<p>ä¸šåŠ¡åœºæ™¯ï¼š</p>
<p>æ¨¡æ‹ŸMybatisçš„ORMæ¡†æ¶</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-16-02.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›æ¨¡ä»¿Mybatisæ‰‹å†™ORMæ¡†æ¶"></p>
<p>JDBC</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCUtil</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(JDBCUtil.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">URL</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://127.0.0.1:3306/itstack-demo-design&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">USER</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PASSWORD</span> <span class="operator">=</span> <span class="string">&quot;123456&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1. åŠ è½½é©±åŠ¨ç¨‹åº</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="comment">//2. è·å¾—æ•°æ®åº“è¿æ¥</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(URL, USER, PASSWORD);</span><br><span class="line">        <span class="comment">//3. æ“ä½œæ•°æ®åº“</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> stmt.executeQuery(<span class="string">&quot;SELECT id, name, age, createTime, updateTime FROM user&quot;</span>);</span><br><span class="line">        <span class="comment">//4. å¦‚æœæœ‰æ•°æ® resultSet.next() è¿”å›true</span></span><br><span class="line">        <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;æµ‹è¯•ç»“æœ å§“åï¼š&#123;&#125; å¹´é¾„ï¼š&#123;&#125;&quot;</span>, resultSet.getString(<span class="string">&quot;name&quot;</span>),resultSet.getInt(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸­ä»‹è€…æ¨¡å¼æ¨¡å‹æ¶æ„</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-16-03.png" alt="ä¸­ä»‹è€…æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>å¯¹ORMæ¡†æ¶å®ç°çš„æ ¸å¿ƒç±»ï¼ŒåŒ…æ‹¬äº†ï¼›åŠ è½½é…ç½®æ–‡ä»¶ã€å¯¹xmlè§£æã€è·å–æ•°æ®åº“sessionã€æ“ä½œæ•°æ®åº“ä»¥åŠç»“æœè¿”å›ã€‚</li>
<li>å·¦ä¸Šæ˜¯å¯¹æ•°æ®åº“çš„å®šä¹‰å’Œå¤„ç†ï¼ŒåŸºæœ¬åŒ…æ‹¬æˆ‘ä»¬å¸¸ç”¨çš„æ–¹æ³•ï¼›<code>&lt;T&gt; T selectOne</code>ã€<code>&lt;T&gt; List&lt;T&gt; selectList</code>ç­‰ã€‚</li>
<li>å³ä¾§è“è‰²éƒ¨åˆ†æ˜¯å¯¹æ•°æ®åº“é…ç½®çš„å¼€å¯sessionçš„å·¥å‚å¤„ç†ç±»ï¼Œè¿™é‡Œçš„å·¥å‚ä¼šæ“ä½œ<code>DefaultSqlSession</code></li>
<li>ä¹‹åæ˜¯çº¢è‰²åœ°æ–¹çš„<code>SqlSessionFactoryBuilder</code>ï¼Œè¿™ä¸ªç±»æ˜¯å¯¹æ•°æ®åº“æ“ä½œçš„æ ¸å¿ƒç±»ï¼›å¤„ç†å·¥å‚ã€è§£ææ–‡ä»¶ã€æ‹¿åˆ°sessionç­‰ã€‚</li>
</ul>
<p>å®šä¹‰SqlSessionæ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SqlSession</span> &#123;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; T <span class="title function_">selectOne</span><span class="params">(String statement)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; T <span class="title function_">selectOne</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; List&lt;T&gt; <span class="title function_">selectList</span><span class="params">(String statement)</span>;</span><br><span class="line"></span><br><span class="line">    &lt;T&gt; List&lt;T&gt; <span class="title function_">selectList</span><span class="params">(String statement, Object parameter)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>SqlSessionçš„å…·ä½“å®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSqlSession</span> <span class="keyword">implements</span> <span class="title class_">SqlSession</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Connection connection;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, XNode&gt; mapperElement;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefaultSqlSession</span><span class="params">(Connection connection, Map&lt;String, XNode&gt; mapperElement)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.connection = connection;</span><br><span class="line">        <span class="built_in">this</span>.mapperElement = mapperElement;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; T <span class="title function_">selectOne</span><span class="params">(String statement)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">XNode</span> <span class="variable">xNode</span> <span class="operator">=</span> mapperElement.get(statement);</span><br><span class="line">            <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(xNode.getSql());</span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> preparedStatement.executeQuery();</span><br><span class="line">            List&lt;T&gt; objects = resultSet2Obj(resultSet, Class.forName(xNode.getResultType()));</span><br><span class="line">            <span class="keyword">return</span> objects.get(<span class="number">0</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">selectList</span><span class="params">(String statement)</span> &#123;</span><br><span class="line">        <span class="type">XNode</span> <span class="variable">xNode</span> <span class="operator">=</span> mapperElement.get(statement);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> connection.prepareStatement(xNode.getSql());</span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> preparedStatement.executeQuery();</span><br><span class="line">            <span class="keyword">return</span> resultSet2Obj(resultSet, Class.forName(xNode.getResultType()));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> &lt;T&gt; List&lt;T&gt; <span class="title function_">resultSet2Obj</span><span class="params">(ResultSet resultSet, Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">        List&lt;T&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ResultSetMetaData</span> <span class="variable">metaData</span> <span class="operator">=</span> resultSet.getMetaData();</span><br><span class="line">            <span class="type">int</span> <span class="variable">columnCount</span> <span class="operator">=</span> metaData.getColumnCount();</span><br><span class="line">            <span class="comment">// æ¯æ¬¡éå†è¡Œå€¼</span></span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">                <span class="type">T</span> <span class="variable">obj</span> <span class="operator">=</span> (T) clazz.newInstance();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= columnCount; i++) &#123;</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> resultSet.getObject(i);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">columnName</span> <span class="operator">=</span> metaData.getColumnName(i);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">setMethod</span> <span class="operator">=</span> <span class="string">&quot;set&quot;</span> + columnName.substring(<span class="number">0</span>, <span class="number">1</span>).toUpperCase() + columnName.substring(<span class="number">1</span>);</span><br><span class="line">                    Method method;</span><br><span class="line">                    <span class="keyword">if</span> (value <span class="keyword">instanceof</span> Timestamp) &#123;</span><br><span class="line">                        method = clazz.getMethod(setMethod, Date.class);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        method = clazz.getMethod(setMethod, value.getClass());</span><br><span class="line">                    &#125;</span><br><span class="line">                    method.invoke(obj, value);</span><br><span class="line">                &#125;</span><br><span class="line">                list.add(obj);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">close</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == connection) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®šä¹‰SqlSessionFactoryæ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SqlSessionFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    SqlSession <span class="title function_">openSession</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å½“æœ‰æ•°æ®åº“æ“ä½œçš„æ—¶å€™éƒ½ä¼šè·å–æ¯ä¸€æ¬¡æ‰§è¡Œçš„<code>SqlSession</code></li>
</ul>
<p>SqlSessionFactoryå…·ä½“å®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultSqlSessionFactory</span> <span class="keyword">implements</span> <span class="title class_">SqlSessionFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Configuration configuration;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DefaultSqlSessionFactory</span><span class="params">(Configuration configuration)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.configuration = configuration;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> SqlSession <span class="title function_">openSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DefaultSqlSession</span>(configuration.connection, configuration.mapperElement);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>DefaultSqlSessionFactory</code>ï¼Œæ˜¯ä½¿ç”¨mybatisæœ€å¸¸ç”¨çš„ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬ç®€å•çš„å®ç°äº†ä¸€ä¸ªç‰ˆæœ¬ã€‚</li>
<li>è™½ç„¶æ˜¯ç®€å•çš„ç‰ˆæœ¬ï¼Œä½†æ˜¯åŒ…æ‹¬äº†æœ€åŸºæœ¬çš„æ ¸å¿ƒæ€è·¯ã€‚å½“å¼€å¯<code>SqlSession</code>æ—¶ä¼šè¿›è¡Œè¿”å›ä¸€ä¸ª<code>DefaultSqlSession</code></li>
<li>è¿™ä¸ªæ„é€ å‡½æ•°ä¸­å‘ä¸‹ä¼ é€’äº†<code>Configuration</code>é…ç½®æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­åŒ…æ‹¬ï¼›<code>Connection connection</code>ã€<code>Map&lt;String, String&gt; dataSource</code>ã€<code>Map&lt;String, XNode&gt; mapperElement</code>ã€‚å¦‚æœæœ‰ä½ é˜…è¯»è¿‡Mybatisæºç ï¼Œå¯¹è¿™ä¸ªå°±ä¸ä¼šé™Œç”Ÿ</li>
</ul>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>ä»¥ä¸Šé€šè¿‡ä¸­ä»‹è€…æ¨¡å¼çš„è®¾è®¡æ€æƒ³æˆ‘ä»¬æ‰‹å†™äº†ä¸€ä¸ªORMæ¡†æ¶ï¼Œéšå»äº†å¯¹æ•°æ®åº“æ“ä½œçš„å¤æ‚åº¦ï¼Œè®©å¤–éƒ¨çš„è°ƒç”¨æ–¹å¯ä»¥éå¸¸ç®€å•çš„è¿›è¡Œæ“ä½œæ•°æ®åº“ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„<code>Mybatis</code>çš„åŸå‹ï¼Œåœ¨æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘ä½¿ç”¨ä¸­ï¼Œåªéœ€è¦æŒ‰ç…§é…ç½®å³å¯éå¸¸ç®€å•çš„æ“ä½œæ•°æ®åº“ã€‚</li>
<li>é™¤äº†ä»¥ä¸Šè¿™ç§ç»„ä»¶æ¨¡å¼çš„å¼€å‘å¤–ï¼Œè¿˜æœ‰æœåŠ¡æ¥å£çš„åŒ…è£…ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼æ¥å®ç°ã€‚æ¯”å¦‚ä½ ä»¬å…¬å¸æœ‰å¾ˆå¤šçš„å¥–å“æ¥å£éœ€è¦åœ¨è¥é”€æ´»åŠ¨ä¸­å¯¹æ¥ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠè¿™äº›å¥–å“æ¥å£ç»Ÿä¸€æ”¶åˆ°ä¸­å°å¼€å‘ä¸€ä¸ªå¥–å“ä¸­å¿ƒï¼Œå¯¹å¤–æä¾›æœåŠ¡ã€‚è¿™æ ·å°±ä¸éœ€è¦æ¯ä¸€ä¸ªéœ€è¦å¯¹æ¥å¥–å“çš„æ¥å£ï¼Œéƒ½å»æ‰¾å…·ä½“çš„æä¾›è€…ï¼Œè€Œæ˜¯æ‰¾ä¸­å°æœåŠ¡å³å¯ã€‚</li>
<li>åœ¨ä¸Šè¿°çš„å®ç°å’Œæµ‹è¯•ä½¿ç”¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æ¨¡å¼çš„è®¾è®¡æ»¡è¶³äº†ï¼›<code>å•ä¸€èŒè´£</code>å’Œ<code>å¼€é—­åŸåˆ™</code>ï¼Œä¹Ÿå°±ç¬¦åˆäº†<code>è¿ªç±³ç‰¹åŸåˆ™</code>ï¼Œå³è¶Šå°‘äººçŸ¥é“è¶Šå¥½ã€‚å¤–éƒ¨çš„äººåªéœ€è¦æŒ‰ç…§éœ€æ±‚è¿›è¡Œè°ƒç”¨ï¼Œä¸éœ€è¦çŸ¥é“å…·ä½“çš„æ˜¯å¦‚ä½•å®ç°çš„ï¼Œå¤æ‚çš„ä¸€é¢å·²ç»æœ‰ç»„ä»¶åˆä½œæœåŠ¡å¹³å°å¤„ç†ã€‚</li>
</ul>
<h3 id="5ã€å¤‡å¿˜å½•æ¨¡å¼"><a href="#5ã€å¤‡å¿˜å½•æ¨¡å¼" class="headerlink" title="5ã€å¤‡å¿˜å½•æ¨¡å¼"></a>5ã€å¤‡å¿˜å½•æ¨¡å¼</h3><p>å¤‡å¿˜å½•æ¨¡å¼æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œç”¨äºä¿å­˜å’Œæ¢å¤å¯¹è±¡çš„çŠ¶æ€ã€‚åœ¨å¤‡å¿˜å½•æ¨¡å¼ä¸­ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªå¤‡å¿˜å½•å¯¹è±¡æ¥ä¿å­˜å½“å‰å¯¹è±¡çš„çŠ¶æ€ï¼Œç„¶ååœ¨éœ€è¦æ—¶å°†å¯¹è±¡æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€ã€‚è¿™ç§æ¨¡å¼é€šå¸¸ç”¨äºéœ€è¦æ’¤é”€æ“ä½œæˆ–è€…ä¿å­˜è¿›åº¦çš„åœºæ™¯ã€‚</p>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šå®Œæˆé…ç½®æ–‡ä»¶çš„æŒ‰éœ€å›æ»š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-17-03.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›ç³»ç»Ÿå‘å¸ƒä¸Šçº¿é…ç½®å›æ»š"></p>
<p><strong>å¤‡å¿˜å½•æ¨¡å¼çš„æ¨¡å‹ç»“æ„</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-17-04.png" alt="å¤‡å¿˜å½•æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>ä»¥ä¸Šæ˜¯å·¥ç¨‹ç»“æ„çš„ä¸€ä¸ªç±»å›¾ï¼Œå…¶å®ç›¸å¯¹æ¥è¯´å¹¶ä¸å¤æ‚ï¼Œé™¤äº†åŸæœ‰çš„é…ç½®ç±»(<code>ConfigFile</code>)ä»¥å¤–ï¼Œåªæ–°å¢åŠ äº†ä¸‰ä¸ªç±»ã€‚</li>
<li><code>ConfigMemento</code>ï¼šå¤‡å¿˜å½•ç±»ï¼Œç›¸å½“äºæ˜¯å¯¹åŸæœ‰é…ç½®ç±»çš„æ‰©å±•</li>
<li><code>ConfigOriginator</code>ï¼šè®°å½•è€…ç±»ï¼Œè·å–å’Œè¿”å›å¤‡å¿˜å½•ç±»å¯¹è±¡ä¿¡æ¯</li>
<li><code>Admin</code>ï¼šç®¡ç†å‘˜ç±»ï¼Œç”¨äºæ“ä½œè®°å½•å¤‡å¿˜ä¿¡æ¯ï¼Œæ¯”å¦‚ä½ ä¸€äº›åˆ—çš„é¡ºåºæ‰§è¡Œäº†ä»€ä¹ˆæˆ–è€…æŸä¸ªç‰ˆæœ¬ä¸‹çš„å†…å®¹ä¿¡æ¯</li>
</ul>
<p>é…ç½®ç±»ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigFile</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String versionNo; <span class="comment">// ç‰ˆæœ¬å·</span></span><br><span class="line">    <span class="keyword">private</span> String content;   <span class="comment">// å†…å®¹</span></span><br><span class="line">    <span class="keyword">private</span> Date dateTime;    <span class="comment">// æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> String operator;  <span class="comment">// æ“ä½œäºº</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤‡å¿˜å½•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigMemento</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ConfigFile configFile; <span class="comment">// é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConfigMemento</span><span class="params">(ConfigFile configFile)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.configFile = configFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ConfigFile <span class="title function_">getConfigFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfigFile</span><span class="params">(ConfigFile configFile)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.configFile = configFile;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®°å½•è€…ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConfigOriginator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ConfigFile configFile; <span class="comment">// é…ç½®æ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ConfigFile <span class="title function_">getConfigFile</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> configFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConfigFile</span><span class="params">(ConfigFile configFile)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.configFile = configFile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ConfigMemento <span class="title function_">saveMemento</span><span class="params">()</span>&#123; <span class="comment">// ä¿å­˜åˆ°å¤‡å¿˜å½•</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConfigMemento</span>(configFile);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getMemento</span><span class="params">(ConfigMemento memento)</span>&#123; <span class="comment">// è·å–å½“å‰å¤‡å¿˜å½•çš„é…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="built_in">this</span>.configFile = memento.getConfigFile();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>è®°å½•è€…ç±»é™¤äº†å¯¹<code>ConfigFile</code>é…ç½®ç±»å¢åŠ äº†è·å–å’Œè®¾ç½®æ–¹æ³•å¤–ï¼Œè¿˜å¢åŠ äº†ä¿å­˜<code>saveMemento()</code>ã€è·å–<code>getMemento(ConfigMemento memento)</code>ã€‚</li>
<li><code>saveMemento</code>ï¼šä¿å­˜å¤‡å¿˜å½•çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªå¤‡å¿˜å½•ä¿¡æ¯ï¼Œå¹¶è¿”å›å›å»ï¼Œäº¤ç»™ç®¡ç†è€…å¤„ç†ã€‚</li>
<li><code>getMemento</code>ï¼šè·å–çš„ä¹‹åå¹¶ä¸æ˜¯ç›´æ¥è¿”å›ï¼Œè€Œæ˜¯æŠŠå¤‡å¿˜å½•çš„ä¿¡æ¯äº¤ç»™ç°åœ¨çš„é…ç½®æ–‡ä»¶<code>this.configFile</code>ï¼Œè¿™éƒ¨åˆ†éœ€è¦æ³¨æ„ã€‚</li>
</ul>
<p>ç®¡ç†å‘˜ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Admin</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">cursorIdx</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// æ¸¸æ ‡</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;ConfigMemento&gt; mementoList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;ConfigMemento&gt;(); <span class="comment">// å¤‡å¿˜å½•è¡¨</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, ConfigMemento&gt; mementoMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, ConfigMemento&gt;(); <span class="comment">// å¤‡å¿˜å½•map ç‰ˆæœ¬å·:key-&gt;å¤‡å¿˜å½•value</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">append</span><span class="params">(ConfigMemento memento)</span> &#123; <span class="comment">// æ·»åŠ å¤‡å¿˜å½•</span></span><br><span class="line">        mementoList.add(memento);</span><br><span class="line">        mementoMap.put(memento.getConfigFile().getVersionNo(), memento);</span><br><span class="line">        cursorIdx++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ConfigMemento <span class="title function_">undo</span><span class="params">()</span> &#123; <span class="comment">// å‘åå›æ»š</span></span><br><span class="line">        <span class="keyword">if</span> (--cursorIdx &lt;= <span class="number">0</span>) <span class="keyword">return</span> mementoList.get(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> mementoList.get(cursorIdx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ConfigMemento <span class="title function_">redo</span><span class="params">()</span> &#123; <span class="comment">// å‘å‰å›æ»š</span></span><br><span class="line">        <span class="keyword">if</span> (++cursorIdx &gt; mementoList.size()) <span class="keyword">return</span> mementoList.get(mementoList.size() - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> mementoList.get(cursorIdx);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ConfigMemento <span class="title function_">get</span><span class="params">(String versionNo)</span>&#123; <span class="comment">// è·å–æŒ‡å®šç‰ˆæœ¬çš„å¤‡å¿˜å½•</span></span><br><span class="line">        <span class="keyword">return</span> mementoMap.get(versionNo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨è¿™ä¸ªç±»ä¸­ä¸»è¦å®ç°çš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯è®°å½•é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å¤‡å¿˜å½•çš„æ•ˆæœï¼Œä¹‹åæä¾›å¯ä»¥å›æ»šå’Œè·å–çš„æ–¹æ³•ï¼Œæ‹¿åˆ°å¤‡å¿˜å½•çš„å…·ä½“å†…å®¹ã€‚</li>
<li>åŒæ—¶è¿™é‡Œè®¾ç½®äº†ä¸¤ä¸ªæ•°æ®ç»“æ„æ¥å­˜æ”¾å¤‡å¿˜å½•ï¼Œå®é™…ä½¿ç”¨ä¸­å¯ä»¥æŒ‰éœ€è®¾ç½®ã€‚<code>List&lt;ConfigMemento&gt;</code>ã€<code>Map&lt;String, ConfigMemento&gt;</code>ã€‚</li>
<li>æœ€åæ˜¯æä¾›çš„å¤‡å¿˜å½•æ“ä½œæ–¹æ³•ï¼›å­˜æ”¾(<code>append</code>)ã€å›æ»š(<code>undo</code>)ã€è¿”å›(<code>redo</code>)ã€å®šå‘è·å–(<code>get</code>)ï¼Œè¿™æ ·å››ä¸ªæ“ä½œæ–¹æ³•ã€‚</li>
</ul>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Admin</span>();</span><br><span class="line">    <span class="type">ConfigOriginator</span> <span class="variable">configOriginator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigOriginator</span>();</span><br><span class="line">    configOriginator.setConfigFile(<span class="keyword">new</span> <span class="title class_">ConfigFile</span>(<span class="string">&quot;1000001&quot;</span>, <span class="string">&quot;é…ç½®å†…å®¹A=å“ˆå“ˆ&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;å°å‚…å“¥&quot;</span>));</span><br><span class="line">    admin.append(configOriginator.saveMemento()); <span class="comment">// ä¿å­˜é…ç½®</span></span><br><span class="line">    configOriginator.setConfigFile(<span class="keyword">new</span> <span class="title class_">ConfigFile</span>(<span class="string">&quot;1000002&quot;</span>, <span class="string">&quot;é…ç½®å†…å®¹A=å˜»å˜»&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;å°å‚…å“¥&quot;</span>));</span><br><span class="line">    admin.append(configOriginator.saveMemento()); <span class="comment">// ä¿å­˜é…ç½®</span></span><br><span class="line">    configOriginator.setConfigFile(<span class="keyword">new</span> <span class="title class_">ConfigFile</span>(<span class="string">&quot;1000003&quot;</span>, <span class="string">&quot;é…ç½®å†…å®¹A=ä¹ˆä¹ˆ&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;å°å‚…å“¥&quot;</span>));</span><br><span class="line">    admin.append(configOriginator.saveMemento()); <span class="comment">// ä¿å­˜é…ç½®</span></span><br><span class="line">    configOriginator.setConfigFile(<span class="keyword">new</span> <span class="title class_">ConfigFile</span>(<span class="string">&quot;1000004&quot;</span>, <span class="string">&quot;é…ç½®å†…å®¹A=å˜¿å˜¿&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>(), <span class="string">&quot;å°å‚…å“¥&quot;</span>));</span><br><span class="line">    admin.append(configOriginator.saveMemento()); <span class="comment">// ä¿å­˜é…ç½®  </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†å²é…ç½®(å›æ»š)</span></span><br><span class="line">    configOriginator.getMemento(admin.undo());</span><br><span class="line">    logger.info(<span class="string">&quot;å†å²é…ç½®(å›æ»š)undoï¼š&#123;&#125;&quot;</span>, JSON.toJSONString(configOriginator.getConfigFile()));  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†å²é…ç½®(å›æ»š)</span></span><br><span class="line">    configOriginator.getMemento(admin.undo());</span><br><span class="line">    logger.info(<span class="string">&quot;å†å²é…ç½®(å›æ»š)undoï¼š&#123;&#125;&quot;</span>, JSON.toJSONString(configOriginator.getConfigFile()));  </span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†å²é…ç½®(å‰è¿›)</span></span><br><span class="line">    configOriginator.getMemento(admin.redo());</span><br><span class="line">    logger.info(<span class="string">&quot;å†å²é…ç½®(å‰è¿›)redoï¼š&#123;&#125;&quot;</span>, JSON.toJSONString(configOriginator.getConfigFile()));   </span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†å²é…ç½®(è·å–)</span></span><br><span class="line">    configOriginator.getMemento(admin.get(<span class="string">&quot;1000002&quot;</span>));</span><br><span class="line">    logger.info(<span class="string">&quot;å†å²é…ç½®(è·å–)getï¼š&#123;&#125;&quot;</span>, JSON.toJSONString(configOriginator.getConfigFile()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“</strong>ï¼š</p>
<ul>
<li>æ­¤ç§è®¾è®¡æ¨¡å¼çš„æ–¹å¼å¯ä»¥æ»¡è¶³åœ¨ä¸ç ´ååŸæœ‰å±æ€§ç±»çš„åŸºç¡€ä¸Šï¼Œæ‰©å……äº†å¤‡å¿˜å½•çš„åŠŸèƒ½ã€‚è™½ç„¶å’Œæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œä½†åœ¨å…·ä½“å®ç°ä¸Šè¿˜å¯ä»¥ç»†ç»†å“å‘³ï¼Œè¿™æ ·çš„æ–¹å¼åœ¨ä¸€äº›æºç ä¸­ä¹Ÿæœ‰æ‰€ä½“ç°ã€‚</li>
<li>åœ¨ä»¥ä¸Šçš„å®ç°ä¸­æˆ‘ä»¬æ˜¯å°†é…ç½®æ¨¡æ‹Ÿå­˜æ”¾åˆ°å†…å­˜ä¸­ï¼Œå¦‚æœå…³æœºäº†ä¼šå¯¼è‡´é…ç½®ä¿¡æ¯ä¸¢å¤±ï¼Œå› ä¸ºåœ¨ä¸€äº›çœŸå®çš„åœºæ™¯é‡Œè¿˜æ˜¯éœ€è¦å­˜æ”¾åˆ°æ•°æ®åº“ä¸­ã€‚é‚£ä¹ˆæ­¤ç§å­˜æ”¾åˆ°å†…å­˜ä¸­è¿›è¡Œå›å¤çš„åœºæ™¯ä¹Ÿä¸æ˜¯æ²¡æœ‰ï¼Œæ¯”å¦‚ï¼›Photoshopã€è¿è¥äººå‘˜æ“ä½œERPé…ç½®æ´»åŠ¨ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯å³æ—¶æ€§çš„ä¸€èˆ¬ä¸éœ€è¦å­˜æ”¾åˆ°åº“ä¸­è¿›è¡Œæ¢å¤ã€‚å¦å¤–å¦‚æœæ˜¯ä½¿ç”¨å†…å­˜æ–¹å¼å­˜æ”¾å¤‡å¿˜å½•ï¼Œéœ€è¦è€ƒè™‘å­˜å‚¨é—®é¢˜ï¼Œé¿å…é€ æˆå†…å­˜å¤§é‡æ¶ˆè€—ã€‚</li>
<li>è®¾è®¡æ¨¡å¼çš„å­¦ä¹ éƒ½æ˜¯ä¸ºäº†æ›´å¥½çš„å†™å‡ºå¯æ‰©å±•ã€å¯ç®¡ç†ã€æ˜“ç»´æŠ¤çš„ä»£ç ï¼Œè€Œè¿™ä¸ªå­¦ä¹ çš„è¿‡ç¨‹éœ€è¦è‡ªå·±ä¸æ–­çš„å°è¯•å®é™…æ“ä½œï¼Œç†è®ºçš„çŸ¥è¯†ä¸å®é™…ç»“åˆè¿˜æœ‰å¾ˆé•¿ä¸€æ®µè·ç¦»ã€‚åˆ‡è®°å¤šå¤šä¸Šæ‰‹ï¼</li>
</ul>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-18-03.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›å°å®¢è½¦æŒ‡æ ‡æ‘‡å·é€šçŸ¥åœºæ™¯"></p>
<p>æ‘‡å·æœåŠ¡æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MinibusTargetService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¨¡æ‹Ÿæ‘‡å·ï¼Œä½†ä¸æ˜¯æ‘‡å·ç®—æ³•</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> uId ç”¨æˆ·ç¼–å·</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">lottery</span><span class="params">(String uId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.abs(uId.hashCode()) % <span class="number">2</span> == <span class="number">0</span> ? <span class="string">&quot;æ­å–œä½ ï¼Œç¼–ç &quot;</span>.concat(uId).concat(<span class="string">&quot;åœ¨æœ¬æ¬¡æ‘‡å·ä¸­ç­¾&quot;</span>) : <span class="string">&quot;å¾ˆé—æ†¾ï¼Œç¼–ç &quot;</span>.concat(uId).concat(<span class="string">&quot;åœ¨æœ¬æ¬¡æ‘‡å·æœªä¸­ç­¾æˆ–æ‘‡å·èµ„æ ¼å·²è¿‡æœŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¸¸è§„çš„å®ç°æ–¹å¼</strong>:</p>
<p>åŒ…æ‹¬äº†ä¸‰éƒ¨åˆ†å†…å®¹ï¼›è¿”å›å¯¹è±¡(<code>LotteryResult</code>)ã€å®šä¹‰æ¥å£(<code>LotteryService</code>)ã€å…·ä½“å®ç°(<code>LotteryServiceImpl</code>)ã€‚</p>
<p>ä¸»è¦çš„é€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LotteryServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">LotteryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(LotteryServiceImpl.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">MinibusTargetService</span> <span class="variable">minibusTargetService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MinibusTargetService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LotteryResult <span class="title function_">doDraw</span><span class="params">(String uId)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‘‡å·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lottery</span> <span class="operator">=</span> minibusTargetService.lottery(uId);</span><br><span class="line">        <span class="comment">// å‘çŸ­ä¿¡</span></span><br><span class="line">        logger.info(<span class="string">&quot;ç»™ç”¨æˆ· &#123;&#125; å‘é€çŸ­ä¿¡é€šçŸ¥(çŸ­ä¿¡)ï¼š&#123;&#125;&quot;</span>, uId, lottery);</span><br><span class="line">        <span class="comment">// å‘MQæ¶ˆæ¯</span></span><br><span class="line">        logger.info(<span class="string">&quot;è®°å½•ç”¨æˆ· &#123;&#125; æ‘‡å·ç»“æœ(MQ)ï¼š&#123;&#125;&quot;</span>, uId, lottery);</span><br><span class="line">        <span class="comment">// ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LotteryResult</span>(uId, lottery, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»ä»¥ä¸Šçš„æ–¹æ³•å®ç°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ•´ä½“è¿‡ç¨‹åŒ…æ‹¬ä¸‰éƒ¨åˆ†ï¼›æ‘‡å·ã€å‘çŸ­ä¿¡ã€å‘MQæ¶ˆæ¯ï¼Œè€Œè¿™éƒ¨åˆ†éƒ½æ˜¯é¡ºåºè°ƒç”¨çš„ã€‚</li>
<li>é™¤äº†<code>æ‘‡å·</code>æ¥å£è°ƒç”¨å¤–ï¼Œåé¢çš„ä¸¤éƒ¨åˆ†éƒ½æ˜¯éæ ¸å¿ƒä¸»é“¾è·¯åŠŸèƒ½ï¼Œè€Œä¸”ä¼šéšç€åç»­çš„ä¸šåŠ¡éœ€æ±‚å‘å±•è€Œä¸æ–­çš„è°ƒæ•´å’Œæ‰©å……ï¼Œåœ¨è¿™æ ·çš„å¼€å‘æ–¹å¼ä¸‹å°±éå¸¸ä¸åˆ©äºç»´æŠ¤ã€‚</li>
</ul>
<p><strong>è§‚å¯Ÿè€…æ¨¡å¼æ¨¡å‹ç»“æ„</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-18-04.png" alt="è§‚å¯Ÿè€…æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>ä»ä¸Šå›¾å¯ä»¥åˆ†ä¸ºä¸‰å¤§å—çœ‹ï¼›<code>äº‹ä»¶ç›‘å¬</code>ã€<code>äº‹ä»¶å¤„ç†</code>ã€<code>å…·ä½“çš„ä¸šåŠ¡æµç¨‹</code>ï¼Œå¦å¤–åœ¨ä¸šåŠ¡æµç¨‹ä¸­ <code>LotteryService</code> å®šä¹‰çš„æ˜¯æŠ½è±¡ç±»ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥é€šè¿‡æŠ½è±¡ç±»å°†äº‹ä»¶åŠŸèƒ½å±è”½ï¼Œå¤–éƒ¨ä¸šåŠ¡æµç¨‹å¼€å‘è€…ä¸éœ€è¦çŸ¥é“å…·ä½“çš„é€šçŸ¥æ“ä½œã€‚</li>
<li>å³ä¸‹è§’åœ†åœˆå›¾è¡¨ç¤ºçš„æ˜¯æ ¸å¿ƒæµç¨‹ä¸éæ ¸å¿ƒæµç¨‹çš„ç»“æ„ï¼Œä¸€èˆ¬åœ¨å¼€å‘ä¸­ä¼šæŠŠä¸»çº¿æµç¨‹å¼€å‘å®Œæˆåï¼Œå†ä½¿ç”¨é€šçŸ¥çš„æ–¹å¼å¤„ç†è¾…åŠ©æµç¨‹ã€‚ä»–ä»¬å¯ä»¥æ˜¯å¼‚æ­¥çš„ï¼Œåœ¨MQä»¥åŠå®šæ—¶ä»»åŠ¡çš„å¤„ç†ä¸‹ï¼Œä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚</li>
</ul>
<p>äº‹ä»¶ç›‘å¬å®šä¹‰æ¥å£:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EventListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">doEvent</span><span class="params">(LotteryResult result)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸¤ä¸ªç›‘å¬äº‹ä»¶çš„å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageEventListener</span> <span class="keyword">implements</span> <span class="title class_">EventListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(MessageEventListener.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doEvent</span><span class="params">(LotteryResult result)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;ç»™ç”¨æˆ· &#123;&#125; å‘é€çŸ­ä¿¡é€šçŸ¥(çŸ­ä¿¡)ï¼š&#123;&#125;&quot;</span>, result.getuId(), result.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MQEventListener</span> <span class="keyword">implements</span> <span class="title class_">EventListener</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(MQEventListener.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doEvent</span><span class="params">(LotteryResult result)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;è®°å½•ç”¨æˆ· &#123;&#125; æ‘‡å·ç»“æœ(MQ)ï¼š&#123;&#125;&quot;</span>, result.getuId(), result.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä»¥ä¸Šæ˜¯ä¸¤ä¸ªäº‹ä»¶çš„å…·ä½“å®ç°ï¼Œç›¸å¯¹æ¥è¯´éƒ½æ¯”è¾ƒç®€å•ã€‚å¦‚æœæ˜¯å®é™…çš„ä¸šåŠ¡å¼€å‘é‚£ä¹ˆä¼šéœ€è¦è°ƒç”¨å¤–éƒ¨æ¥å£ä»¥åŠæ§åˆ¶å¼‚å¸¸çš„å¤„ç†ã€‚</li>
<li>åŒæ—¶æˆ‘ä»¬ä¸Šé¢æåˆ°äº‹ä»¶æ¥å£æ·»åŠ æ³›å‹ï¼Œå¦‚æœæœ‰éœ€è¦é‚£ä¹ˆåœ¨äº‹ä»¶çš„å®ç°ä¸­å°±å¯ä»¥æŒ‰ç…§ä¸åŒçš„ç±»å‹è¿›è¡ŒåŒ…è£…äº‹ä»¶å†…å®¹ã€‚</li>
</ul>
<p>äº‹ä»¶å¤„ç†ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventManager</span> &#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;Enum&lt;EventType&gt;, List&lt;EventListener&gt;&gt; listeners = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EventManager</span><span class="params">(Enum&lt;EventType&gt;... operations)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Enum&lt;EventType&gt; operation : operations) &#123;</span><br><span class="line">            <span class="built_in">this</span>.listeners.put(operation, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EventType</span> &#123;</span><br><span class="line">        MQ, Message</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è®¢é˜…</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventType äº‹ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> listener  ç›‘å¬</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(Enum&lt;EventType&gt; eventType, EventListener listener)</span> &#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        users.add(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å–æ¶ˆè®¢é˜…</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventType äº‹ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> listener  ç›‘å¬</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unsubscribe</span><span class="params">(Enum&lt;EventType&gt; eventType, EventListener listener)</span> &#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        users.remove(listener);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šçŸ¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> eventType äº‹ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> result    ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notify</span><span class="params">(Enum&lt;EventType&gt; eventType, LotteryResult result)</span> &#123;</span><br><span class="line">        List&lt;EventListener&gt; users = listeners.get(eventType);</span><br><span class="line">        <span class="keyword">for</span> (EventListener listener : users) &#123;</span><br><span class="line">            listener.doEvent(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>æ•´ä¸ªå¤„ç†çš„å®ç°ä¸Šæä¾›äº†ä¸‰ä¸ªä¸»è¦æ–¹æ³•ï¼›è®¢é˜…(<code>subscribe</code>)ã€å–æ¶ˆè®¢é˜…(<code>unsubscribe</code>)ã€é€šçŸ¥(<code>notify</code>)ã€‚è¿™ä¸‰ä¸ªæ–¹æ³•åˆ†åˆ«ç”¨äºå¯¹ç›‘å¬æ—¶é—´çš„æ·»åŠ å’Œä½¿ç”¨ã€‚</li>
<li>å¦å¤–å› ä¸ºäº‹ä»¶æœ‰ä¸åŒçš„ç±»å‹ï¼Œè¿™é‡Œä½¿ç”¨äº†æšä¸¾çš„æ–¹å¼è¿›è¡Œå¤„ç†ï¼Œä¹Ÿæ–¹ä¾¿è®©å¤–éƒ¨åœ¨è§„å®šä¸‹ä½¿ç”¨äº‹ä»¶ï¼Œè€Œä¸è‡³äºä¹±ä¼ ä¿¡æ¯(<code>EventType.MQ</code>ã€<code>EventType.Message</code>)ã€‚</li>
</ul>
<p>ä¸šåŠ¡æŠ½è±¡ç±»æ¥å£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">LotteryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> EventManager eventManager;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LotteryService</span><span class="params">()</span> &#123;</span><br><span class="line">        eventManager = <span class="keyword">new</span> <span class="title class_">EventManager</span>(EventManager.EventType.MQ, EventManager.EventType.Message);</span><br><span class="line">        eventManager.subscribe(EventManager.EventType.MQ, <span class="keyword">new</span> <span class="title class_">MQEventListener</span>());</span><br><span class="line">        eventManager.subscribe(EventManager.EventType.Message, <span class="keyword">new</span> <span class="title class_">MessageEventListener</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LotteryResult <span class="title function_">draw</span><span class="params">(String uId)</span> &#123;</span><br><span class="line">        <span class="type">LotteryResult</span> <span class="variable">lotteryResult</span> <span class="operator">=</span> doDraw(uId);</span><br><span class="line">        <span class="comment">// éœ€è¦ä»€ä¹ˆé€šçŸ¥å°±ç»™è°ƒç”¨ä»€ä¹ˆæ–¹æ³•</span></span><br><span class="line">        eventManager.notify(EventManager.EventType.MQ, lotteryResult);</span><br><span class="line">        eventManager.notify(EventManager.EventType.Message, lotteryResult);</span><br><span class="line">        <span class="keyword">return</span> lotteryResult;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> LotteryResult <span class="title function_">doDraw</span><span class="params">(String uId)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™ç§ä½¿ç”¨æŠ½è±¡ç±»çš„æ–¹å¼å®šä¹‰å®ç°æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ–¹æ³•ä¸­æ‰©å±•éœ€è¦çš„é¢å¤–è°ƒç”¨ã€‚å¹¶æä¾›æŠ½è±¡ç±»<code>abstract LotteryResult doDraw(String uId)</code>ï¼Œè®©ç±»çš„ç»§æ‰¿è€…å®ç°ã€‚</li>
<li>åŒæ—¶æ–¹æ³•çš„å®šä¹‰ä½¿ç”¨çš„æ˜¯<code>protected</code>ï¼Œä¹Ÿå°±æ˜¯ä¿è¯å°†æ¥å¤–éƒ¨çš„è°ƒç”¨æ–¹ä¸ä¼šè°ƒç”¨åˆ°æ­¤æ–¹æ³•ï¼Œåªæœ‰è°ƒç”¨åˆ°<code>draw(String uId)</code>ï¼Œæ‰èƒ½è®©æˆ‘ä»¬å®Œæˆäº‹ä»¶é€šçŸ¥ã€‚</li>
<li>æ­¤ç§æ–¹å¼çš„å®ç°å°±æ˜¯åœ¨æŠ½è±¡ç±»ä¸­å†™å¥½ä¸€ä¸ªåŸºæœ¬çš„æ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­å®Œæˆæ–°å¢é€»è¾‘çš„åŒæ—¶ï¼Œå†å¢åŠ æŠ½è±¡ç±»çš„ä½¿ç”¨ã€‚è€Œè¿™ä¸ªæŠ½è±¡ç±»çš„å®šä¹‰ä¼šæœ‰ç»§æ‰¿è€…å®ç°ã€‚</li>
<li>å¦å¤–åœ¨æ„é€ å‡½æ•°ä¸­æä¾›äº†å¯¹äº‹ä»¶çš„å®šä¹‰ï¼›<code>eventManager.subscribe(EventManager.EventType.MQ, new MQEventListener())</code>ã€‚</li>
<li>åœ¨ä½¿ç”¨çš„æ—¶å€™ä¹Ÿæ˜¯ä½¿ç”¨æšä¸¾çš„æ–¹å¼è¿›è¡Œé€šçŸ¥ä½¿ç”¨ï¼Œä¼ äº†ä»€ä¹ˆç±»å‹<code>EventManager.EventType.MQ</code>ï¼Œå°±ä¼šæ‰§è¡Œä»€ä¹ˆäº‹ä»¶é€šçŸ¥ï¼ŒæŒ‰éœ€æ·»åŠ ã€‚</li>
</ul>
<p>ä¸šåŠ¡å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LotteryServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">LotteryService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">MinibusTargetService</span> <span class="variable">minibusTargetService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MinibusTargetService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> LotteryResult <span class="title function_">doDraw</span><span class="params">(String uId)</span> &#123;</span><br><span class="line">        <span class="comment">// æ‘‡å·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">lottery</span> <span class="operator">=</span> minibusTargetService.lottery(uId);</span><br><span class="line">        <span class="comment">// ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LotteryResult</span>(uId, lottery, <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="6ã€è§‚å¯Ÿè€…æ¨¡å¼"><a href="#6ã€è§‚å¯Ÿè€…æ¨¡å¼" class="headerlink" title="6ã€è§‚å¯Ÿè€…æ¨¡å¼"></a>6ã€è§‚å¯Ÿè€…æ¨¡å¼</h3><p>è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ï¼Œå½“ä¸»é¢˜å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒçš„æ‰€æœ‰è§‚å¯Ÿè€…éƒ½ä¼šæ”¶åˆ°é€šçŸ¥å¹¶è‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>åœ¨è§‚å¯Ÿè€…æ¨¡å¼ä¸­ï¼Œæœ‰ä¸¤ä¸ªä¸»è¦è§’è‰²ï¼šä¸»é¢˜å’Œè§‚å¯Ÿè€…ã€‚ä¸»é¢˜æ˜¯è¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†ä¸€ç³»åˆ—è§‚å¯Ÿè€…éœ€è¦ç›‘è§†çš„çŠ¶æ€ã€‚è§‚å¯Ÿè€…åˆ™æ˜¯ä¾èµ–äºä¸»é¢˜çš„å¯¹è±¡ï¼Œå®ƒä»¬ä¼šåœ¨ä¸»é¢˜çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶å¾—åˆ°é€šçŸ¥å¹¶è¿›è¡Œç›¸åº”çš„æ›´æ–°æ“ä½œã€‚</p>
<p>è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯å¯ä»¥å®ç°æ¾è€¦åˆï¼Œä¸»é¢˜å’Œè§‚å¯Ÿè€…ä¹‹é—´çš„ä¾èµ–å…³ç³»æ¯”è¾ƒç®€å•ï¼Œå¹¶ä¸”å¯ä»¥å®ç°å¹¿æ’­é€šä¿¡ã€‚ç¼ºç‚¹æ˜¯å¦‚æœè§‚å¯Ÿè€…è¿‡å¤šï¼Œä¼šå¯¼è‡´ç³»ç»Ÿè¿è¡Œæ•ˆç‡é™ä½ã€‚</p>
<h3 id="7ã€çŠ¶æ€æ¨¡å¼"><a href="#7ã€çŠ¶æ€æ¨¡å¼" class="headerlink" title="7ã€çŠ¶æ€æ¨¡å¼"></a>7ã€çŠ¶æ€æ¨¡å¼</h3><p>çŠ¶æ€æ¨¡å¼æè¿°çš„æ˜¯ä¸€ä¸ªè¡Œä¸ºä¸‹çš„å¤šç§çŠ¶æ€å˜æ›´ï¼Œæ¯”å¦‚æˆ‘ä»¬æœ€å¸¸è§çš„ä¸€ä¸ªç½‘ç«™çš„é¡µé¢ï¼Œåœ¨ä½ ç™»å½•ä¸ä¸ç™»å½•ä¸‹å±•ç¤ºçš„å†…å®¹æ˜¯ç•¥æœ‰å·®å¼‚çš„(<code>ä¸ç™»å½•ä¸èƒ½å±•ç¤ºä¸ªäººä¿¡æ¯</code>)ï¼Œè€Œè¿™ç§<code>ç™»å½•</code>ä¸<code>ä¸ç™»å½•</code>å°±æ˜¯æˆ‘ä»¬é€šè¿‡æ”¹å˜<strong>çŠ¶æ€</strong>ï¼Œè€Œè®©æ•´ä¸ªè¡Œä¸ºå‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<p>ä¸šåŠ¡åœºæ™¯ï¼š<strong>æ¨¡æ‹Ÿè¥é”€æ´»åŠ¨å®¡æ ¸çŠ¶æ€æµè½¬åœºæ™¯</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-19-03.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›è¥é”€æ´»åŠ¨å®¡æ ¸çŠ¶æ€æµè½¬"></p>
<p>åŸºæœ¬çš„æ´»åŠ¨ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String activityId;    <span class="comment">// æ´»åŠ¨ID</span></span><br><span class="line">    <span class="keyword">private</span> String activityName;  <span class="comment">// æ´»åŠ¨åç§°</span></span><br><span class="line">    <span class="keyword">private</span> Enum&lt;Status&gt; status;  <span class="comment">// æ´»åŠ¨çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">private</span> Date beginTime;       <span class="comment">// å¼€å§‹æ—¶é—´</span></span><br><span class="line">    <span class="keyword">private</span> Date endTime;         <span class="comment">// ç»“æŸæ—¶é—´</span></span><br><span class="line">    </span><br><span class="line">&#125;  </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ´»åŠ¨æšä¸¾çŠ¶æ€</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Status</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1åˆ›å»ºç¼–è¾‘ã€2å¾…å®¡æ ¸ã€3å®¡æ ¸é€šè¿‡(ä»»åŠ¡æ‰«ææˆæ´»åŠ¨ä¸­)ã€4å®¡æ ¸æ‹’ç»(å¯ä»¥æ’¤å®¡åˆ°ç¼–è¾‘çŠ¶æ€)ã€5æ´»åŠ¨ä¸­ã€6æ´»åŠ¨å…³é—­ã€7æ´»åŠ¨å¼€å¯(ä»»åŠ¡æ‰«ææˆæ´»åŠ¨ä¸­)</span></span><br><span class="line">    Editing, Check, Pass, Refuse, Doing, Close, Open</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æ´»åŠ¨æœåŠ¡æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, Enum&lt;Status&gt;&gt; statusMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Enum&lt;Status&gt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(String activityId, Enum&lt;Status&gt; status)</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹ŸæŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯</span></span><br><span class="line">        <span class="type">ActivityInfo</span> <span class="variable">activityInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActivityInfo</span>();</span><br><span class="line">        activityInfo.setActivityId(activityId);</span><br><span class="line">        activityInfo.setActivityName(<span class="string">&quot;æ—©èµ·å­¦ä¹ æ‰“å¡é¢†å¥–æ´»åŠ¨&quot;</span>);</span><br><span class="line">        activityInfo.setStatus(status);</span><br><span class="line">        activityInfo.setBeginTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        activityInfo.setEndTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        statusMap.put(activityId, status);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityId æ´»åŠ¨ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æŸ¥è¯¢ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ActivityInfo <span class="title function_">queryActivityInfo</span><span class="params">(String activityId)</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹ŸæŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯</span></span><br><span class="line">        <span class="type">ActivityInfo</span> <span class="variable">activityInfo</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActivityInfo</span>();</span><br><span class="line">        activityInfo.setActivityId(activityId);</span><br><span class="line">        activityInfo.setActivityName(<span class="string">&quot;æ—©èµ·å­¦ä¹ æ‰“å¡é¢†å¥–æ´»åŠ¨&quot;</span>);</span><br><span class="line">        activityInfo.setStatus(statusMap.get(activityId));</span><br><span class="line">        activityInfo.setBeginTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        activityInfo.setEndTime(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">        <span class="keyword">return</span> activityInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŸ¥è¯¢æ´»åŠ¨çŠ¶æ€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityId æ´»åŠ¨ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æŸ¥è¯¢ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Enum&lt;Status&gt; <span class="title function_">queryActivityStatus</span><span class="params">(String activityId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> statusMap.get(activityId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ‰§è¡ŒçŠ¶æ€å˜æ›´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityId   æ´»åŠ¨ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beforeStatus å˜æ›´å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> afterStatus  å˜æ›´åçŠ¶æ€ b</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">execStatus</span><span class="params">(String activityId, Enum&lt;Status&gt; beforeStatus, Enum&lt;Status&gt; afterStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!beforeStatus.equals(statusMap.get(activityId))) <span class="keyword">return</span>;</span><br><span class="line">        statusMap.put(activityId, afterStatus);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨è¿™ä¸ªé™æ€ç±»ä¸­æä¾›äº†æ´»åŠ¨çš„æŸ¥è¯¢å’ŒçŠ¶æ€å˜æ›´æ¥å£ï¼›<code>queryActivityInfo</code>ã€<code>queryActivityStatus</code>ã€<code>execStatus</code>ã€‚</li>
<li>åŒæ—¶ä½¿ç”¨Mapçš„ç»“æ„æ¥è®°å½•æ´»åŠ¨IDå’ŒçŠ¶æ€å˜åŒ–ä¿¡æ¯ï¼Œå¦å¤–è¿˜æœ‰initæ–¹æ³•æ¥åˆå§‹åŒ–æ´»åŠ¨æ•°æ®ã€‚å®é™…çš„å¼€å‘ä¸­è¿™ç±»ä¿¡æ¯åŸºæœ¬éƒ½æ˜¯ä»<code>æ•°æ®åº“</code>æˆ–è€…<code>Redis</code>ä¸­è·å–ã€‚</li>
</ul>
<p>å±å±±ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ActivityExecStatusController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ´»åŠ¨çŠ¶æ€å˜æ›´</span></span><br><span class="line"><span class="comment">     * 1. ç¼–è¾‘ä¸­ -&gt; æå®¡ã€å…³é—­</span></span><br><span class="line"><span class="comment">     * 2. å®¡æ ¸é€šè¿‡ -&gt; æ‹’ç»ã€å…³é—­ã€æ´»åŠ¨ä¸­</span></span><br><span class="line"><span class="comment">     * 3. å®¡æ ¸æ‹’ç» -&gt; æ’¤å®¡ã€å…³é—­</span></span><br><span class="line"><span class="comment">     * 4. æ´»åŠ¨ä¸­ -&gt; å…³é—­</span></span><br><span class="line"><span class="comment">     * 5. æ´»åŠ¨å…³é—­ -&gt; å¼€å¯</span></span><br><span class="line"><span class="comment">     * 6. æ´»åŠ¨å¼€å¯ -&gt; å…³é—­</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityId   æ´»åŠ¨ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> beforeStatus å˜æ›´å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> afterStatus  å˜æ›´åçŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è¿”å›ç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">execStatus</span><span class="params">(String activityId, Enum&lt;Status&gt; beforeStatus, Enum&lt;Status&gt; afterStatus)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. ç¼–è¾‘ä¸­ -&gt; æå®¡ã€å…³é—­</span></span><br><span class="line">        <span class="keyword">if</span> (Status.Editing.equals(beforeStatus)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Status.Check.equals(afterStatus) || Status.Close.equals(afterStatus)) &#123;</span><br><span class="line">                ActivityService.execStatus(activityId, beforeStatus, afterStatus);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æˆåŠŸ&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æ‹’ç»&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. å®¡æ ¸é€šè¿‡ -&gt; æ‹’ç»ã€å…³é—­ã€æ´»åŠ¨ä¸­</span></span><br><span class="line">        <span class="keyword">if</span> (Status.Pass.equals(beforeStatus)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Status.Refuse.equals(afterStatus) || Status.Doing.equals(afterStatus) || Status.Close.equals(afterStatus)) &#123;</span><br><span class="line">                ActivityService.execStatus(activityId, beforeStatus, afterStatus);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æˆåŠŸ&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æ‹’ç»&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. å®¡æ ¸æ‹’ç» -&gt; æ’¤å®¡ã€å…³é—­</span></span><br><span class="line">        <span class="keyword">if</span> (Status.Refuse.equals(beforeStatus)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Status.Editing.equals(afterStatus) || Status.Close.equals(afterStatus)) &#123;</span><br><span class="line">                ActivityService.execStatus(activityId, beforeStatus, afterStatus);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æˆåŠŸ&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æ‹’ç»&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. æ´»åŠ¨ä¸­ -&gt; å…³é—­</span></span><br><span class="line">        <span class="keyword">if</span> (Status.Doing.equals(beforeStatus)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Status.Close.equals(afterStatus)) &#123;</span><br><span class="line">                ActivityService.execStatus(activityId, beforeStatus, afterStatus);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æˆåŠŸ&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æ‹’ç»&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5. æ´»åŠ¨å…³é—­ -&gt; å¼€å¯</span></span><br><span class="line">        <span class="keyword">if</span> (Status.Close.equals(beforeStatus)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Status.Open.equals(afterStatus)) &#123;</span><br><span class="line">                ActivityService.execStatus(activityId, beforeStatus, afterStatus);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æˆåŠŸ&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æ‹’ç»&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6. æ´»åŠ¨å¼€å¯ -&gt; å…³é—­</span></span><br><span class="line">        <span class="keyword">if</span> (Status.Open.equals(beforeStatus)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Status.Close.equals(afterStatus)) &#123;</span><br><span class="line">                ActivityService.execStatus(activityId, beforeStatus, afterStatus);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æˆåŠŸ&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å˜æ›´çŠ¶æ€æ‹’ç»&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;éå¯å¤„ç†çš„æ´»åŠ¨çŠ¶æ€å˜æ›´&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>å¤§é‡çš„ <code>if else</code> åµŒå¥—ï¼Œä»£ç çš„å¯è¯»æ€§å·®ï¼›</li>
<li>ä¸åˆ©äºç»´æŠ¤å’Œæ‹“å±•ï¼›</li>
</ul>
<p>æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æ•°æ®</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">activityId</span> <span class="operator">=</span> <span class="string">&quot;100001&quot;</span>;</span><br><span class="line">    ActivityService.init(activityId, Status.Editing);  </span><br><span class="line"></span><br><span class="line">    <span class="type">ActivityExecStatusController</span> <span class="variable">activityExecStatusController</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ActivityExecStatusController</span>();</span><br><span class="line">    <span class="type">Result</span> <span class="variable">resultRefuse</span> <span class="operator">=</span> activityExecStatusController.execStatus(activityId, Status.Editing, Status.Refuse); </span><br><span class="line">    logger.info(<span class="string">&quot;æµ‹è¯•ç»“æœ(ç¼–è¾‘ä¸­Toå®¡æ ¸æ‹’ç»)ï¼š&#123;&#125;&quot;</span>, JSON.toJSONString(resultRefuse));                           </span><br><span class="line"></span><br><span class="line">    <span class="type">Result</span> <span class="variable">resultCheck</span> <span class="operator">=</span> activityExecStatusController.execStatus(activityId, Status.Editing, Status.Check);</span><br><span class="line">    logger.info(<span class="string">&quot;æµ‹è¯•ç»“æœ(ç¼–è¾‘ä¸­Toæäº¤å®¡æ ¸)ï¼š&#123;&#125;&quot;</span>, JSON.toJSONString(resultCheck));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨çŠ¶æ€æ¨¡å¼é‡æ„ä»£ç ã€‚</p>
<p>é‡æ„çš„é‡ç‚¹å¾€å¾€æ˜¯å¤„ç†æ‰<code>ifelse</code>ï¼Œè€Œæƒ³å¤„ç†æ‰<code>ifelse</code>åŸºæœ¬ç¦»ä¸å¼€<strong>æ¥å£</strong>ä¸<strong>æŠ½è±¡ç±»</strong>ï¼Œå¦å¤–è¿˜éœ€è¦é‡æ–°æ”¹é€ ä»£ç ç»“æ„ã€‚</p>
<p><strong>çŠ¶æ€æ¨¡å¼æ¨¡å‹ç»“æ„</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-19-04.png" alt="çŠ¶æ€æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>ä»¥ä¸Šæ˜¯çŠ¶æ€æ¨¡å¼çš„æ•´ä¸ªå·¥ç¨‹ç»“æ„æ¨¡å‹ï¼ŒStateæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®šä¹‰äº†å„ç§æ“ä½œæ¥å£(<code>æå®¡ã€å®¡æ ¸ã€æ‹’å®¡ç­‰</code>)ã€‚</li>
<li>å³ä¾§çš„ä¸åŒé¢œè‰²çŠ¶æ€ä¸æˆ‘ä»¬åœºæ™¯æ¨¡æ‹Ÿä¸­çš„é¢œè‰²ä¿æŒä¸€è‡´ï¼Œæ˜¯å„ç§çŠ¶æ€æµç¨‹æµè½¬çš„å®ç°æ“ä½œã€‚è¿™é‡Œçš„å®ç°æœ‰ä¸€ä¸ªå…³é”®ç‚¹å°±æ˜¯æ¯ä¸€ç§çŠ¶æ€åˆ°ä¸‹ä¸€ä¸ªçŠ¶æ€ï¼Œéƒ½åˆ†é…åˆ°å„ä¸ªå®ç°æ–¹æ³•ä¸­æ§åˆ¶ï¼Œä¹Ÿå°±ä¸éœ€è¦<code>if</code>è¯­è¨€è¿›è¡Œåˆ¤æ–­äº†ã€‚</li>
<li>æœ€åæ˜¯<code>StateHandler</code>å¯¹çŠ¶æ€æµç¨‹çš„ç»Ÿä¸€å¤„ç†ï¼Œé‡Œé¢æä¾›<code>Map</code>ç»“æ„çš„å„é¡¹æœåŠ¡æ¥å£è°ƒç”¨ï¼Œä¹Ÿå°±é¿å…äº†ä½¿ç”¨<code>if</code>åˆ¤æ–­å„é¡¹çŠ¶æ€è½¬å˜çš„æµç¨‹ã€‚</li>
</ul>
<p>å®šä¹‰æŠ½è±¡ç±»	</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">State</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ´»åŠ¨æå®¡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityId    æ´»åŠ¨ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentStatus å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Result <span class="title function_">arraignment</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®¡æ ¸é€šè¿‡</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityId    æ´»åŠ¨ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentStatus å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Result <span class="title function_">checkPass</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®¡æ ¸æ‹’ç»</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityId    æ´»åŠ¨ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentStatus å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Result <span class="title function_">checkRefuse</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ’¤å®¡æ’¤é”€</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityId    æ´»åŠ¨ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentStatus å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Result <span class="title function_">checkRevoke</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ´»åŠ¨å…³é—­</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityId    æ´»åŠ¨ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentStatus å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Result <span class="title function_">close</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ´»åŠ¨å¼€å¯</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityId    æ´»åŠ¨ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentStatus å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Result <span class="title function_">open</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ´»åŠ¨æ‰§è¡Œ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> activityId    æ´»åŠ¨ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentStatus å½“å‰çŠ¶æ€</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Result <span class="title function_">doing</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨æ•´ä¸ªæ¥å£ä¸­æä¾›äº†å„é¡¹çŠ¶æ€æµè½¬æœåŠ¡çš„æ¥å£ï¼Œä¾‹å¦‚ï¼›æ´»åŠ¨æå®¡ã€å®¡æ ¸é€šè¿‡ã€å®¡æ ¸æ‹’ç»ã€æ’¤å®¡æ’¤é”€ç­‰7ä¸ªæ–¹æ³•ã€‚</li>
<li>åœ¨è¿™äº›æ–¹æ³•ä¸­æ‰€æœ‰çš„å…¥å‚éƒ½æ˜¯ä¸€æ ·çš„ï¼ŒactivityId(<code>æ´»åŠ¨ID</code>)ã€currentStatus(<code>å½“å‰çŠ¶æ€</code>)ï¼Œåªæœ‰ä»–ä»¬çš„å…·ä½“å®ç°æ˜¯ä¸åŒçš„ã€‚</li>
</ul>
<p><strong>ç¼–è¾‘çŠ¶æ€</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EditingState</span> <span class="keyword">extends</span> <span class="title class_">State</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">arraignment</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        ActivityService.execStatus(activityId, currentStatus, Status.Check);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;æ´»åŠ¨æå®¡æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">checkPass</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;ç¼–è¾‘ä¸­ä¸å¯å®¡æ ¸é€šè¿‡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">checkRefuse</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;ç¼–è¾‘ä¸­ä¸å¯å®¡æ ¸æ‹’ç»&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">checkRevoke</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;ç¼–è¾‘ä¸­ä¸å¯æ’¤é”€å®¡æ ¸&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">close</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        ActivityService.execStatus(activityId, currentStatus, Status.Close);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;æ´»åŠ¨å…³é—­æˆåŠŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">open</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;éå…³é—­æ´»åŠ¨ä¸å¯å¼€å¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">doing</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;ç¼–è¾‘ä¸­æ´»åŠ¨ä¸å¯æ‰§è¡Œæ´»åŠ¨ä¸­å˜æ›´&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>æå®¡</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckState</span> <span class="keyword">extends</span> <span class="title class_">State</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">arraignment</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å¾…å®¡æ ¸çŠ¶æ€ä¸å¯é‡å¤æå®¡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">checkPass</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        ActivityService.execStatus(activityId, currentStatus, Status.Pass);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;æ´»åŠ¨å®¡æ ¸é€šè¿‡å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">checkRefuse</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        ActivityService.execStatus(activityId, currentStatus, Status.Refuse);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;æ´»åŠ¨å®¡æ ¸æ‹’ç»å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">checkRevoke</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        ActivityService.execStatus(activityId, currentStatus, Status.Editing);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;æ´»åŠ¨å®¡æ ¸æ’¤é”€å›åˆ°ç¼–è¾‘ä¸­&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">close</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        ActivityService.execStatus(activityId, currentStatus, Status.Close);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0000&quot;</span>, <span class="string">&quot;æ´»åŠ¨å®¡æ ¸å…³é—­å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">open</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;éå…³é—­æ´»åŠ¨ä¸å¯å¼€å¯&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">doing</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>(<span class="string">&quot;0001&quot;</span>, <span class="string">&quot;å¾…å®¡æ ¸æ´»åŠ¨ä¸å¯æ‰§è¡Œæ´»åŠ¨ä¸­å˜æ›´&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>æä¾›çŠ¶æ€å¤„ç†æœåŠ¡</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StateHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;Enum&lt;Status&gt;, State&gt; stateMap = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;Enum&lt;Status&gt;, State&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StateHandler</span><span class="params">()</span> &#123;</span><br><span class="line">        stateMap.put(Status.Check, <span class="keyword">new</span> <span class="title class_">CheckState</span>());     <span class="comment">// å¾…å®¡æ ¸</span></span><br><span class="line">        stateMap.put(Status.Close, <span class="keyword">new</span> <span class="title class_">CloseState</span>());     <span class="comment">// å·²å…³é—­</span></span><br><span class="line">        stateMap.put(Status.Doing, <span class="keyword">new</span> <span class="title class_">DoingState</span>());     <span class="comment">// æ´»åŠ¨ä¸­</span></span><br><span class="line">        stateMap.put(Status.Editing, <span class="keyword">new</span> <span class="title class_">EditingState</span>()); <span class="comment">// ç¼–è¾‘ä¸­</span></span><br><span class="line">        stateMap.put(Status.Open, <span class="keyword">new</span> <span class="title class_">OpenState</span>());       <span class="comment">// å·²å¼€å¯</span></span><br><span class="line">        stateMap.put(Status.Pass, <span class="keyword">new</span> <span class="title class_">PassState</span>());       <span class="comment">// å®¡æ ¸é€šè¿‡</span></span><br><span class="line">        stateMap.put(Status.Refuse, <span class="keyword">new</span> <span class="title class_">RefuseState</span>());   <span class="comment">// å®¡æ ¸æ‹’ç»</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">arraignment</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stateMap.get(currentStatus).arraignment(activityId, currentStatus);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">checkPass</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stateMap.get(currentStatus).checkPass(activityId, currentStatus);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">checkRefuse</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stateMap.get(currentStatus).checkRefuse(activityId, currentStatus);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">checkRevoke</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stateMap.get(currentStatus).checkRevoke(activityId, currentStatus);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">close</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stateMap.get(currentStatus).close(activityId, currentStatus);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">open</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stateMap.get(currentStatus).open(activityId, currentStatus);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">doing</span><span class="params">(String activityId, Enum&lt;Status&gt; currentStatus)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> stateMap.get(currentStatus).doing(activityId, currentStatus);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä¸€æ–¹é¢æ˜¯ä¸ºäº†æ–¹ä¾¿ç®¡ç†</li>
<li>å¦ä¸€æ–¹é¢ä¸ºäº†é˜²æ­¢ç”¨æˆ·ç›´æ¥æ“ä½œæ ¸å¿ƒæ¥å£ï¼Œå­˜åœ¨é£é™©æ€§</li>
</ul>
<p><strong>æ€»ç»“</strong>ï¼š</p>
<ul>
<li>ä»ä»¥ä¸Šçš„ä¸¤ç§æ–¹å¼å¯¹ä¸€ä¸ªéœ€æ±‚çš„å®ç°ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç¬¬äºŒç§ä½¿ç”¨è®¾è®¡æ¨¡å¼å¤„ç†åå·²ç»æ²¡æœ‰äº†<code>ifelse</code>ï¼Œä»£ç çš„ç»“æ„ä¹Ÿæ›´åŠ æ¸…æ™°æ˜“äºæ‰©å±•ã€‚è¿™å°±æ˜¯è®¾è®¡æ¨¡å¼çš„å¥½å¤„ï¼Œå¯ä»¥éå¸¸å¼ºå¤§çš„æ”¹å˜åŸæœ‰ä»£ç çš„ç»“æ„ï¼Œè®©ä»¥åçš„æ‰©å±•å’Œç»´æŠ¤éƒ½å˜å¾—å®¹æ˜“äº›ã€‚</li>
<li>åœ¨å®ç°ç»“æ„çš„ç¼–ç æ–¹å¼ä¸Šå¯ä»¥çœ‹åˆ°è¿™ä¸å†æ˜¯é¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹ï¼Œè€Œæ˜¯é¢å‘å¯¹è±¡çš„ç»“æ„ã€‚å¹¶ä¸”è¿™æ ·çš„è®¾è®¡æ¨¡å¼æ»¡è¶³äº†<code>å•ä¸€èŒè´£</code>å’Œ<code>å¼€é—­åŸåˆ™</code>ï¼Œå½“ä½ åªæœ‰æ»¡è¶³è¿™æ ·çš„ç»“æ„ä¸‹æ‰ä¼šå‘ç°ä»£ç çš„æ‰©å±•æ˜¯å®¹æ˜“çš„ï¼Œä¹Ÿå°±æ˜¯å¢åŠ å’Œä¿®æ”¹åŠŸèƒ½ä¸ä¼šå½±å“æ•´ä½“çš„å˜åŒ–ã€‚</li>
<li>ä½†å¦‚æœçŠ¶æ€å’Œå„é¡¹æµè½¬è¾ƒå¤šåƒæœ¬æ–‡çš„æ¡ˆä¾‹ä¸­ï¼Œå°±ä¼šäº§ç”Ÿè¾ƒå¤šçš„å®ç°ç±»ã€‚å› æ­¤å¯èƒ½ä¹Ÿä¼šè®©ä»£ç çš„å®ç°ä¸Šå¸¦æ¥äº†æ—¶é—´æˆæœ¬ï¼Œå› ä¸ºå¦‚æœé‡åˆ°è¿™æ ·çš„åœºæ™¯å¯ä»¥æŒ‰éœ€è¯„ä¼°æŠ•å…¥å›æŠ¥ç‡ã€‚ä¸»è¦ç‚¹åœ¨äºçœ‹æ˜¯å¦ç»å¸¸ä¿®æ”¹ã€æ˜¯å¦å¯ä»¥åšæˆç»„ä»¶åŒ–ã€æŠ½ç¦»ä¸šåŠ¡ä¸éä¸šåŠ¡åŠŸèƒ½ã€‚</li>
</ul>
<h3 id="8ã€ç­–ç•¥æ¨¡å¼"><a href="#8ã€ç­–ç•¥æ¨¡å¼" class="headerlink" title="8ã€ç­–ç•¥æ¨¡å¼"></a>8ã€ç­–ç•¥æ¨¡å¼</h3><p>ç­–ç•¥æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºæ¨¡å¼ï¼Œä¹Ÿæ˜¯æ›¿ä»£å¤§é‡<code>ifelse</code>çš„åˆ©å™¨ã€‚å®ƒæ‰€èƒ½å¸®ä½ è§£å†³çš„æ˜¯åœºæ™¯ï¼Œä¸€èˆ¬æ˜¯å…·æœ‰åŒç±»å¯æ›¿ä»£çš„è¡Œä¸ºé€»è¾‘ç®—æ³•åœºæ™¯ã€‚æ¯”å¦‚ï¼›ä¸åŒç±»å‹çš„äº¤æ˜“æ–¹å¼(ä¿¡ç”¨å¡ã€æ”¯ä»˜å®ã€å¾®ä¿¡)ã€ç”Ÿæˆå”¯ä¸€IDç­–ç•¥(UUIDã€DBè‡ªå¢ã€DB+Redisã€é›ªèŠ±ç®—æ³•ã€Leafç®—æ³•)ç­‰ï¼Œéƒ½å¯ä»¥ä½¿ç”¨ç­–ç•¥æ¨¡å¼è¿›è¡Œè¡Œä¸ºåŒ…è£…ï¼Œä¾›ç»™å¤–éƒ¨ä½¿ç”¨ã€‚</p>
<p>ä¸šåŠ¡åœºæ™¯ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-20-03.png" alt="åœºæ™¯æ¨¡æ‹Ÿï¼›å•†å“æ”¯ä»˜ä½¿ç”¨è¥é”€ä¼˜æƒ åˆ¸"></p>
<p>æ¨¡æ‹Ÿåœ¨è´­ä¹°å•†å“æ—¶å€™ä½¿ç”¨çš„å„ç§ç±»å‹ä¼˜æƒ åˆ¸(æ»¡å‡ã€ç›´å‡ã€æŠ˜æ‰£ã€nå…ƒè´­)</p>
<p>ä¸€èˆ¬çš„æ˜¯å®ç°åœºæ™¯ï¼š(å¤§é‡çš„ <code>if else</code>)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä¼˜æƒ åˆ¸ç±»å‹ï¼›</span></span><br><span class="line"><span class="comment"> * 1. ç›´å‡åˆ¸</span></span><br><span class="line"><span class="comment"> * 2. æ»¡å‡åˆ¸</span></span><br><span class="line"><span class="comment"> * 3. æŠ˜æ‰£åˆ¸</span></span><br><span class="line"><span class="comment"> * 4. nå…ƒè´­</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CouponDiscountService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">discountAmount</span><span class="params">(<span class="type">int</span> type, <span class="type">double</span> typeContent, <span class="type">double</span> skuPrice, <span class="type">double</span> typeExt)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. ç›´å‡åˆ¸</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">1</span> == type) &#123;</span><br><span class="line">            <span class="keyword">return</span> skuPrice - typeContent;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2. æ»¡å‡åˆ¸</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">2</span> == type) &#123;</span><br><span class="line">            <span class="keyword">if</span> (skuPrice &lt; typeExt) <span class="keyword">return</span> skuPrice;</span><br><span class="line">            <span class="keyword">return</span> skuPrice - typeContent;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3. æŠ˜æ‰£åˆ¸</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">3</span> == type) &#123;</span><br><span class="line">            <span class="keyword">return</span> skuPrice * typeContent;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4. nå…ƒè´­</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="number">4</span> == type) &#123;</span><br><span class="line">            <span class="keyword">return</span> typeContent;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0D</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨ç­–ç•¥æ¨¡å¼è§£å†³ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-20-04.png" alt="ç­–ç•¥æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>æ•´ä½“çš„ç»“æ„æ¨¡å¼å¹¶ä¸å¤æ‚ï¼Œä¸»è¦ä½“ç°çš„ä¸åŒç±»å‹çš„ä¼˜æƒ åˆ¸åœ¨è®¡ç®—ä¼˜æƒ åˆ¸æ–¹å¼çš„ä¸åŒè®¡ç®—ç­–ç•¥ã€‚</li>
<li>è¿™é‡ŒåŒ…æ‹¬ä¸€ä¸ªæ¥å£ç±»(<code>ICouponDiscount</code>)ä»¥åŠå››ç§ä¼˜æƒ åˆ¸ç±»å‹çš„å®ç°æ–¹å¼ã€‚</li>
<li>æœ€åæä¾›äº†ç­–ç•¥æ¨¡å¼çš„ä¸Šä¸‹æ§åˆ¶ç±»å¤„ç†ï¼Œæ•´ä½“çš„ç­–ç•¥æœåŠ¡ã€‚</li>
</ul>
<p>ä¼˜æƒ åˆ¸æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ICouponDiscount</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä¼˜æƒ åˆ¸é‡‘é¢è®¡ç®—</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> couponInfo åˆ¸æŠ˜æ‰£ä¿¡æ¯ï¼›ç›´å‡ã€æ»¡å‡ã€æŠ˜æ‰£ã€Nå…ƒè´­</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> skuPrice   skué‡‘é¢</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span>           ä¼˜æƒ åé‡‘é¢</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    BigDecimal <span class="title function_">discountAmount</span><span class="params">(T couponInfo, BigDecimal skuPrice)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å®šä¹‰äº†ä¼˜æƒ åˆ¸æŠ˜æ‰£æ¥å£ï¼Œä¹Ÿå¢åŠ äº†æ³›å‹ç”¨äºä¸åŒç±»å‹çš„æ¥å£å¯ä»¥ä¼ é€’ä¸åŒçš„ç±»å‹å‚æ•°ã€‚</li>
<li>æ¥å£ä¸­åŒ…æ‹¬å•†å“é‡‘é¢ä»¥åŠå‡ºå‚è¿”å›æœ€ç»ˆæŠ˜æ‰£åçš„é‡‘é¢ï¼Œè¿™é‡Œåœ¨å®é™…å¼€å‘ä¸­ä¼šæ¯”ç°åœ¨çš„æ¥å£å‚æ•°å¤šä¸€äº›ï¼Œä½†æ ¸å¿ƒé€»è¾‘æ˜¯è¿™äº›ã€‚</li>
</ul>
<p>æ»¡å‡æ–¹å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MJCouponDiscount</span> <span class="keyword">implements</span> <span class="title class_">ICouponDiscount</span>&lt;Map&lt;String,String&gt;&gt;  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ»¡å‡è®¡ç®—</span></span><br><span class="line"><span class="comment">     * 1. åˆ¤æ–­æ»¡è¶³xå…ƒå-nå…ƒï¼Œå¦åˆ™ä¸å‡</span></span><br><span class="line"><span class="comment">     * 2. æœ€ä½æ”¯ä»˜é‡‘é¢1å…ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> BigDecimal <span class="title function_">discountAmount</span><span class="params">(Map&lt;String,String&gt; couponInfo, BigDecimal skuPrice)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">x</span> <span class="operator">=</span> couponInfo.get(<span class="string">&quot;x&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">o</span> <span class="operator">=</span> couponInfo.get(<span class="string">&quot;n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°äºå•†å“é‡‘é¢æ¡ä»¶çš„ï¼Œç›´æ¥è¿”å›å•†å“åŸä»·</span></span><br><span class="line">        <span class="keyword">if</span> (skuPrice.compareTo(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(x)) &lt; <span class="number">0</span>) <span class="keyword">return</span> skuPrice;</span><br><span class="line">        <span class="comment">// å‡å»ä¼˜æƒ é‡‘é¢åˆ¤æ–­</span></span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">discountAmount</span> <span class="operator">=</span> skuPrice.subtract(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(o));</span><br><span class="line">        <span class="keyword">if</span> (discountAmount.compareTo(BigDecimal.ZERO) &lt; <span class="number">1</span>) <span class="keyword">return</span> BigDecimal.ONE;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> discountAmount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç›´å‡æ–¹å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZJCouponDiscount</span> <span class="keyword">implements</span> <span class="title class_">ICouponDiscount</span>&lt;Double&gt;  &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç›´å‡è®¡ç®—</span></span><br><span class="line"><span class="comment">     * 1. ä½¿ç”¨å•†å“ä»·æ ¼å‡å»ä¼˜æƒ ä»·æ ¼</span></span><br><span class="line"><span class="comment">     * 2. æœ€ä½æ”¯ä»˜é‡‘é¢1å…ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> BigDecimal <span class="title function_">discountAmount</span><span class="params">(Double couponInfo, BigDecimal skuPrice)</span> &#123;</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">discountAmount</span> <span class="operator">=</span> skuPrice.subtract(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(couponInfo));</span><br><span class="line">        <span class="keyword">if</span> (discountAmount.compareTo(BigDecimal.ZERO) &lt; <span class="number">1</span>) <span class="keyword">return</span> BigDecimal.ONE;</span><br><span class="line">        <span class="keyword">return</span> discountAmount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠ˜æ‰£æ–¹å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZKCouponDiscount</span> <span class="keyword">implements</span> <span class="title class_">ICouponDiscount</span>&lt;Double&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æŠ˜æ‰£è®¡ç®—</span></span><br><span class="line"><span class="comment">     * 1. ä½¿ç”¨å•†å“ä»·æ ¼ä¹˜ä»¥æŠ˜æ‰£æ¯”ä¾‹ï¼Œä¸ºæœ€åæ”¯ä»˜é‡‘é¢</span></span><br><span class="line"><span class="comment">     * 2. ä¿ç•™ä¸¤ä½å°æ•°</span></span><br><span class="line"><span class="comment">     * 3. æœ€ä½æ”¯ä»˜é‡‘é¢1å…ƒ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> BigDecimal <span class="title function_">discountAmount</span><span class="params">(Double couponInfo, BigDecimal skuPrice)</span> &#123;</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">discountAmount</span> <span class="operator">=</span> skuPrice.multiply(<span class="keyword">new</span> <span class="title class_">BigDecimal</span>(couponInfo)).setScale(<span class="number">2</span>, BigDecimal.ROUND_HALF_UP);</span><br><span class="line">        <span class="keyword">if</span> (discountAmount.compareTo(BigDecimal.ZERO) &lt; <span class="number">1</span>) <span class="keyword">return</span> BigDecimal.ONE;</span><br><span class="line">        <span class="keyword">return</span> discountAmount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>N å…ƒè´­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NYGCouponDiscount</span> <span class="keyword">implements</span> <span class="title class_">ICouponDiscount</span>&lt;Double&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * nå…ƒè´­è´­ä¹°</span></span><br><span class="line"><span class="comment">     * 1. æ— è®ºåŸä»·å¤šå°‘é’±éƒ½å›ºå®šé‡‘é¢è´­ä¹°</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> BigDecimal <span class="title function_">discountAmount</span><span class="params">(Double couponInfo, BigDecimal skuPrice)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(couponInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç­–ç•¥æ§åˆ¶ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Context</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ICouponDiscount&lt;T&gt; couponDiscount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Context</span><span class="params">(ICouponDiscount&lt;T&gt; couponDiscount)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.couponDiscount = couponDiscount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> BigDecimal <span class="title function_">discountAmount</span><span class="params">(T couponInfo, BigDecimal skuPrice)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> couponDiscount.discountAmount(couponInfo, skuPrice);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ç­–ç•¥æ¨¡å¼çš„æ§åˆ¶ç±»ä¸»è¦æ˜¯å¤–éƒ¨å¯ä»¥ä¼ é€’ä¸åŒçš„ç­–ç•¥å®ç°ï¼Œåœ¨é€šè¿‡ç»Ÿä¸€çš„æ–¹æ³•æ‰§è¡Œä¼˜æƒ ç­–ç•¥è®¡ç®—ã€‚</li>
<li>å¦å¤–è¿™é‡Œä¹Ÿå¯ä»¥åŒ…è£…æˆmapç»“æ„ï¼Œè®©å¤–éƒ¨åªéœ€è¦å¯¹åº”çš„æ³›å‹ç±»å‹å³å¯ä½¿ç”¨ç›¸åº”çš„æœåŠ¡ã€‚</li>
</ul>
<p>æ€»ç»“ï¼š</p>
<ul>
<li>ä»¥ä¸Šçš„ç­–ç•¥æ¨¡å¼æ¡ˆä¾‹ç›¸å¯¹æ¥è¯´ä¸å¹¶ä¸å¤æ‚ï¼Œä¸»è¦çš„é€»è¾‘éƒ½æ˜¯ä½“ç°åœ¨å…³äºä¸åŒç§ç±»ä¼˜æƒ åˆ¸çš„è®¡ç®—æŠ˜æ‰£ç­–ç•¥ä¸Šã€‚ç»“æ„ç›¸å¯¹æ¥è¯´ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåœ¨å®é™…çš„å¼€å‘ä¸­è¿™æ ·çš„è®¾è®¡æ¨¡å¼ä¹Ÿæ˜¯éå¸¸å¸¸ç”¨çš„ã€‚å¦å¤–è¿™æ ·çš„è®¾è®¡ä¸å‘½ä»¤æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ç»“æ„ç›¸ä¼¼ï¼Œä½†æ˜¯æ€è·¯æ˜¯æœ‰å·®å¼‚çš„ã€‚</li>
<li>é€šè¿‡ç­–ç•¥è®¾è®¡æ¨¡å¼çš„ä½¿ç”¨å¯ä»¥æŠŠæˆ‘ä»¬æ–¹æ³•ä¸­çš„ifè¯­å¥ä¼˜åŒ–æ‰ï¼Œå¤§é‡çš„ifè¯­å¥ä½¿ç”¨ä¼šè®©ä»£ç éš¾ä»¥æ‰©å±•ï¼Œä¹Ÿä¸å¥½ç»´æŠ¤ï¼ŒåŒæ—¶åœ¨åæœŸé‡åˆ°å„ç§é—®é¢˜ä¹Ÿå¾ˆéš¾ç»´æŠ¤ã€‚åœ¨ä½¿ç”¨è¿™æ ·çš„è®¾è®¡æ¨¡å¼åå¯ä»¥å¾ˆå¥½çš„æ»¡è¶³éš”ç¦»æ€§ä¸å’Œæ‰©å±•æ€§ï¼Œå¯¹äºä¸æ–­æ–°å¢çš„éœ€æ±‚ä¹Ÿéå¸¸æ–¹ä¾¿æ‰¿æ¥ã€‚</li>
<li><code>ç­–ç•¥æ¨¡å¼</code>ã€<code>é€‚é…å™¨æ¨¡å¼</code>ã€<code>ç»„åˆæ¨¡å¼</code>ç­‰ï¼Œåœ¨ä¸€äº›ç»“æ„ä¸Šæ˜¯æ¯”è¾ƒç›¸ä¼¼çš„ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªæ¨¡å¼æ˜¯æœ‰è‡ªå·±çš„é€»è¾‘ç‰¹ç‚¹ï¼Œåœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­æœ€ä½³çš„æ–¹å¼æ˜¯ç»è¿‡è¾ƒå¤šçš„å®è·µæ¥å¸å–ç»éªŒï¼Œä¸ºåç»­çš„ç ”å‘è®¾è®¡æä¾›æ›´å¥½çš„æŠ€æœ¯è¾“å‡ºã€‚</li>
</ul>
<h3 id="9ã€æ¨¡æ¿æ¨¡å¼"><a href="#9ã€æ¨¡æ¿æ¨¡å¼" class="headerlink" title="9ã€æ¨¡æ¿æ¨¡å¼"></a>9ã€æ¨¡æ¿æ¨¡å¼</h3><p>æ¨¡æ¿æ¨¡å¼çš„æ ¸å¿ƒè®¾è®¡æ€è·¯æ˜¯é€šè¿‡åœ¨æŠ½è±¡ç±»ä¸­å®šä¹‰æŠ½è±¡æ–¹æ³•çš„æ‰§è¡Œé¡ºåºï¼Œå¹¶å°†æŠ½è±¡æ–¹æ³•è®¾å®šä¸ºåªæœ‰å­ç±»å®ç°ï¼Œä½†ä¸è®¾è®¡<code>ç‹¬ç«‹è®¿é—®</code>çš„æ–¹æ³•ã€‚æ¨¡æ¿æ¨¡å¼æœ€å¤§çš„ä½œç”¨å°±æ˜¯ç¡®å®šæŠ½è±¡æ–¹æ³•çš„æ‰§è¡Œé¡ºåºã€‚</p>
<p><strong>ä¸šåŠ¡æ¡ˆä¾‹</strong></p>
<p>æ¨¡æ‹Ÿçˆ¬è™«å„ç±»ç”µå•†å•†å“ï¼Œç”Ÿæˆè¥é”€æ¨å¹¿æµ·æŠ¥åœºæ™¯</p>
<p>è¿‡ç¨‹åˆ†ä¸ºï¼šæ¨¡æ‹Ÿç™»å½•ã€çˆ¬å–ä¿¡æ¯ã€ç”Ÿæˆæµ·æŠ¥ï¼Œè¿™ä¸‰ä¸ªæ­¥éª¤ï¼Œå¦å¤–ï¼›</p>
<ol>
<li>å› ä¸ºæœ‰äº›å•†å“åªæœ‰ç™»å½•åæ‰å¯ä»¥çˆ¬å–ï¼Œå¹¶ä¸”ç™»å½•å¯ä»¥çœ‹åˆ°ä¸€äº›ç‰¹å®šçš„ä»·æ ¼è¿™ä¸æœªç™»å½•ç”¨æˆ·çœ‹åˆ°çš„ä»·æ ¼ä¸åŒã€‚</li>
<li>ä¸åŒçš„ç”µå•†ç½‘ç«™çˆ¬å–æ–¹å¼ä¸åŒï¼Œè§£ææ–¹å¼ä¹Ÿä¸åŒï¼Œå› æ­¤å¯ä»¥ä½œä¸ºæ¯ä¸€ä¸ªå®ç°ç±»ä¸­çš„ç‰¹å®šå®ç°ã€‚</li>
<li>ç”Ÿæˆæµ·æŠ¥çš„æ­¥éª¤åŸºæœ¬ä¸€æ ·ï¼Œä½†ä¼šæœ‰ç‰¹å®šçš„å•†å“æ¥æºæ ‡è¯†ã€‚æ‰€ä»¥è¿™æ ·ä¸‰ä¸ªæ­¥éª¤å¯ä»¥ä½¿ç”¨æ¨¡ç‰ˆæ¨¡å¼æ¥è®¾å®šï¼Œå¹¶æœ‰å…·ä½“çš„åœºæ™¯åšå­ç±»å®ç°ã€‚</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-21-04.png" alt="æ¨¡ç‰ˆæ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<ul>
<li>ä»¥ä¸Šçš„ä»£ç ç»“æ„è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¸€ä¸ªå®šä¹‰äº†æŠ½è±¡æ–¹æ³•æ‰§è¡Œé¡ºåºçš„æ ¸å¿ƒæŠ½è±¡ç±»ï¼Œä»¥åŠä¸‰ä¸ªæ¨¡æ‹Ÿå…·ä½“çš„å®ç°(<code>äº¬ä¸œ</code>ã€<code>æ·˜å®</code>ã€<code>å½“å½“</code>)çš„ç”µå•†æœåŠ¡ã€‚</li>
</ul>
<p>å®šä¹‰æ‰§è¡Œé¡ºåºçš„æŠ½è±¡ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åŸºç¡€ç”µå•†æ¨å¹¿æœåŠ¡</span></span><br><span class="line"><span class="comment"> * 1. ç”Ÿæˆæœ€ä¼˜ä»·å•†å“æµ·æŠ¥</span></span><br><span class="line"><span class="comment"> * 2. æµ·æŠ¥å«å¸¦æ¨å¹¿é‚€è¯·ç </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">NetMall</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(NetMall.class);</span><br><span class="line"></span><br><span class="line">    String uId;   <span class="comment">// ç”¨æˆ·ID</span></span><br><span class="line">    String uPwd;  <span class="comment">// ç”¨æˆ·å¯†ç </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NetMall</span><span class="params">(String uId, String uPwd)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.uId = uId;</span><br><span class="line">        <span class="built_in">this</span>.uPwd = uPwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆå•†å“æ¨å¹¿æµ·æŠ¥</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> skuUrl å•†å“åœ°å€(äº¬ä¸œã€æ·˜å®ã€å½“å½“)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> æµ·æŠ¥å›¾ç‰‡base64ä½ä¿¡æ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">generateGoodsPoster</span><span class="params">(String skuUrl)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!login(uId, uPwd)) <span class="keyword">return</span> <span class="literal">null</span>;             <span class="comment">// 1. éªŒè¯ç™»å½•</span></span><br><span class="line">        Map&lt;String, String&gt; reptile = reptile(skuUrl);  <span class="comment">// 2. çˆ¬è™«å•†å“</span></span><br><span class="line">        <span class="keyword">return</span> createBase64(reptile);                   <span class="comment">// 3. ç»„è£…æµ·æŠ¥</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿç™»å½•</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> Boolean <span class="title function_">login</span><span class="params">(String uId, String uPwd)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çˆ¬è™«æå–å•†å“ä¿¡æ¯(ç™»å½•åçš„ä¼˜æƒ ä»·æ ¼)</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> Map&lt;String, String&gt; <span class="title function_">reptile</span><span class="params">(String skuUrl)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿæˆå•†å“æµ·æŠ¥ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title function_">createBase64</span><span class="params">(Map&lt;String, String&gt; goodsInfo)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>è¿™ä¸ªç±»æ˜¯æ­¤è®¾è®¡æ¨¡å¼çš„çµé­‚</li>
<li>å®šä¹‰å¯è¢«å¤–éƒ¨è®¿é—®çš„æ–¹æ³•<code>generateGoodsPoster</code>ï¼Œç”¨äºç”Ÿæˆå•†å“æ¨å¹¿æµ·æŠ¥</li>
<li><code>generateGoodsPoster</code> åœ¨æ–¹æ³•ä¸­å®šä¹‰æŠ½è±¡æ–¹æ³•çš„æ‰§è¡Œé¡ºåº 1 2 3 æ­¥</li>
<li>æä¾›ä¸‰ä¸ªå…·ä½“çš„æŠ½è±¡æ–¹æ³•ï¼Œè®©å¤–éƒ¨ç»§æ‰¿æ–¹å®ç°ï¼›æ¨¡æ‹Ÿç™»å½•(<code>login</code>)ã€æ¨¡æ‹Ÿçˆ¬å–(<code>reptile</code>)ã€ç”Ÿæˆæµ·æŠ¥(<code>createBase64</code>)</li>
</ul>
<p>æ¨¡æ‹Ÿçˆ¬äº¬ä¸œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDNetMall</span> <span class="keyword">extends</span> <span class="title class_">NetMall</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">JDNetMall</span><span class="params">(String uId, String uPwd)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(uId, uPwd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">login</span><span class="params">(String uId, String uPwd)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿäº¬ä¸œç”¨æˆ·ç™»å½• uIdï¼š&#123;&#125; uPwdï¼š&#123;&#125;&quot;</span>, uId, uPwd);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">reptile</span><span class="params">(String skuUrl)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> HttpClient.doGet(skuUrl);</span><br><span class="line">        <span class="type">Pattern</span> <span class="variable">p9</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;(?&lt;=title\\&gt;).*(?=&lt;/title)&quot;</span>);</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">m9</span> <span class="operator">=</span> p9.matcher(str);</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, String&gt;();</span><br><span class="line">        <span class="keyword">if</span> (m9.find()) &#123;</span><br><span class="line">            map.put(<span class="string">&quot;name&quot;</span>, m9.group());</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(<span class="string">&quot;price&quot;</span>, <span class="string">&quot;5999.00&quot;</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿäº¬ä¸œå•†å“çˆ¬è™«è§£æï¼š&#123;&#125; | &#123;&#125; å…ƒ &#123;&#125;&quot;</span>, map.get(<span class="string">&quot;name&quot;</span>), map.get(<span class="string">&quot;price&quot;</span>), skuUrl);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createBase64</span><span class="params">(Map&lt;String, String&gt; goodsInfo)</span> &#123;</span><br><span class="line">        <span class="type">BASE64Encoder</span> <span class="variable">encoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BASE64Encoder</span>();</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿç”Ÿæˆäº¬ä¸œå•†å“base64æµ·æŠ¥&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> encoder.encode(JSON.toJSONString(goodsInfo).getBytes());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>æ¨¡æ‹Ÿç™»å½•</li>
<li>çˆ¬å–ä¿¡æ¯ï¼Œè¿™é‡Œåªæ˜¯æŠŠ<code>title</code>çš„ä¿¡æ¯çˆ¬å–åçš„ç»“æœæˆªå–å‡ºæ¥ã€‚</li>
<li>æ¨¡æ‹Ÿåˆ›å»º<code>base64</code>å›¾ç‰‡çš„æ–¹æ³•</li>
</ul>
<p>æ¨¡æ‹Ÿçˆ¬æ·˜å®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TaoBaoNetMall</span> <span class="keyword">extends</span> <span class="title class_">NetMall</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TaoBaoNetMall</span><span class="params">(String uId, String uPwd)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(uId, uPwd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">login</span><span class="params">(String uId, String uPwd)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿæ·˜å®ç”¨æˆ·ç™»å½• uIdï¼š&#123;&#125; uPwdï¼š&#123;&#125;&quot;</span>, uId, uPwd);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">reptile</span><span class="params">(String skuUrl)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> HttpClient.doGet(skuUrl);</span><br><span class="line">        <span class="type">Pattern</span> <span class="variable">p9</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;(?&lt;=title\\&gt;).*(?=&lt;/title)&quot;</span>);</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">m9</span> <span class="operator">=</span> p9.matcher(str);</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, String&gt;();</span><br><span class="line">        <span class="keyword">if</span> (m9.find()) &#123;</span><br><span class="line">            map.put(<span class="string">&quot;name&quot;</span>, m9.group());</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(<span class="string">&quot;price&quot;</span>, <span class="string">&quot;4799.00&quot;</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿæ·˜å®å•†å“çˆ¬è™«è§£æï¼š&#123;&#125; | &#123;&#125; å…ƒ &#123;&#125;&quot;</span>, map.get(<span class="string">&quot;name&quot;</span>), map.get(<span class="string">&quot;price&quot;</span>), skuUrl);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createBase64</span><span class="params">(Map&lt;String, String&gt; goodsInfo)</span> &#123;</span><br><span class="line">        <span class="type">BASE64Encoder</span> <span class="variable">encoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BASE64Encoder</span>();</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿç”Ÿæˆæ·˜å®å•†å“base64æµ·æŠ¥&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> encoder.encode(JSON.toJSONString(goodsInfo).getBytes());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ¨¡æ‹Ÿçˆ¬å½“å½“</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DangDangNetMall</span> <span class="keyword">extends</span> <span class="title class_">NetMall</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DangDangNetMall</span><span class="params">(String uId, String uPwd)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(uId, uPwd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Boolean <span class="title function_">login</span><span class="params">(String uId, String uPwd)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿå½“å½“ç”¨æˆ·ç™»å½• uIdï¼š&#123;&#125; uPwdï¼š&#123;&#125;&quot;</span>, uId, uPwd);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Map&lt;String, String&gt; <span class="title function_">reptile</span><span class="params">(String skuUrl)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> HttpClient.doGet(skuUrl);</span><br><span class="line">        <span class="type">Pattern</span> <span class="variable">p9</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;(?&lt;=title\\&gt;).*(?=&lt;/title)&quot;</span>);</span><br><span class="line">        <span class="type">Matcher</span> <span class="variable">m9</span> <span class="operator">=</span> p9.matcher(str);</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, String&gt;();</span><br><span class="line">        <span class="keyword">if</span> (m9.find()) &#123;</span><br><span class="line">            map.put(<span class="string">&quot;name&quot;</span>, m9.group());</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(<span class="string">&quot;price&quot;</span>, <span class="string">&quot;4548.00&quot;</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿå½“å½“å•†å“çˆ¬è™«è§£æï¼š&#123;&#125; | &#123;&#125; å…ƒ &#123;&#125;&quot;</span>, map.get(<span class="string">&quot;name&quot;</span>), map.get(<span class="string">&quot;price&quot;</span>), skuUrl);</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createBase64</span><span class="params">(Map&lt;String, String&gt; goodsInfo)</span> &#123;</span><br><span class="line">        <span class="type">BASE64Encoder</span> <span class="variable">encoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BASE64Encoder</span>();</span><br><span class="line">        logger.info(<span class="string">&quot;æ¨¡æ‹Ÿç”Ÿæˆå½“å½“å•†å“base64æµ·æŠ¥&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> encoder.encode(JSON.toJSONString(goodsInfo).getBytes());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“</strong></p>
<ul>
<li>é€šè¿‡ä¸Šé¢çš„å®ç°å¯ä»¥çœ‹åˆ°<code>æ¨¡ç‰ˆæ¨¡å¼</code>åœ¨å®šä¹‰ç»Ÿä¸€ç»“æ„ä¹Ÿå°±æ˜¯æ‰§è¡Œæ ‡å‡†ä¸Šéå¸¸æ–¹ä¾¿ï¼Œä¹Ÿå°±å¾ˆå¥½çš„æ§åˆ¶äº†åç»­çš„å®ç°è€…ä¸ç”¨å…³å¿ƒè°ƒç”¨é€»è¾‘ï¼ŒæŒ‰ç…§ç»Ÿä¸€æ–¹å¼æ‰§è¡Œã€‚é‚£ä¹ˆç±»çš„ç»§æ‰¿è€…åªéœ€è¦å…³å¿ƒå…·ä½“çš„ä¸šåŠ¡é€»è¾‘å®ç°å³å¯ã€‚</li>
<li>å¦å¤–æ¨¡ç‰ˆæ¨¡å¼ä¹Ÿæ˜¯ä¸ºäº†è§£å†³å­ç±»é€šç”¨æ–¹æ³•ï¼Œæ”¾åˆ°çˆ¶ç±»ä¸­è®¾è®¡çš„ä¼˜åŒ–ã€‚è®©æ¯ä¸€ä¸ªå­ç±»åªåšå­ç±»éœ€è¦å®Œæˆçš„å†…å®¹ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…¶ä»–é€»è¾‘ã€‚è¿™æ ·æå–å…¬ç”¨ä»£ç ï¼Œè¡Œä¸ºç”±çˆ¶ç±»ç®¡ç†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ï¼Œä¹Ÿå°±éå¸¸æœ‰åˆ©äºå¼€å‘æ‹“å±•å’Œè¿­ä»£ã€‚</li>
</ul>
<h3 id="10ã€è®¿é—®è€…æ¨¡å¼"><a href="#10ã€è®¿é—®è€…æ¨¡å¼" class="headerlink" title="10ã€è®¿é—®è€…æ¨¡å¼"></a>10ã€è®¿é—®è€…æ¨¡å¼</h3><p>è®¿é—®è€…è¦è§£å†³çš„æ ¸å¿ƒäº‹é¡¹æ˜¯ï¼Œåœ¨ä¸€ä¸ªç¨³å®šçš„æ•°æ®ç»“æ„ä¸‹ï¼Œä¾‹å¦‚ç”¨æˆ·ä¿¡æ¯ã€é›‡å‘˜ä¿¡æ¯ç­‰ï¼Œå¢åŠ æ˜“å˜çš„ä¸šåŠ¡è®¿é—®é€»è¾‘ã€‚ä¸ºäº†å¢å¼ºæ‰©å±•æ€§ï¼Œå°†è¿™ä¸¤éƒ¨åˆ†çš„ä¸šåŠ¡è§£è€¦çš„ä¸€ç§è®¾è®¡æ¨¡å¼ã€‚</p>
<p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šå¯¹äºå­¦ç”Ÿå’Œè€å¸ˆï¼Œå®¶é•¿å’Œæ ¡é•¿ä¸åŒçš„è§†è§’å…³æ³¨çš„é‡ç‚¹ä¸ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è®¿é—®çš„ä¸šåŠ¡ä¸ä¸€æ ·ã€‚</p>
<p>é‚£ä¹ˆè¿™æ ·<code>å­¦ç”Ÿ</code>å’Œ<code>è€å¸ˆ</code>å°±æ˜¯ä¸€ä¸ªå›ºå®šä¿¡æ¯çš„å†…å®¹ï¼Œè€Œæƒ³è®©ä¸åŒè§†è§’çš„ç”¨æˆ·è·å–å…³å¿ƒçš„ä¿¡æ¯ï¼Œå°±æ¯”è¾ƒé€‚åˆä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼æ¥å®ç°ï¼Œä»è€Œè®©å®ä½“ä¸ä¸šåŠ¡è§£è€¦ï¼Œå¢å¼ºæ‰©å±•æ€§ã€‚<strong>ä½†è§‚å¯Ÿè€…æ¨¡å¼çš„æ•´ä½“ç±»ç»“æ„ç›¸å¯¹å¤æ‚ï¼Œéœ€è¦æ¢³ç†æ¸…æ¥šå†å¼€å‘</strong></p>
<p>å…³äºè¿™ä¸ªæ¡ˆä¾‹çš„æ ¸å¿ƒé€»è¾‘å®ç°ï¼Œæœ‰ä»¥ä¸‹å‡ ç‚¹ï¼›</p>
<ol>
<li>å»ºç«‹ç”¨æˆ·æŠ½è±¡ç±»å’ŒæŠ½è±¡è®¿é—®æ–¹æ³•ï¼Œå†ç”±ä¸åŒçš„ç”¨æˆ·å®ç°ï¼›è€å¸ˆå’Œå­¦ç”Ÿã€‚</li>
<li>å»ºç«‹è®¿é—®è€…æ¥å£ï¼Œç”¨äºä¸åŒäººå‘˜çš„è®¿é—®æ“ä½œï¼›æ ¡é•¿å’Œå®¶é•¿ã€‚</li>
<li>æœ€ç»ˆæ˜¯å¯¹æ•°æ®çš„çœ‹æ¿å»ºè®¾ï¼Œç”¨äºå®ç°ä¸åŒè§†è§’çš„è®¿é—®ç»“æœè¾“å‡ºã€‚</li>
</ol>
<p><strong>è®¿é—®è€…æ¨¡å¼æ¨¡å‹ç»“æ„</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../images/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/itstack-demo-design-22-04.png" alt="è®¿é—®è€…æ¨¡å¼æ¨¡å‹ç»“æ„"></p>
<p>åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªå…³é”®çš„ç‚¹éå¸¸é‡è¦ï¼Œä¹Ÿå°±æ˜¯æ•´å¥—è®¾è®¡æ¨¡å¼çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ï¼›<code>visitor.visit(this)</code>ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨æ¯ä¸€ä¸ªç”¨æˆ·å®ç°ç±»é‡Œï¼ŒåŒ…æ‹¬ï¼›<code>Student</code>ã€<code>Teacher</code>ã€‚</p>
<p><strong>å®šä¹‰ç”¨æˆ·æŠ½è±¡ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŸºç¡€ç”¨æˆ·ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String name;      <span class="comment">// å§“å</span></span><br><span class="line">    <span class="keyword">public</span> String identity;  <span class="comment">// èº«ä»½ï¼›é‡ç‚¹ç­ã€æ™®é€šç­ | ç‰¹çº§æ•™å¸ˆã€æ™®é€šæ•™å¸ˆã€å®ä¹ æ•™å¸ˆ</span></span><br><span class="line">    <span class="keyword">public</span> String clazz;     <span class="comment">// ç­çº§</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, String identity, String clazz)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.identity = identity;</span><br><span class="line">        <span class="built_in">this</span>.clazz = clazz;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¸å¿ƒè®¿é—®æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>å®šä¹‰æŠ½è±¡æ ¸å¿ƒæ–¹æ³•ï¼Œ<code>abstract void accept(Visitor visitor)</code>ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸ºäº†è®©åç»­çš„ç”¨æˆ·å…·ä½“å®ç°è€…éƒ½èƒ½æä¾›å‡ºä¸€ä¸ªè®¿é—®æ–¹æ³•ï¼Œå…±å¤–éƒ¨ä½¿ç”¨ã€‚</li>
</ul>
<p>å®ç°ç”¨æˆ·ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Teacher</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Teacher</span><span class="params">(String name, String identity, String clazz)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name, identity, clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡æœ¬ç‡</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">entranceRatio</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> BigDecimal.valueOf(Math.random() * <span class="number">100</span>).setScale(<span class="number">2</span>, BigDecimal.ROUND_HALF_UP).doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Student</span><span class="params">(String name, String identity, String clazz)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(name, identity, clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">ranking</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">int</span>) (Math.random() * <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>åœ¨<code>accept</code>æ–¹æ³•ä¸­ï¼Œæä¾›äº†æœ¬åœ°å¯¹è±¡çš„è®¿é—®ï¼›<code>visitor.visit(this)</code>ï¼Œè¿™å—éœ€è¦åŠ æ·±ç†è§£ã€‚</li>
<li>è€å¸ˆå’Œå­¦ç”Ÿç±»åˆéƒ½å•ç‹¬æä¾›äº†å„è‡ªçš„ç‰¹æ€§æ–¹æ³•ï¼›å‡æœ¬ç‡(<code>entranceRatio</code>)ã€æ’å(<code>ranking</code>)ï¼Œç±»ä¼¼è¿™æ ·çš„æ–¹æ³•å¯ä»¥æŒ‰ç…§ä¸šåŠ¡éœ€æ±‚è¿›è¡Œæ‰©å±•ã€‚</li>
</ul>
<p><strong>å®šä¹‰æ•°æ®è®¿é—®æ¥å£</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¿é—®å­¦ç”Ÿä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Student student)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¿é—®è€å¸ˆä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Teacher teacher)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ç°æ•°æ®è®¿é—®æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Principal</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(Principal.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Student student)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;å­¦ç”Ÿä¿¡æ¯ å§“åï¼š&#123;&#125; ç­çº§ï¼š&#123;&#125;&quot;</span>, student.name, student.clazz);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Teacher teacher)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;å­¦ç”Ÿä¿¡æ¯ å§“åï¼š&#123;&#125; ç­çº§ï¼š&#123;&#125; å‡å­¦ç‡ï¼š&#123;&#125;&quot;</span>, teacher.name, teacher.clazz, teacher.entranceRatio());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Parent</span> <span class="keyword">implements</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(Parent.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Student student)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;å­¦ç”Ÿä¿¡æ¯ å§“åï¼š&#123;&#125; ç­çº§ï¼š&#123;&#125; æ’åï¼š&#123;&#125;&quot;</span>, student.name, student.clazz, student.ranking());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Teacher teacher)</span> &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;è€å¸ˆä¿¡æ¯ å§“åï¼š&#123;&#125; ç­çº§ï¼š&#123;&#125; çº§åˆ«ï¼š&#123;&#125;&quot;</span>, teacher.name, teacher.clazz, teacher.identity);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ•°æ®çœ‹ç‰ˆ</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataView</span> &#123;</span><br><span class="line"></span><br><span class="line">    List&lt;User&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;User&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DataView</span><span class="params">()</span> &#123;</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;è°¢é£æœº&quot;</span>, <span class="string">&quot;é‡ç‚¹ç­&quot;</span>, <span class="string">&quot;ä¸€å¹´ä¸€ç­&quot;</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;windy&quot;</span>, <span class="string">&quot;é‡ç‚¹ç­&quot;</span>, <span class="string">&quot;ä¸€å¹´ä¸€ç­&quot;</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;å¤§æ¯›&quot;</span>, <span class="string">&quot;æ™®é€šç­&quot;</span>, <span class="string">&quot;äºŒå¹´ä¸‰ç­&quot;</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Shing&quot;</span>, <span class="string">&quot;æ™®é€šç­&quot;</span>, <span class="string">&quot;ä¸‰å¹´å››ç­&quot;</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">Teacher</span>(<span class="string">&quot;BK&quot;</span>, <span class="string">&quot;ç‰¹çº§æ•™å¸ˆ&quot;</span>, <span class="string">&quot;ä¸€å¹´ä¸€ç­&quot;</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">Teacher</span>(<span class="string">&quot;å¨œå¨œGoddess&quot;</span>, <span class="string">&quot;ç‰¹çº§æ•™å¸ˆ&quot;</span>, <span class="string">&quot;ä¸€å¹´ä¸€ç­&quot;</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">Teacher</span>(<span class="string">&quot;dangdang&quot;</span>, <span class="string">&quot;æ™®é€šæ•™å¸ˆ&quot;</span>, <span class="string">&quot;äºŒå¹´ä¸‰ç­&quot;</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">Teacher</span>(<span class="string">&quot;æ³½ä¸œ&quot;</span>, <span class="string">&quot;å®ä¹ æ•™å¸ˆ&quot;</span>, <span class="string">&quot;ä¸‰å¹´å››ç­&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å±•ç¤º</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">(Visitor visitor)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">            user.accept(visitor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æµ‹è¯•ç±»</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">DataView</span> <span class="variable">dataView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataView</span>();      </span><br><span class="line"></span><br><span class="line">    logger.info(<span class="string">&quot;\r\nå®¶é•¿è§†è§’è®¿é—®ï¼š&quot;</span>);</span><br><span class="line">    dataView.show(<span class="keyword">new</span> <span class="title class_">Parent</span>());     <span class="comment">// å®¶é•¿</span></span><br><span class="line"></span><br><span class="line">    logger.info(<span class="string">&quot;\r\næ ¡é•¿è§†è§’è®¿é—®ï¼š&quot;</span>);</span><br><span class="line">    dataView.show(<span class="keyword">new</span> <span class="title class_">Principal</span>());  <span class="comment">// æ ¡é•¿</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ€»ç»“</strong></p>
<p>åœ¨åµŒå…¥è®¿é—®è€…æ¨¡å¼åï¼Œå¯ä»¥è®©æ•´ä¸ªå·¥ç¨‹ç»“æ„å˜å¾—å®¹æ˜“æ·»åŠ å’Œä¿®æ”¹ã€‚ä¹Ÿå°±åšåˆ°äº†ç³»ç»ŸæœåŠ¡ä¹‹é—´çš„è§£è€¦ï¼Œä¸è‡³äºä¸ºäº†ä¸åŒç±»å‹ä¿¡æ¯çš„è®¿é—®è€Œå¢åŠ å¾ˆå¤šå¤šä½™çš„<code>if</code>åˆ¤æ–­æˆ–è€…ç±»çš„å¼ºåˆ¶è½¬æ¢ã€‚ä¹Ÿå°±æ˜¯é€šè¿‡è¿™æ ·çš„è®¾è®¡æ¨¡å¼è€Œè®©ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ã€‚</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="http://www.haungrd.top">Huang RD</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://www.haungrd.top/2023/02/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">http://www.haungrd.top/2023/02/20/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://www.haungrd.top" target="_blank">Huang Blog</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/%E6%BA%90%E7%A0%81/">æºç </a><a class="post-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</a></div><div class="post_share"><div class="social-share" data-image="https://www.huangrd.top/images/agentina/10.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/02/27/%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.huangrd.top/images/agentina/13.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">é¢è¯•é¢˜æ•´ç†</div></div></a></div><div class="next-post pull-right"><a href="/2023/02/17/JUC/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.huangrd.top/images/agentina/8.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">JUC</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2023/03/07/JavaSE%E5%A4%8D%E4%B9%A0%E6%8F%90%E5%8D%87/" title="JavaSE å¤ä¹ æå‡"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.huangrd.top/images/agentina/14.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-03-07</div><div class="title">JavaSE å¤ä¹ æå‡</div></div></a></div><div><a href="/2023/02/13/java%E9%9B%86%E5%90%88%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/" title="Java é›†åˆæºç åˆ†æ"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.huangrd.top/images/agentina/7.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-13</div><div class="title">Java é›†åˆæºç åˆ†æ</div></div></a></div><div><a href="/2023/05/04/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%A4%8D%E4%B9%A0%E6%8F%90%E5%8D%87/" title="æ•°æ®ç»“æ„å¤ä¹ æå‡"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.huangrd.top/images/agentina/14.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-05-04</div><div class="title">æ•°æ®ç»“æ„å¤ä¹ æå‡</div></div></a></div><div><a href="/2023/04/13/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AF%87-%E9%AB%98%E7%BA%A7%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="æ•°æ®ç»“æ„ç¯‡-é«˜çº§æ•°æ®ç»“æ„"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.huangrd.top/images/agentina/12.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-13</div><div class="title">æ•°æ®ç»“æ„ç¯‡-é«˜çº§æ•°æ®ç»“æ„</div></div></a></div><div><a href="/2023/04/10/%E7%AE%97%E6%B3%95%E7%AF%87-%E4%BA%8C%E5%88%86%E6%90%9C%E7%B4%A2/" title="ç®—æ³•ç¯‡-äºŒåˆ†æœç´¢"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.huangrd.top/images/agentina/4.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-10</div><div class="title">ç®—æ³•ç¯‡-äºŒåˆ†æœç´¢</div></div></a></div><div><a href="/2023/04/11/%E7%AE%97%E6%B3%95%E7%AF%87-%E5%8F%8C%E6%8C%87%E9%92%88/" title="ç®—æ³•ç¯‡-åŒæŒ‡é’ˆ"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://www.huangrd.top/images/agentina/10.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-11</div><div class="title">ç®—æ³•ç¯‡-åŒæŒ‡é’ˆ</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Java-%E5%B8%B8%E8%A7%81%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-text">Java å¸¸è§çš„è®¾è®¡æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8E%9F%E5%88%99"><span class="toc-text">è®¾è®¡æ¨¡å¼çš„åŸåˆ™</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99-SRP"><span class="toc-text">1.å•ä¸€èŒè´£åŸåˆ™ SRP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%BC%80%E6%94%BE-%E5%85%B3%E9%97%AD%E5%8E%9F%E5%88%99-OCP"><span class="toc-text">2.å¼€æ”¾-å…³é—­åŸåˆ™ OCP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%87%8C%E6%B0%8F%E6%9B%BF%E6%8D%A2%E5%8E%9F%E5%88%99-LSP"><span class="toc-text">3.é‡Œæ°æ›¿æ¢åŸåˆ™ LSP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E4%BE%9D%E8%B5%96%E5%80%92%E8%BD%AC%E5%8E%9F%E5%88%99-DIP"><span class="toc-text">4.ä¾èµ–å€’è½¬åŸåˆ™ DIP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99-ISP"><span class="toc-text">5.æ¥å£éš”ç¦»åŸåˆ™ ISP</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E8%BF%AA%E7%B1%B3%E7%89%B9%E6%B3%95%E5%88%99-LOD"><span class="toc-text">6.è¿ªç±³ç‰¹æ³•åˆ™ LOD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E7%BB%84%E5%90%88-x2F-%E8%81%9A%E5%90%88%E5%A4%8D%E7%94%A8%E5%8E%9F%E5%88%99-CRP"><span class="toc-text">7.ç»„åˆ&#x2F;èšåˆå¤ç”¨åŸåˆ™ CRP</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">ä¸€ã€åˆ›å»ºå‹æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">1ã€å•ä¾‹æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#static-%E9%A5%BF%E6%B1%89%E5%BC%8F"><span class="toc-text">static é¥¿æ±‰å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E9%A5%BF%E6%B1%89%E5%BC%8F"><span class="toc-text">æšä¸¾é¥¿æ±‰å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%87%92%E6%B1%89%E5%BC%8F"><span class="toc-text">æ‡’æ±‰å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%8C%E6%A3%80%E9%94%81%E6%87%92%E6%B1%89%E5%BC%8F"><span class="toc-text">åŒæ£€é”æ‡’æ±‰å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E9%83%A8%E7%B1%BB%E6%87%92%E6%B1%89%E5%BC%8F"><span class="toc-text">å†…éƒ¨ç±»æ‡’æ±‰å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CAS-AtomicReference-%E6%87%92%E6%B1%89%E5%BC%8F"><span class="toc-text">CAS (AtomicReference)æ‡’æ±‰å¼</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-text">2ã€å·¥å‚æ–¹æ³•æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E5%B7%A5%E5%8E%82"><span class="toc-text">æ™®é€šå·¥å‚</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82"><span class="toc-text">æŠ½è±¡å·¥å‚</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">3ã€å»ºé€ è€…æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">4ã€åŸå‹æ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%BB%93%E6%9E%84%E6%80%A7%E6%A8%A1%E5%BC%8F"><span class="toc-text">äºŒã€ç»“æ„æ€§æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">1ã€é€‚é…å™¨æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B1%BB%E9%80%82%E9%85%8D%E5%99%A8-amp-%E5%AF%B9%E8%B1%A1%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-text">ç±»é€‚é…å™¨&amp;å¯¹è±¡é€‚é…å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-text">æ¥å£é€‚é…å™¨</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text">2ã€æ¡¥æ¥æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-text">3ã€ç»„åˆæ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E8%A3%85%E9%A5%B0%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">4ã€è£…é¥°å™¨æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="toc-text">5ã€å¤–è§‚æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-text">6ã€äº«å…ƒæ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-text">7ã€ä»£ç†æ¨¡å¼</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-text">ä¸‰ã€è¡Œä¸ºå‹æ¨¡å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"><span class="toc-text">1ã€è´£ä»»é“¾æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-text">2ã€å‘½ä»¤æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-text">3ã€è¿­ä»£å™¨æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">4ã€ä¸­ä»‹è€…æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-text">5ã€å¤‡å¿˜å½•æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">6ã€è§‚å¯Ÿè€…æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-text">7ã€çŠ¶æ€æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-text">8ã€ç­–ç•¥æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F"><span class="toc-text">9ã€æ¨¡æ¿æ¨¡å¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-text">10ã€è®¿é—®è€…æ¨¡å¼</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Huang RD</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="ç®€ç¹è½¬æ¢">ç®€</button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="30" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>